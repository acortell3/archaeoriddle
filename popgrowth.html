<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Population structure &amp; growth | Methods Riddles, the ultimate revelations</title>
  <meta name="description" content="First draft of Rbookdown to describe how data have been generated" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Population structure &amp; growth | Methods Riddles, the ultimate revelations" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="First draft of Rbookdown to describe how data have been generated" />
  <meta name="github-repo" content="acortell3/archaeoriddle" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Population structure &amp; growth | Methods Riddles, the ultimate revelations" />
  
  <meta name="twitter:description" content="First draft of Rbookdown to describe how data have been generated" />
  

<meta name="author" content="CDAL" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="env.html"/>
<link rel="next" href="conflict.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.11/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-archaeoriddle"><i class="fa fa-check"></i><b>1.1</b> What is archaeoriddle?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-will-you-find-in-this-bookdown"><i class="fa fa-check"></i><b>1.2</b> What will you find in this bookdown?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-can-you-do-with-this"><i class="fa fa-check"></i><b>1.3</b> What can you do with this?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="env.html"><a href="env.html"><i class="fa fa-check"></i><b>2</b> Landscape &amp; Resources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="env.html"><a href="env.html#autocorrelated-noise-generation"><i class="fa fa-check"></i><b>2.1</b> Autocorrelated noise generation</a></li>
<li class="chapter" data-level="2.2" data-path="env.html"><a href="env.html#slope-and-elevation"><i class="fa fa-check"></i><b>2.2</b> Slope and Elevation</a></li>
<li class="chapter" data-level="2.3" data-path="env.html"><a href="env.html#environmental-resources"><i class="fa fa-check"></i><b>2.3</b> Environmental resources</a></li>
<li class="chapter" data-level="2.4" data-path="env.html"><a href="env.html#manual-selection"><i class="fa fa-check"></i><b>2.4</b> Manually Select Resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="popgrowth.html"><a href="popgrowth.html"><i class="fa fa-check"></i><b>3</b> Population structure &amp; growth</a>
<ul>
<li class="chapter" data-level="3.1" data-path="popgrowth.html"><a href="popgrowth.html#settlements-position"><i class="fa fa-check"></i><b>3.1</b> Settlements position</a></li>
<li class="chapter" data-level="3.2" data-path="popgrowth.html"><a href="popgrowth.html#initsize"><i class="fa fa-check"></i><b>3.2</b> Initializing Site Population and Culture</a></li>
<li class="chapter" data-level="3.3" data-path="popgrowth.html"><a href="popgrowth.html#base-pop-growth"><i class="fa fa-check"></i><b>3.3</b> Population Growth : <span class="math inline">\(Pop\)</span>-protocol</a>
<ul>
<li class="chapter" data-level="" data-path="popgrowth.html"><a href="popgrowth.html#source"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="conflict.html"><a href="conflict.html"><i class="fa fa-check"></i><b>4</b> Migration &amp; Conflict</a>
<ul>
<li class="chapter" data-level="4.1" data-path="conflict.html"><a href="conflict.html#fission"><i class="fa fa-check"></i><b>4.1</b> Fission</a></li>
<li class="chapter" data-level="4.2" data-path="conflict.html"><a href="conflict.html#migration"><i class="fa fa-check"></i><b>4.2</b> Migration</a></li>
<li class="chapter" data-level="4.3" data-path="conflict.html"><a href="conflict.html#conflict-and-war"><i class="fa fa-check"></i><b>4.3</b> Conflict and War</a></li>
<li class="chapter" data-level="4.4" data-path="conflict.html"><a href="conflict.html#network-site-size-and-climate-deprecated"><i class="fa fa-check"></i><b>4.4</b> ~~ Network, Site Size And Climate â€“ DEPRECATED ~~</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="main-simu.html"><a href="main-simu.html"><i class="fa fa-check"></i><b>5</b> Main Simulation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="main-simu.html"><a href="main-simu.html#initial-parameters"><i class="fa fa-check"></i><b>5.1</b> Initial Parameters</a></li>
<li class="chapter" data-level="5.2" data-path="main-simu.html"><a href="main-simu.html#preparation"><i class="fa fa-check"></i><b>5.2</b> Preparation</a></li>
<li class="chapter" data-level="5.3" data-path="main-simu.html"><a href="main-simu.html#algorithm"><i class="fa fa-check"></i><b>5.3</b> Algorithm</a>
<ul>
<li class="chapter" data-level="" data-path="main-simu.html"><a href="main-simu.html#source-code"><i class="fa fa-check"></i>Source code</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="main-simu.html"><a href="main-simu.html#explore-simulation"><i class="fa fa-check"></i><b>5.4</b> Explore simulation:</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="recgen.html"><a href="recgen.html"><i class="fa fa-check"></i><b>6</b> Record formation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="recgen.html"><a href="recgen.html#theoretical-model"><i class="fa fa-check"></i><b>6.1</b> Theoretical model</a></li>
<li class="chapter" data-level="6.2" data-path="recgen.html"><a href="recgen.html#implementation"><i class="fa fa-check"></i><b>6.2</b> Implementation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="recgen.html"><a href="recgen.html#population-pop-protocol"><i class="fa fa-check"></i><b>6.2.1</b> Population <span class="math inline">\(Pop\)</span>-protocol</a></li>
<li class="chapter" data-level="6.2.2" data-path="recgen.html"><a href="recgen.html#anthropogenic-deposition-a-protocol"><i class="fa fa-check"></i><b>6.2.2</b> Anthropogenic deposition <span class="math inline">\(A\)</span>-protocol</a></li>
<li class="chapter" data-level="6.2.3" data-path="recgen.html"><a href="recgen.html#depth-d-protocol"><i class="fa fa-check"></i><b>6.2.3</b> Depth <span class="math inline">\(D\)</span>-protocol</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="recgen.html"><a href="recgen.html#minimal-example-and-simulation"><i class="fa fa-check"></i><b>6.3</b> Minimal example and simulation</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="recloss.html"><a href="recloss.html"><i class="fa fa-check"></i><b>7</b> Record loss</a>
<ul>
<li class="chapter" data-level="7.1" data-path="recloss.html"><a href="recloss.html#theoretical-model-1"><i class="fa fa-check"></i><b>7.1</b> Theoretical model</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="recloss.html"><a href="recloss.html#general-purpose"><i class="fa fa-check"></i><b>7.1.1</b> General purpose</a></li>
<li class="chapter" data-level="7.1.2" data-path="recloss.html"><a href="recloss.html#model-layers"><i class="fa fa-check"></i><b>7.1.2</b> Model layers</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="recloss.html"><a href="recloss.html#implementation-1"><i class="fa fa-check"></i><b>7.2</b> Implementation</a>
<ul>
<li class="chapter" data-level="" data-path="recloss.html"><a href="recloss.html#source-1"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="recloss.html"><a href="recloss.html#usage"><i class="fa fa-check"></i><b>7.3</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="final-output.html"><a href="final-output.html"><i class="fa fa-check"></i><b>8</b> Generate final archaeological record</a>
<ul>
<li class="chapter" data-level="8.1" data-path="final-output.html"><a href="final-output.html#using-sites-size-to-generate-deposit"><i class="fa fa-check"></i><b>8.1</b> Using sites size to generate deposit</a></li>
<li class="chapter" data-level="8.2" data-path="final-output.html"><a href="final-output.html#split-environment-in-a-grid"><i class="fa fa-check"></i><b>8.2</b> Split environment in a grid</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="final-output.html"><a href="final-output.html#giving-name-to-the-publicly-available-data"><i class="fa fa-check"></i><b>8.2.1</b> Giving name to the publicly available data</a></li>
<li class="chapter" data-level="8.2.2" data-path="final-output.html"><a href="final-output.html#export-and-download-dates"><i class="fa fa-check"></i><b>8.2.2</b> Export and download dates</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="final-output.html"><a href="final-output.html#bonus-maps"><i class="fa fa-check"></i><b>8.3</b> Bonus maps</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="original-challenge.html"><a href="original-challenge.html"><i class="fa fa-check"></i><b>9</b> Archaeoriddle: the original challenge</a>
<ul>
<li class="chapter" data-level="9.1" data-path="original-challenge.html"><a href="original-challenge.html#context"><i class="fa fa-check"></i><b>9.1</b> Context</a></li>
<li class="chapter" data-level="9.2" data-path="original-challenge.html"><a href="original-challenge.html#implementation-2"><i class="fa fa-check"></i><b>9.2</b> Implementation</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="original-challenge.html"><a href="original-challenge.html#generate-and-share-final-simulation"><i class="fa fa-check"></i><b>9.2.1</b> Generate and share final simulation</a></li>
<li class="chapter" data-level="9.2.2" data-path="original-challenge.html"><a href="original-challenge.html#split-environment-in-a-grid-1"><i class="fa fa-check"></i><b>9.2.2</b> Split environment in a grid</a></li>
<li class="chapter" data-level="9.2.3" data-path="original-challenge.html"><a href="original-challenge.html#naming"><i class="fa fa-check"></i><b>9.2.3</b> Giving name to the publicly available data</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="original-challenge.html"><a href="original-challenge.html#the-challenge"><i class="fa fa-check"></i><b>9.3</b> The challenge</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="original-challenge.html"><a href="original-challenge.html#research-question"><i class="fa fa-check"></i><b>9.3.1</b> Research Question</a></li>
<li class="chapter" data-level="9.3.2" data-path="original-challenge.html"><a href="original-challenge.html#challenge-eaa-workshop"><i class="fa fa-check"></i><b>9.3.2</b> Challenge &amp; EAA workshop</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="original-challenge.html"><a href="original-challenge.html#proposals"><i class="fa fa-check"></i><b>9.4</b> Proposals</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="original-challenge.html"><a href="original-challenge.html#p1"><i class="fa fa-check"></i><b>9.4.1</b> P1</a></li>
<li class="chapter" data-level="9.4.2" data-path="original-challenge.html"><a href="original-challenge.html#p2"><i class="fa fa-check"></i><b>9.4.2</b> P2</a></li>
<li class="chapter" data-level="9.4.3" data-path="original-challenge.html"><a href="original-challenge.html#p3"><i class="fa fa-check"></i><b>9.4.3</b> P3</a></li>
<li class="chapter" data-level="9.4.4" data-path="original-challenge.html"><a href="original-challenge.html#p4"><i class="fa fa-check"></i><b>9.4.4</b> P4</a></li>
<li class="chapter" data-level="9.4.5" data-path="original-challenge.html"><a href="original-challenge.html#p5"><i class="fa fa-check"></i><b>9.4.5</b> P5</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/acortell3/archaeoriddle/">
source</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Methods Riddles, the ultimate revelations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="popgrowth" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Population structure &amp; growth<a href="popgrowth.html#popgrowth" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="settlements-position" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Settlements position<a href="popgrowth.html#settlements-position" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="popgrowth.html#cb24-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="co"># we will create  20 sites</span></span>
<span id="cb24-2"><a href="popgrowth.html#cb24-2" tabindex="-1"></a>size <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n) <span class="co">#assign a size for each site following an exponential distribution </span></span></code></pre></div>
<p>Following what we set up during the previous chapter, we can use <code>spatSample</code> from package <code>terra</code> to randomly select <code>n</code> points (20 for this simulation) on the viable polygon we created.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="popgrowth.html#cb25-1" tabindex="-1"></a>sites <span class="ot">&lt;-</span> <span class="fu">spatSample</span>(viable, n) <span class="co"># generate n random points within the viable polygon and assign to variable sites</span></span>
<span id="cb25-2"><a href="popgrowth.html#cb25-2" tabindex="-1"></a><span class="fu">plot</span>(height.ras, <span class="at">col=</span><span class="fu">col_ramp</span>(<span class="dv">20</span>), <span class="at">legend=</span>F, <span class="at">reset=</span>F)</span>
<span id="cb25-3"><a href="popgrowth.html#cb25-3" tabindex="-1"></a><span class="fu">plot</span>(height.wat, <span class="at">col=</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">add=</span>T, <span class="at">legend=</span>F)</span>
<span id="cb25-4"><a href="popgrowth.html#cb25-4" tabindex="-1"></a><span class="fu">plot</span>(sites, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">add=</span>T, <span class="at">bg=</span><span class="fu">rainbow</span>(<span class="fu">length</span>(sites), <span class="at">alpha=</span>.<span class="dv">6</span>))</span>
<span id="cb25-5"><a href="popgrowth.html#cb25-5" tabindex="-1"></a></span>
<span id="cb25-6"><a href="popgrowth.html#cb25-6" tabindex="-1"></a><span class="co"># get only the non submerged actual land and plot it</span></span>
<span id="cb25-7"><a href="popgrowth.html#cb25-7" tabindex="-1"></a>above_level <span class="ot">&lt;-</span> height.ras <span class="sc">&gt;</span> <span class="fu">mean</span>(height.ras[])</span>
<span id="cb25-8"><a href="popgrowth.html#cb25-8" tabindex="-1"></a>coastline <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="fu">as.polygons</span>(above_level))[<span class="dv">2</span>,]</span>
<span id="cb25-9"><a href="popgrowth.html#cb25-9" tabindex="-1"></a><span class="fu">plot</span>(coastline, <span class="at">col=</span><span class="cn">NA</span>, <span class="at">bgc=</span><span class="fu">adjustcolor</span>(<span class="st">&quot;cyan&quot;</span>, <span class="fl">0.1</span>), <span class="at">add=</span>T)</span></code></pre></div>
<p><img src="_main_files/figure-html/samplesites-1.png" width="672" /></p>
<p>In the context of <a href="https://theia.arch.cam.ac.uk/archaeoriddle/">the archaeoriddle challenge</a>, the files that describe this newly generated environment (the DEM and the coastline) as well as the resources raster, needs to be given to the participant. This can be done as:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="popgrowth.html#cb26-1" tabindex="-1"></a>foldname<span class="ot">=</span><span class="st">&quot;data_toshare&quot;</span> <span class="co">#We will store all data that can/will be shared with participant in data_toshare</span></span>
<span id="cb26-2"><a href="popgrowth.html#cb26-2" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(foldname))<span class="fu">dir.create</span>(foldname)</span>
<span id="cb26-3"><a href="popgrowth.html#cb26-3" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">dsn=</span><span class="fu">file.path</span>(foldname,<span class="st">&quot;coastline.shp&quot;</span>), coastline,<span class="at">append=</span>F) <span class="co"># Write the coastline as a shapefile</span></span>
<span id="cb26-4"><a href="popgrowth.html#cb26-4" tabindex="-1"></a><span class="do">## Writing layer `coastline&#39; to data source </span></span>
<span id="cb26-5"><a href="popgrowth.html#cb26-5" tabindex="-1"></a><span class="do">##   `data_toshare/coastline.shp&#39; using driver `ESRI Shapefile&#39;</span></span>
<span id="cb26-6"><a href="popgrowth.html#cb26-6" tabindex="-1"></a><span class="do">## Writing 1 features with 1 fields and geometry type Multi Polygon.</span></span>
<span id="cb26-7"><a href="popgrowth.html#cb26-7" tabindex="-1"></a><span class="fu">writeRaster</span>(<span class="at">filename=</span><span class="fu">file.path</span>(foldname,<span class="st">&quot;dem_raster.tiff&quot;</span>), height.ras, <span class="at">overwrite=</span>T) <span class="co">#write the DEM as a raster</span></span>
<span id="cb26-8"><a href="popgrowth.html#cb26-8" tabindex="-1"></a></span>
<span id="cb26-9"><a href="popgrowth.html#cb26-9" tabindex="-1"></a><span class="fu">writeRaster</span>(<span class="at">filename=</span><span class="fu">file.path</span>(foldname,<span class="st">&quot;resources.tiff&quot;</span>), ress, <span class="at">overwrite=</span>T) <span class="co">#write the resources as a raster</span></span></code></pre></div>
<p>The original data, saved and shared for the <em>archaeoriddle</em> are stored in <code>data_original/</code></p>
</div>
<div id="initsize" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Initializing Site Population and Culture<a href="popgrowth.html#initsize" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Each site is then assigned as either belonging to the hunter-gather (HG) or farmer (F) culture.</p>
<p>To generate a more realistic distribution, all sites are initially, designated as hunter-gatherer sites, except for the one located in the most southwest position. Please note that this decision was based on the specific shape of the initial archaeoriddleâ€™s challenge. If needed, you may want to manually select the site culture for this specific location.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="popgrowth.html#cb27-1" tabindex="-1"></a>cultures <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;HG&quot;</span>,<span class="fu">length</span>(sites))</span>
<span id="cb27-2"><a href="popgrowth.html#cb27-2" tabindex="-1"></a>sw <span class="ot">&lt;-</span> <span class="fu">which.min</span>(<span class="fu">sqrt</span>((<span class="fu">crds</span>(sites)[,<span class="st">&quot;x&quot;</span>] <span class="sc">-</span> <span class="fu">min</span>(<span class="fu">crds</span>(sites)[,<span class="st">&quot;x&quot;</span>]))<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (<span class="fu">crds</span>(sites)[,<span class="st">&quot;y&quot;</span>] <span class="sc">-</span> <span class="fu">min</span>(<span class="fu">crds</span>(sites)[,<span class="st">&quot;y&quot;</span>]))<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb27-3"><a href="popgrowth.html#cb27-3" tabindex="-1"></a>cultures[sw]<span class="ot">=</span><span class="st">&quot;F&quot;</span></span>
<span id="cb27-4"><a href="popgrowth.html#cb27-4" tabindex="-1"></a>sites<span class="sc">$</span>culture <span class="ot">&lt;-</span> cultures</span>
<span id="cb27-5"><a href="popgrowth.html#cb27-5" tabindex="-1"></a></span>
<span id="cb27-6"><a href="popgrowth.html#cb27-6" tabindex="-1"></a><span class="fu">plotMap</span>(height.ras,height.wat)</span>
<span id="cb27-7"><a href="popgrowth.html#cb27-7" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">crds</span>(sites),<span class="at">bg=</span><span class="fu">as.factor</span>(cultures),<span class="at">pch=</span><span class="dv">21</span>,<span class="at">cex=</span><span class="fl">1.3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/setcultures-1.png" width="672" /></p>
<p>Each site will then be assigned a carrying capacity (how many people can leave on the site), probabilistically defined using the resource raster and the culture of the site.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="popgrowth.html#cb28-1" tabindex="-1"></a></span>
<span id="cb28-2"><a href="popgrowth.html#cb28-2" tabindex="-1"></a>Kbase <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;HG&quot;</span><span class="ot">=</span><span class="dv">45</span>,<span class="st">&quot;F&quot;</span><span class="ot">=</span><span class="dv">120</span>) <span class="co">#difference in base-K for the two cultures</span></span>
<span id="cb28-3"><a href="popgrowth.html#cb28-3" tabindex="-1"></a></span>
<span id="cb28-4"><a href="popgrowth.html#cb28-4" tabindex="-1"></a><span class="co"># The base Ks  are then modulated given the ressource raster</span></span>
<span id="cb28-5"><a href="popgrowth.html#cb28-5" tabindex="-1"></a>sites<span class="sc">$</span>Ks <span class="ot">&lt;-</span> <span class="fu">initKs</span>(Kbase, sites, ress, <span class="at">sizeexp=</span><span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<p>Using these carrying capacities, we then set initial number of people, and the population structure for each sites:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="popgrowth.html#cb29-1" tabindex="-1"></a><span class="co"># Population size at initialisation, a number close to Ks</span></span>
<span id="cb29-2"><a href="popgrowth.html#cb29-2" tabindex="-1"></a>INs <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">runif</span>(<span class="fu">length</span>(sites), <span class="fl">0.85</span>, <span class="fl">0.95</span>)<span class="sc">*</span>sites<span class="sc">$</span>Ks)</span>
<span id="cb29-3"><a href="popgrowth.html#cb29-3" tabindex="-1"></a></span>
<span id="cb29-4"><a href="popgrowth.html#cb29-4" tabindex="-1"></a><span class="co"># initialise population structure for all sites</span></span>
<span id="cb29-5"><a href="popgrowth.html#cb29-5" tabindex="-1"></a>Ips <span class="ot">&lt;-</span> <span class="fu">lapply</span>(INs, initpopstruc)</span>
<span id="cb29-6"><a href="popgrowth.html#cb29-6" tabindex="-1"></a></span>
<span id="cb29-7"><a href="popgrowth.html#cb29-7" tabindex="-1"></a>ts <span class="ot">&lt;-</span> <span class="dv">250</span></span>
<span id="cb29-8"><a href="popgrowth.html#cb29-8" tabindex="-1"></a></span>
<span id="cb29-9"><a href="popgrowth.html#cb29-9" tabindex="-1"></a><span class="co"># We put the population structure across the years in a matrix: each row will represent a time step of the simulation ; each column a sites</span></span>
<span id="cb29-10"><a href="popgrowth.html#cb29-10" tabindex="-1"></a></span>
<span id="cb29-11"><a href="popgrowth.html#cb29-11" tabindex="-1"></a>Nts <span class="ot">&lt;-</span> <span class="fu">initlistsites</span>(Ips, <span class="at">ts=</span>ts)</span></code></pre></div>
<p>We can look at the population structure of the biggest site:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="popgrowth.html#cb30-1" tabindex="-1"></a>biggest <span class="ot">&lt;-</span> <span class="fu">which.max</span>(INs)</span>
<span id="cb30-2"><a href="popgrowth.html#cb30-2" tabindex="-1"></a>pop.biggest <span class="ot">&lt;-</span> Ips[[biggest]]</span>
<span id="cb30-3"><a href="popgrowth.html#cb30-3" tabindex="-1"></a>poplist<span class="ot">=</span><span class="fu">sapply</span>(<span class="fu">c</span>(<span class="at">F=</span><span class="st">&quot;F&quot;</span>,<span class="at">M=</span><span class="st">&quot;M&quot;</span>),<span class="cf">function</span>(s)<span class="fu">table</span>(<span class="fu">cut</span>(pop.biggest[pop.biggest[,<span class="dv">2</span>]<span class="sc">==</span>s,<span class="dv">1</span>],<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">40</span>,<span class="dv">4</span>))))</span>
<span id="cb30-4"><a href="popgrowth.html#cb30-4" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb30-5"><a href="popgrowth.html#cb30-5" tabindex="-1"></a><span class="fu">barplot</span>(<span class="sc">-</span>poplist[,<span class="dv">1</span>],<span class="at">beside=</span>T,<span class="at">horiz=</span>T,<span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>),<span class="at">axes=</span>F,<span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb30-6"><a href="popgrowth.html#cb30-6" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">10</span>))</span>
<span id="cb30-7"><a href="popgrowth.html#cb30-7" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">unname</span>(poplist[,<span class="dv">1</span>]),<span class="at">beside=</span>T,<span class="at">horiz=</span>T,<span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;red&quot;</span>),<span class="at">axes=</span>F)</span></code></pre></div>
<p><img src="_main_files/figure-html/agestruc-1.png" width="40%" /><img src="_main_files/figure-html/agestruc-2.png" width="40%" /></p>
You can see the code of <code>initKs</code>, <code>initpopstruct</code> and <code>initlistsites</code> functions here:
<details>
<summary>
Show code
</summary>
<p><strong>Code</strong></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="popgrowth.html#cb31-1" tabindex="-1"></a><span class="do">## Function 14. Initial carrying capacity</span></span>
<span id="cb31-2"><a href="popgrowth.html#cb31-2" tabindex="-1"></a>initKs <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">Kbase=</span><span class="fu">c</span>(<span class="st">&quot;HG&quot;</span><span class="ot">=</span><span class="dv">30</span>,<span class="st">&quot;F&quot;</span><span class="ot">=</span><span class="dv">120</span>), sites, ressources,</span>
<span id="cb31-3"><a href="popgrowth.html#cb31-3" tabindex="-1"></a>                   <span class="at">sizeexp=</span><span class="cn">NULL</span>, <span class="at">rate=</span>.<span class="dv">5</span>){</span>
<span id="cb31-4"><a href="popgrowth.html#cb31-4" tabindex="-1"></a>  Ks <span class="ot">&lt;-</span> <span class="fu">round</span>(Kbase[sites<span class="sc">$</span>culture] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(sites), <span class="dv">0</span>, <span class="dv">10</span>))</span>
<span id="cb31-5"><a href="popgrowth.html#cb31-5" tabindex="-1"></a>  <span class="cf">while</span>(<span class="fu">any</span>(Ks<span class="sc">&lt;</span><span class="dv">1</span>)){</span>
<span id="cb31-6"><a href="popgrowth.html#cb31-6" tabindex="-1"></a>    Ks <span class="ot">&lt;-</span> <span class="fu">round</span>( Kbase[sites<span class="sc">$</span>culture] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(sites), <span class="dv">0</span>, <span class="dv">10</span>) )</span>
<span id="cb31-7"><a href="popgrowth.html#cb31-7" tabindex="-1"></a>  }</span>
<span id="cb31-8"><a href="popgrowth.html#cb31-8" tabindex="-1"></a>  <span class="co">#Ks[sites$culture==&quot;F&quot;]=Ks[sites$culture==&quot;F&quot;]*runif(sum(sites$culture==&quot;F&quot;),1,1)</span></span>
<span id="cb31-9"><a href="popgrowth.html#cb31-9" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> Ks <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">extract</span>(ressources, sites)[, <span class="dv">2</span>])</span>
<span id="cb31-10"><a href="popgrowth.html#cb31-10" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(sizeexp)){</span>
<span id="cb31-11"><a href="popgrowth.html#cb31-11" tabindex="-1"></a>    tmp[sites<span class="sc">$</span>culture<span class="sc">==</span>sizeexp] <span class="ot">&lt;-</span> (</span>
<span id="cb31-12"><a href="popgrowth.html#cb31-12" tabindex="-1"></a>      (Ks[sites<span class="sc">$</span>culture<span class="sc">==</span>sizeexp]) <span class="sc">*</span></span>
<span id="cb31-13"><a href="popgrowth.html#cb31-13" tabindex="-1"></a>        (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">rexp</span>(<span class="fu">sum</span>(sites<span class="sc">$</span>culture<span class="sc">==</span>sizeexp), <span class="at">rate=</span>rate) <span class="sc">*</span> <span class="fu">extract</span>(ressources, sites[sites<span class="sc">$</span>culture<span class="sc">==</span>sizeexp])[,<span class="dv">2</span>])</span>
<span id="cb31-14"><a href="popgrowth.html#cb31-14" tabindex="-1"></a>    )</span>
<span id="cb31-15"><a href="popgrowth.html#cb31-15" tabindex="-1"></a>  }</span>
<span id="cb31-16"><a href="popgrowth.html#cb31-16" tabindex="-1"></a>  tmp</span>
<span id="cb31-17"><a href="popgrowth.html#cb31-17" tabindex="-1"></a>}</span>
<span id="cb31-18"><a href="popgrowth.html#cb31-18" tabindex="-1"></a></span>
<span id="cb31-19"><a href="popgrowth.html#cb31-19" tabindex="-1"></a></span>
<span id="cb31-20"><a href="popgrowth.html#cb31-20" tabindex="-1"></a> </span>
<span id="cb31-21"><a href="popgrowth.html#cb31-21" tabindex="-1"></a><span class="do">## Function 15. Create population matrix</span></span>
<span id="cb31-22"><a href="popgrowth.html#cb31-22" tabindex="-1"></a>initpopstruc <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n=</span><span class="dv">100</span>, <span class="at">ages=</span><span class="dv">10</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">p_sex=</span><span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)){</span>
<span id="cb31-23"><a href="popgrowth.html#cb31-23" tabindex="-1"></a>  initpop <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb31-24"><a href="popgrowth.html#cb31-24" tabindex="-1"></a>    <span class="st">&quot;Age&quot;</span> <span class="ot">=</span> <span class="fu">sample</span>(ages, n, ages, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-25"><a href="popgrowth.html#cb31-25" tabindex="-1"></a>    <span class="st">&quot;Sex&quot;</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>), n, <span class="at">prob =</span> p_sex, <span class="at">replace =</span> <span class="cn">TRUE</span>))   </span>
<span id="cb31-26"><a href="popgrowth.html#cb31-26" tabindex="-1"></a>  <span class="fu">return</span>(initpop)</span>
<span id="cb31-27"><a href="popgrowth.html#cb31-27" tabindex="-1"></a>}</span>
<span id="cb31-28"><a href="popgrowth.html#cb31-28" tabindex="-1"></a></span>
<span id="cb31-29"><a href="popgrowth.html#cb31-29" tabindex="-1"></a></span>
<span id="cb31-30"><a href="popgrowth.html#cb31-30" tabindex="-1"></a><span class="do">## Function 16. Initialize initial list of sites</span></span>
<span id="cb31-31"><a href="popgrowth.html#cb31-31" tabindex="-1"></a>initlistsites <span class="ot">&lt;-</span> <span class="cf">function</span>(list_sites, <span class="at">ts=</span><span class="dv">200</span>){</span>
<span id="cb31-32"><a href="popgrowth.html#cb31-32" tabindex="-1"></a>  Nts <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>ts<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="fu">length</span>(list_sites))</span>
<span id="cb31-33"><a href="popgrowth.html#cb31-33" tabindex="-1"></a>  Nts[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">sapply</span>(list_sites, nrow)</span>
<span id="cb31-34"><a href="popgrowth.html#cb31-34" tabindex="-1"></a>  <span class="fu">return</span>(Nts)</span>
<span id="cb31-35"><a href="popgrowth.html#cb31-35" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
<div id="base-pop-growth" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Population Growth : <span class="math inline">\(Pop\)</span>-protocol<a href="popgrowth.html#base-pop-growth" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This is a central aspect of the model, and defines several parameters to control how population growth and reach a maximum population <span class="math inline">\(\sim K\)</span>. It is based on three functions: The first function, <code>Gpd()</code>, is the core of the protocol. It receives a population <code>matrix</code> or <code>data.frame</code> with a specific number of individuals (<code>nrow</code>), their age (<code>df[,1]</code>) and their sex (<code>df[,2]</code>) and produces another object with the same format but with a different population based on the current one. Introduced in a loop, this function produces a time series of population, which ensures the Markov property of the stochastic process <span class="math inline">\(p(x_n+1|x_n)\)</span>.</p>
<p>However, this function also relies on two the other functions: <code>death()</code> and <code>K_lim()</code>. <code>death()</code> is the process of people dying each year. It is based on an age-structured probability matrix, where infants and old people have more probabilities of deceasing. The matrix is provided, but the user can set its own. <code>K_lim()</code> limits the population when it reaches <span class="math inline">\(K\)</span>. The user should specify the appropriate value for <span class="math inline">\(K\)</span> according to the size of the site, its type, the group economy, etc. Also, the user can change the probability that exceeding people dies with parameter <code>prob</code>. Default is 0.8.</p>
<p>These base function will then be used in higher level functions to update the population size given the size and ages defined and described in the previous <a href="popgrowth.html#initsize">section</a>.</p>
<p>A simple function <code>Pop_stoch</code> implement a simple stochastic growth that uses these functions without the migrations and war mechanismes describe in this chapter.</p>
<p>We can then use it to check and see the type of growth are generate given the default parameters (prob define the probability of people dying when the population has reached carrying capacity)</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="popgrowth.html#cb32-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb32-2"><a href="popgrowth.html#cb32-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">180</span>),<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>),<span class="at">type=</span><span class="st">&quot;n&quot;</span>,<span class="at">xlab=</span><span class="st">&quot;time&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;pop size&quot;</span>)</span>
<span id="cb32-3"><a href="popgrowth.html#cb32-3" tabindex="-1"></a>na<span class="ot">=</span><span class="fu">replicate</span>(<span class="dv">10</span>, <span class="fu">lines</span>(<span class="fu">Pop_stoch</span>(<span class="at">pop_size=</span><span class="dv">50</span>, <span class="at">ts=</span><span class="dv">50</span>, <span class="at">K=</span><span class="dv">150</span>, <span class="at">W_fert_age =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">45</span>), <span class="at">M_fert_age =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">55</span>), <span class="at">p_offspring =</span> <span class="fl">0.3</span>, <span class="at">prob =</span> <span class="fl">0.8</span>)))</span></code></pre></div>
<p><img src="_main_files/figure-html/test-popstoch-1.png" width="672" /></p>
<p>To know more about these functions and how their parameters are used, you can look at the manual given in the package:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="popgrowth.html#cb33-1" tabindex="-1"></a>?Gpd</span>
<span id="cb33-2"><a href="popgrowth.html#cb33-2" tabindex="-1"></a>?death</span>
<span id="cb33-3"><a href="popgrowth.html#cb33-3" tabindex="-1"></a>?K_lim</span>
<span id="cb33-4"><a href="popgrowth.html#cb33-4" tabindex="-1"></a>?Pop_stoch</span></code></pre></div>
<p>You can also use this <a href="">shiny app online</a> to explore how these parameters interact to generate different growth curves.</p>
<div id="source" class="section level3 unnumbered hasAnchor">
<h3>Source<a href="popgrowth.html#source" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you want to delve into the code of the functions you can open it here:</p>
<details>
<summary>
Show code
</summary>
<p><strong>Code</strong></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="popgrowth.html#cb34-1" tabindex="-1"></a><span class="do">## Function 1. Generation of population dynamics</span></span>
<span id="cb34-2"><a href="popgrowth.html#cb34-2" tabindex="-1"></a>Gpd <span class="ot">&lt;-</span> <span class="cf">function</span>(x, K, <span class="at">W_fert_age =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">45</span>), <span class="at">M_fert_age =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">55</span>),</span>
<span id="cb34-3"><a href="popgrowth.html#cb34-3" tabindex="-1"></a>                <span class="at">p_offspring =</span> <span class="fl">0.3</span>, <span class="at">prob =</span> <span class="fl">0.8</span>, ...){</span>
<span id="cb34-4"><a href="popgrowth.html#cb34-4" tabindex="-1"></a>  </span>
<span id="cb34-5"><a href="popgrowth.html#cb34-5" tabindex="-1"></a>  <span class="do">## Process of having offspring</span></span>
<span id="cb34-6"><a href="popgrowth.html#cb34-6" tabindex="-1"></a>  <span class="co"># Female fertile population</span></span>
<span id="cb34-7"><a href="popgrowth.html#cb34-7" tabindex="-1"></a>  W <span class="ot">&lt;-</span> x[x[,<span class="dv">2</span>]<span class="sc">==</span><span class="st">&quot;F&quot;</span>, ]</span>
<span id="cb34-8"><a href="popgrowth.html#cb34-8" tabindex="-1"></a>  W_fert <span class="ot">&lt;-</span> W[W<span class="sc">$</span>Age <span class="sc">&gt;</span> W_fert_age[<span class="dv">1</span>] <span class="sc">&amp;</span> W<span class="sc">$</span>Age <span class="sc">&lt;</span> W_fert_age[<span class="dv">2</span>], ]</span>
<span id="cb34-9"><a href="popgrowth.html#cb34-9" tabindex="-1"></a>  <span class="co"># Male fertile population</span></span>
<span id="cb34-10"><a href="popgrowth.html#cb34-10" tabindex="-1"></a>  M <span class="ot">&lt;-</span> x[x[,<span class="dv">2</span>]<span class="sc">==</span><span class="st">&quot;M&quot;</span>, ]</span>
<span id="cb34-11"><a href="popgrowth.html#cb34-11" tabindex="-1"></a>  M_fert <span class="ot">&lt;-</span> M[M<span class="sc">$</span>Age <span class="sc">&gt;</span> M_fert_age[<span class="dv">1</span>] <span class="sc">&amp;</span> M<span class="sc">$</span>Age <span class="sc">&lt;</span> M_fert_age[<span class="dv">2</span>], ]</span>
<span id="cb34-12"><a href="popgrowth.html#cb34-12" tabindex="-1"></a>  </span>
<span id="cb34-13"><a href="popgrowth.html#cb34-13" tabindex="-1"></a>  <span class="do">## Probability of having descendance per woman</span></span>
<span id="cb34-14"><a href="popgrowth.html#cb34-14" tabindex="-1"></a>  <span class="co"># Penalisation in case there are too few men</span></span>
<span id="cb34-15"><a href="popgrowth.html#cb34-15" tabindex="-1"></a>  pen <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(M_fert)<span class="sc">*</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">nrow</span>(W_fert), <span class="dv">2</span>) <span class="co"># Assumes one man can have two women</span></span>
<span id="cb34-16"><a href="popgrowth.html#cb34-16" tabindex="-1"></a>  pen[pen<span class="sc">&gt;</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="do">## The men penalisation can never multiply the birth rate per woman</span></span>
<span id="cb34-17"><a href="popgrowth.html#cb34-17" tabindex="-1"></a>  <span class="co"># Probability of a woman having a son per year</span></span>
<span id="cb34-18"><a href="popgrowth.html#cb34-18" tabindex="-1"></a>  p_offspring <span class="ot">&lt;-</span> p_offspring<span class="sc">*</span>pen</span>
<span id="cb34-19"><a href="popgrowth.html#cb34-19" tabindex="-1"></a>  </span>
<span id="cb34-20"><a href="popgrowth.html#cb34-20" tabindex="-1"></a>  <span class="do">## Aging process. They get one year older</span></span>
<span id="cb34-21"><a href="popgrowth.html#cb34-21" tabindex="-1"></a>  x<span class="sc">$</span>Age <span class="ot">&lt;-</span> x<span class="sc">$</span>Age<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb34-22"><a href="popgrowth.html#cb34-22" tabindex="-1"></a>  </span>
<span id="cb34-23"><a href="popgrowth.html#cb34-23" tabindex="-1"></a>  <span class="do">## Births are new population that&#39;s added</span></span>
<span id="cb34-24"><a href="popgrowth.html#cb34-24" tabindex="-1"></a>  n_offspring <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">rbinom</span>(<span class="fu">nrow</span>(W_fert), <span class="dv">1</span>, p_offspring))</span>
<span id="cb34-25"><a href="popgrowth.html#cb34-25" tabindex="-1"></a>  new_pop <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-26"><a href="popgrowth.html#cb34-26" tabindex="-1"></a>    <span class="st">&quot;Age&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_offspring),</span>
<span id="cb34-27"><a href="popgrowth.html#cb34-27" tabindex="-1"></a>    <span class="st">&quot;Sex&quot;</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>), n_offspring, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb34-28"><a href="popgrowth.html#cb34-28" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rbind</span>(x, new_pop)</span>
<span id="cb34-29"><a href="popgrowth.html#cb34-29" tabindex="-1"></a>  </span>
<span id="cb34-30"><a href="popgrowth.html#cb34-30" tabindex="-1"></a>  <span class="do">## Process of dying</span></span>
<span id="cb34-31"><a href="popgrowth.html#cb34-31" tabindex="-1"></a>  vec_d <span class="ot">&lt;-</span> <span class="fu">apply</span>(x, <span class="dv">1</span>, death, ...)</span>
<span id="cb34-32"><a href="popgrowth.html#cb34-32" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x[vec_d<span class="sc">==</span><span class="dv">0</span>, ]</span>
<span id="cb34-33"><a href="popgrowth.html#cb34-33" tabindex="-1"></a>  </span>
<span id="cb34-34"><a href="popgrowth.html#cb34-34" tabindex="-1"></a>  <span class="do">## Apply carrying capacty restrictions</span></span>
<span id="cb34-35"><a href="popgrowth.html#cb34-35" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">K_lim</span>(x, <span class="at">K =</span> K, <span class="at">prob =</span> prob)</span>
<span id="cb34-36"><a href="popgrowth.html#cb34-36" tabindex="-1"></a>  </span>
<span id="cb34-37"><a href="popgrowth.html#cb34-37" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb34-38"><a href="popgrowth.html#cb34-38" tabindex="-1"></a>}</span>
<span id="cb34-39"><a href="popgrowth.html#cb34-39" tabindex="-1"></a></span>
<span id="cb34-40"><a href="popgrowth.html#cb34-40" tabindex="-1"></a></span>
<span id="cb34-41"><a href="popgrowth.html#cb34-41" tabindex="-1"></a><span class="do">## Function 2. Simulation of death process</span></span>
<span id="cb34-42"><a href="popgrowth.html#cb34-42" tabindex="-1"></a>death <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">pd=</span><span class="fu">data.frame</span>(<span class="st">&quot;Age&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">99</span>),</span>
<span id="cb34-43"><a href="popgrowth.html#cb34-43" tabindex="-1"></a>                                   <span class="st">&quot;P_d&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fl">0.14</span>,<span class="dv">1</span>),</span>
<span id="cb34-44"><a href="popgrowth.html#cb34-44" tabindex="-1"></a>                                             <span class="fu">rep</span>(<span class="fl">0.16</span>,<span class="dv">4</span>),</span>
<span id="cb34-45"><a href="popgrowth.html#cb34-45" tabindex="-1"></a>                                             <span class="fu">rep</span>(<span class="fl">0.05</span>,<span class="dv">5</span>),</span>
<span id="cb34-46"><a href="popgrowth.html#cb34-46" tabindex="-1"></a>                                             <span class="fu">rep</span>(<span class="fl">0.01</span>,<span class="dv">24</span>),</span>
<span id="cb34-47"><a href="popgrowth.html#cb34-47" tabindex="-1"></a>                                             <span class="fu">rep</span>(<span class="fl">0.03</span>,<span class="dv">14</span>),</span>
<span id="cb34-48"><a href="popgrowth.html#cb34-48" tabindex="-1"></a>                                             <span class="fu">rep</span>(<span class="fl">0.1</span>,<span class="dv">10</span>),</span>
<span id="cb34-49"><a href="popgrowth.html#cb34-49" tabindex="-1"></a>                                             <span class="fu">rep</span>(<span class="fl">0.3</span>,<span class="dv">42</span>)))){</span>
<span id="cb34-50"><a href="popgrowth.html#cb34-50" tabindex="-1"></a>  age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x[<span class="dv">1</span>])</span>
<span id="cb34-51"><a href="popgrowth.html#cb34-51" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="at">prob=</span>pd[pd<span class="sc">$</span>Age<span class="sc">==</span>age, <span class="dv">2</span>]))</span>
<span id="cb34-52"><a href="popgrowth.html#cb34-52" tabindex="-1"></a>}</span>
<span id="cb34-53"><a href="popgrowth.html#cb34-53" tabindex="-1"></a></span>
<span id="cb34-54"><a href="popgrowth.html#cb34-54" tabindex="-1"></a><span class="do">## Function 3. Simulation of carrying capacity limitation</span></span>
<span id="cb34-55"><a href="popgrowth.html#cb34-55" tabindex="-1"></a>K_lim <span class="ot">&lt;-</span> <span class="cf">function</span>(x, K, <span class="at">prob=</span><span class="fl">0.8</span>){</span>
<span id="cb34-56"><a href="popgrowth.html#cb34-56" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb34-57"><a href="popgrowth.html#cb34-57" tabindex="-1"></a>  <span class="cf">if</span> (p<span class="sc">&gt;</span>K){</span>
<span id="cb34-58"><a href="popgrowth.html#cb34-58" tabindex="-1"></a>    o <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(p<span class="sc">-</span>K, <span class="dv">1</span>, prob)</span>
<span id="cb34-59"><a href="popgrowth.html#cb34-59" tabindex="-1"></a>    o <span class="ot">&lt;-</span> <span class="fu">sum</span>(o[o<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb34-60"><a href="popgrowth.html#cb34-60" tabindex="-1"></a>    o[o<span class="sc">==</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Avoids problem eliminating all the df if remove == 0</span></span>
<span id="cb34-61"><a href="popgrowth.html#cb34-61" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x[<span class="sc">-</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(x), o, <span class="at">replace=</span><span class="cn">FALSE</span>), ]</span>
<span id="cb34-62"><a href="popgrowth.html#cb34-62" tabindex="-1"></a>  }</span>
<span id="cb34-63"><a href="popgrowth.html#cb34-63" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb34-64"><a href="popgrowth.html#cb34-64" tabindex="-1"></a>}</span>
<span id="cb34-65"><a href="popgrowth.html#cb34-65" tabindex="-1"></a></span>
<span id="cb34-66"><a href="popgrowth.html#cb34-66" tabindex="-1"></a></span>
<span id="cb34-67"><a href="popgrowth.html#cb34-67" tabindex="-1"></a><span class="do">## Function 4. Stochastic population generation</span></span>
<span id="cb34-68"><a href="popgrowth.html#cb34-68" tabindex="-1"></a>Pop_stoch <span class="ot">&lt;-</span> <span class="cf">function</span>(pop_size, K, ts, <span class="at">prob =</span> <span class="fl">0.8</span>, ...){</span>
<span id="cb34-69"><a href="popgrowth.html#cb34-69" tabindex="-1"></a>  </span>
<span id="cb34-70"><a href="popgrowth.html#cb34-70" tabindex="-1"></a>  <span class="do">## Create initial population</span></span>
<span id="cb34-71"><a href="popgrowth.html#cb34-71" tabindex="-1"></a>  pop_matrix <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-72"><a href="popgrowth.html#cb34-72" tabindex="-1"></a>    <span class="st">&quot;Age&quot;</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">30</span>, pop_size, <span class="dv">10</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-73"><a href="popgrowth.html#cb34-73" tabindex="-1"></a>    <span class="st">&quot;Sex&quot;</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>), pop_size, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-74"><a href="popgrowth.html#cb34-74" tabindex="-1"></a>  )</span>
<span id="cb34-75"><a href="popgrowth.html#cb34-75" tabindex="-1"></a>  </span>
<span id="cb34-76"><a href="popgrowth.html#cb34-76" tabindex="-1"></a>  <span class="do">## Initialize vector with population size for each year  </span></span>
<span id="cb34-77"><a href="popgrowth.html#cb34-77" tabindex="-1"></a>  pop <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length=</span>ts)</span>
<span id="cb34-78"><a href="popgrowth.html#cb34-78" tabindex="-1"></a>  pop[<span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="fu">nrow</span>(pop_matrix)</span>
<span id="cb34-79"><a href="popgrowth.html#cb34-79" tabindex="-1"></a>  <span class="do">## Run stochastic process  </span></span>
<span id="cb34-80"><a href="popgrowth.html#cb34-80" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ts){</span>
<span id="cb34-81"><a href="popgrowth.html#cb34-81" tabindex="-1"></a>    pop_matrix <span class="ot">&lt;-</span> <span class="fu">Gpd</span>(pop_matrix, <span class="at">K=</span>K, <span class="at">prob=</span>prob, ...)</span>
<span id="cb34-82"><a href="popgrowth.html#cb34-82" tabindex="-1"></a>    pop[i] <span class="ot">&lt;-</span> <span class="fu">nrow</span>(pop_matrix)</span>
<span id="cb34-83"><a href="popgrowth.html#cb34-83" tabindex="-1"></a>  }</span>
<span id="cb34-84"><a href="popgrowth.html#cb34-84" tabindex="-1"></a>  </span>
<span id="cb34-85"><a href="popgrowth.html#cb34-85" tabindex="-1"></a>  <span class="fu">return</span>(pop)</span>
<span id="cb34-86"><a href="popgrowth.html#cb34-86" tabindex="-1"></a>}</span></code></pre></div>
</details>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="env.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conflict.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
