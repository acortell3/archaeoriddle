<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Record formation | Methods Riddles, the ultimate revelations</title>
  <meta name="description" content="First draft of Rbookdown to describe how data have been generated" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Record formation | Methods Riddles, the ultimate revelations" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="First draft of Rbookdown to describe how data have been generated" />
  <meta name="github-repo" content="acortell3/archaeoriddle" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Record formation | Methods Riddles, the ultimate revelations" />
  
  <meta name="twitter:description" content="First draft of Rbookdown to describe how data have been generated" />
  

<meta name="author" content="CDAL" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="main-simu.html"/>
<link rel="next" href="recloss.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.11/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-archaeoriddle"><i class="fa fa-check"></i><b>1.1</b> What is archaeoriddle?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-will-you-find-in-this-bookdown"><i class="fa fa-check"></i><b>1.2</b> What will you find in this bookdown?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-can-you-do-with-this"><i class="fa fa-check"></i><b>1.3</b> What can you do with this?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="env.html"><a href="env.html"><i class="fa fa-check"></i><b>2</b> Landscape &amp; Resources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="env.html"><a href="env.html#autocorrelated-noise-generation"><i class="fa fa-check"></i><b>2.1</b> Autocorrelated noise generation</a></li>
<li class="chapter" data-level="2.2" data-path="env.html"><a href="env.html#slope-and-elevation"><i class="fa fa-check"></i><b>2.2</b> Slope and Elevation</a></li>
<li class="chapter" data-level="2.3" data-path="env.html"><a href="env.html#environmental-resources"><i class="fa fa-check"></i><b>2.3</b> Environmental resources</a></li>
<li class="chapter" data-level="2.4" data-path="env.html"><a href="env.html#manual-selection"><i class="fa fa-check"></i><b>2.4</b> Manually Select Resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="popgrowth.html"><a href="popgrowth.html"><i class="fa fa-check"></i><b>3</b> Population structure &amp; growth</a>
<ul>
<li class="chapter" data-level="3.1" data-path="popgrowth.html"><a href="popgrowth.html#settlements-position"><i class="fa fa-check"></i><b>3.1</b> Settlements position</a></li>
<li class="chapter" data-level="3.2" data-path="popgrowth.html"><a href="popgrowth.html#initsize"><i class="fa fa-check"></i><b>3.2</b> Initializing Site Population and Culture</a></li>
<li class="chapter" data-level="3.3" data-path="popgrowth.html"><a href="popgrowth.html#base-pop-growth"><i class="fa fa-check"></i><b>3.3</b> Population Growth : <span class="math inline">\(Pop\)</span>-protocol</a>
<ul>
<li class="chapter" data-level="" data-path="popgrowth.html"><a href="popgrowth.html#source"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="conflict.html"><a href="conflict.html"><i class="fa fa-check"></i><b>4</b> Migration &amp; Conflict</a>
<ul>
<li class="chapter" data-level="4.1" data-path="conflict.html"><a href="conflict.html#fission"><i class="fa fa-check"></i><b>4.1</b> Fission</a></li>
<li class="chapter" data-level="4.2" data-path="conflict.html"><a href="conflict.html#migration"><i class="fa fa-check"></i><b>4.2</b> Migration</a></li>
<li class="chapter" data-level="4.3" data-path="conflict.html"><a href="conflict.html#conflict-and-war"><i class="fa fa-check"></i><b>4.3</b> Conflict and War</a></li>
<li class="chapter" data-level="4.4" data-path="conflict.html"><a href="conflict.html#network-site-size-and-climate-deprecated"><i class="fa fa-check"></i><b>4.4</b> ~~ Network, Site Size And Climate â€“ DEPRECATED ~~</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="main-simu.html"><a href="main-simu.html"><i class="fa fa-check"></i><b>5</b> Main Simulation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="main-simu.html"><a href="main-simu.html#initial-parameters"><i class="fa fa-check"></i><b>5.1</b> Initial Parameters</a></li>
<li class="chapter" data-level="5.2" data-path="main-simu.html"><a href="main-simu.html#algorithm"><i class="fa fa-check"></i><b>5.2</b> Algorithm</a>
<ul>
<li class="chapter" data-level="" data-path="main-simu.html"><a href="main-simu.html#source-code"><i class="fa fa-check"></i>Source code</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="main-simu.html"><a href="main-simu.html#explore-simulation"><i class="fa fa-check"></i><b>5.3</b> Explore simulation:</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="recgen.html"><a href="recgen.html"><i class="fa fa-check"></i><b>6</b> Record formation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="recgen.html"><a href="recgen.html#theoretical-model"><i class="fa fa-check"></i><b>6.1</b> Theoretical model</a></li>
<li class="chapter" data-level="6.2" data-path="recgen.html"><a href="recgen.html#implementation"><i class="fa fa-check"></i><b>6.2</b> Implementation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="recgen.html"><a href="recgen.html#population-pop-protocol"><i class="fa fa-check"></i><b>6.2.1</b> Population <span class="math inline">\(Pop\)</span>-protocol</a></li>
<li class="chapter" data-level="6.2.2" data-path="recgen.html"><a href="recgen.html#anthropogenic-deposition-a-protocol"><i class="fa fa-check"></i><b>6.2.2</b> Anthropogenic deposition <span class="math inline">\(A\)</span>-protocol</a></li>
<li class="chapter" data-level="6.2.3" data-path="recgen.html"><a href="recgen.html#depth-d-protocol"><i class="fa fa-check"></i><b>6.2.3</b> Depth <span class="math inline">\(D\)</span>-protocol</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="recgen.html"><a href="recgen.html#minimal-example-and-simulation"><i class="fa fa-check"></i><b>6.3</b> Minimal example and simulation</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="recloss.html"><a href="recloss.html"><i class="fa fa-check"></i><b>7</b> Record loss</a>
<ul>
<li class="chapter" data-level="7.1" data-path="recloss.html"><a href="recloss.html#theoretical-model-1"><i class="fa fa-check"></i><b>7.1</b> Theoretical model</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="recloss.html"><a href="recloss.html#general-purpose"><i class="fa fa-check"></i><b>7.1.1</b> General purpose</a></li>
<li class="chapter" data-level="7.1.2" data-path="recloss.html"><a href="recloss.html#model-layers"><i class="fa fa-check"></i><b>7.1.2</b> Model layers</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="recloss.html"><a href="recloss.html#implementation-1"><i class="fa fa-check"></i><b>7.2</b> Implementation</a>
<ul>
<li class="chapter" data-level="" data-path="recloss.html"><a href="recloss.html#source-1"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="recloss.html"><a href="recloss.html#usage"><i class="fa fa-check"></i><b>7.3</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="final-output.html"><a href="final-output.html"><i class="fa fa-check"></i><b>8</b> Generate final archaeological record</a>
<ul>
<li class="chapter" data-level="8.1" data-path="final-output.html"><a href="final-output.html#using-sites-size-to-generate-deposit"><i class="fa fa-check"></i><b>8.1</b> Using sites size to generate deposit</a></li>
<li class="chapter" data-level="8.2" data-path="final-output.html"><a href="final-output.html#split-environment-in-a-grid"><i class="fa fa-check"></i><b>8.2</b> Split environment in a grid</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="archaeoriddle-the-original-challenge.html"><a href="archaeoriddle-the-original-challenge.html"><i class="fa fa-check"></i><b>9</b> Archaeoriddle: the original challenge</a>
<ul>
<li class="chapter" data-level="9.1" data-path="archaeoriddle-the-original-challenge.html"><a href="archaeoriddle-the-original-challenge.html#generate-and-share-final-simulation"><i class="fa fa-check"></i><b>9.1</b> Generate and share final simulation</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/acortell3/archaeoriddle/">
source</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Methods Riddles, the ultimate revelations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="recgen" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Record formation<a href="recgen.html#recgen" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="theoretical-model" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Theoretical model<a href="recgen.html#theoretical-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We have produced a computational model, replicating the process of formation of the archaeological record in a specific site, accounting for different variables. In order to consider the possible relation between those variables, we have decided to express them as a Directed Acyclic Graph (DAG), following the ECS-DAG methodology proposed by Ferguson et al.Â (2020). In this case, however, and because our goal is to obtain an accurate initial template for the development of the model, we have not considered setting an exposure variable, but rather to propose different theoretical directional and causal relationships without relying on the conventional exposure-outcome assessment. Therefore, highlights in the graph below do not intend to differentiate among confounders, mediators, etc., but to emphasize the possible weight that each variable has for producing the outcome (produced waste by <span class="math inline">\(m^2\)</span>).</p>
<div class="grViz html-widget html-fill-item" id="htmlwidget-53f5066b32fe6ceef53f" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-53f5066b32fe6ceef53f">{"x":{"diagram":"\n  digraph record_formation {\n  \n    graph [layout = dot, ## Set title and layout\n           label = \"Record formation process\",\n           labelloc = \"t\"\n           fontname = Helvetica,\n           fontsize = 30]\n    \n    # node definitions with substituted label text\n    node [fontname = Helvetica, ## General node definition\n          style = filled,\n          color = MistyRose]\n          \n    ## Per node definition\n    a [label = \"Pop (group size)\",\n       fillcolor = orange]\n    b [label = \"Site function\",\n       fillcolor = cadetblue1]\n    c [label = \"Anthropogenic deposition rates\",\n       fillcolor = orange]\n    d [label = \"Site type\",\n       fillcolor = cadetblue1]\n    e [label = \"Natural deposition rates\",\n       fillcolor = orange]\n    f [label = \"Waste/sqrm\",\n       fillcolor = cadetblue,\n       fixedsize = shape,\n       width = 4.5,\n       height = 1,\n       fontsize = 30]\n    \n    ## General edge definition\n    edge [color = grey,\n           arrowhead = vee,\n           arrowtail = vee]\n    \n    ## Specific edges\n    a -> {c}\n    b -> {c}\n    c -> {f}\n    d -> {e}\n    e -> {f}\n  }\n  \n  ## Label definition","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>The above graph depicts a very schematic way to represent the formation of the archaeological record (<span class="math inline">\(W/m^2\)</span>). In this case, we are interested in radiocarbon dating, focusing on bone samples; that is the number (and range) of potential 14C dates produced in a site, and this is key to understand the way in which we produced the model. We are aware that generating a specific archaeological palimpsest depends on a large quantity of variables, some of which may be controlled by field archaeologists and some of which may not (or are not). Therefore, the graph above must be read as follows. Asides from the outcome variable, the exposure variables, <em>Pop (group size)</em>, <em>Anthropogenic deposition rates</em> and <em>Natural deposition rates</em> (depicted in orange), are designed in a way that they can be activated for the model to infer them, they can be provided by the archaeologist, or they can be simply ignored. In the most elementary case, the archaeologist could introduce directly the outcome variable (<span class="math inline">\(W/m^2\)</span>) without taking into account anything else, if she/he is confident to provide an accurate value.</p>
<p>However, in most cases, this information will not be known to the field researcher, and in this situation, these variables can be modeled to different extents of complexity. While, for example, in the case of the most simple simulation, the field archaeologist could ignore deposition rates. In this case, and because we are only considering 14C dates, then the quantity of the sample becomes broadly proportional to the number of people present in a site, and thus it could be modeled like this.</p>
<div class="grViz html-widget html-fill-item" id="htmlwidget-191b6cad197f0017272f" style="width:50%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-191b6cad197f0017272f">{"x":{"diagram":"\n  digraph record_formation {\n  \n    graph [layout = dot, ## Set title and layout\n           label = \"Record formation process\",\n           labelloc = \"t\"\n           fontname = Helvetica,\n           fontsize = 30]\n    \n    # node definitions with substituted label text\n    node [fontname = Helvetica, ## General node definition\n          style = filled,\n          color = MistyRose]\n           \n    ## Per node definition\n    a [label = \"Pop (group size)\",\n       fillcolor = orange]\n    b [label = \"Waste/sqrm\",\n       fillcolor = cadetblue,\n       fixedsize = shape,\n       width = 4.5,\n       height = 1,\n       fontsize = 30]\n    \n    ## General edge definition\n    edge [color = grey,\n           arrowhead = vee,\n           arrowtail = vee]\n    \n    ## Specific edges\n    a -> {b}\n  }\n  \n  ## Label definition","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>However, deposition rates are difficult to ignore if we want to account for the formation process of the archaeological record. If these are known to the archaeologists that developed fieldwork, then this would be the behaviour of the model for creating <span class="math inline">\(W/m^2\)</span>.</p>
<div class="grViz html-widget html-fill-item" id="htmlwidget-14334fe4dcfd19071903" style="width:60%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-14334fe4dcfd19071903">{"x":{"diagram":"\n  digraph record_formation {\n  \n    graph [layout = dot, ## Set title and layout\n           label = \"Record formation process\",\n           labelloc = \"t\"\n           fontname = Helvetica,\n           fontsize = 30]\n    \n    # node definitions with substituted label text\n    node [fontname = Helvetica, ## General node definition\n          style = filled,\n          color = MistyRose]\n          \n    ## Per node definition\n    a [label = \"Anthropogenic deposition rates\",\n       fillcolor = orange]\n    b [label = \"Natural deposition rates\",\n       fillcolor = orange]\n    c [label = \"Waste/sqrm\",\n       fillcolor = cadetblue,\n       fixedsize = shape,\n       width = 4.5,\n       height = 1,\n       fontsize = 30]\n    \n    ## General edge definition\n    edge [color = grey,\n           arrowhead = vee,\n           arrowtail = vee]\n    \n    ## Specific edges\n    a -> {c}\n    b -> {c}\n  }\n  \n  ## Label definition","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Finally, if these are not known to the archaeologist, but they want to model them, then we would go back to the first DAG. In this case, keep reading for the specificities of the model.</p>
<p>This is how each variable works specifically:</p>
<ul>
<li><strong>Waste produced</strong> (<span class="math inline">\(W/m^2\)</span> or just <span class="math inline">\(W\)</span>) <strong>(outcome variable)</strong>: Archaeological record present per <span class="math inline">\(m^2\)</span>. Since we are considering C14 dates coming from bone, this is the quantity of C14 samples present a time <em>t</em> and at a depth <em>d</em>. Thus, this variable depends on time and depth.</li>
</ul>
<p><span class="math display">\[W(t,d)=function(t,d)\]</span>.</p>
<p>We have considered this a discrete variable (number of potential samples) with range <span class="math inline">\([0,\propto K]\)</span>. <em>Defined in code as</em> <code>W</code>.</p>
<p>The variables time (<span class="math inline">\(T\)</span>) and depth (<span class="math inline">\(D\)</span>) must also be defined. Thus</p>
<ul>
<li><strong>T</strong> describes the time, discretely, in years, of existence of the site. For the simulation, this time will be known. Thus, in the simulation <span class="math inline">\(T_{birth}=(T=0)\)</span> and <span class="math inline">\(T_{max}=T_{death}\)</span>. Values of <span class="math inline">\(T\)</span> are represented by <span class="math inline">\(t\)</span>.</li>
<li><strong>D</strong> is the depth, in cms, where each specific sample is deposited at a time <span class="math inline">\(t\)</span>. This is a continuous variable with range <span class="math inline">\([0,\infty]\)</span>, and for any <span class="math inline">\(t\)</span>, we know that <span class="math inline">\(0\leq D(t)\leq d_0\)</span> and that</li>
</ul>
<p><span class="math display">\[D(t)=max\{D(t-1)-r,0\} \tag{1},\\ t=1,2,...,T_{max},\]</span></p>
<p>where <span class="math inline">\(r\)</span> is the natural deposition rates.</p>
<ul>
<li><strong>Population (group size)</strong> (<span class="math inline">\(P\)</span>): Discrete variable with range <span class="math inline">\([0,\sim K]\)</span>. Population group size is key to determine anthropogenic deposition rates (which in turn determine <span class="math inline">\(W\)</span>) but it can also be used as a proxy to determine <span class="math inline">\(W\)</span> in case deposition rates are not accounted for since, in any case, <span class="math inline">\(W \propto Pop\)</span>. The model includes the possibility to create a stochastic demographic process (see below), but the user can also set fix values for population or set the parameters in a way that the stochastic process is constrained. In any case, the user does have to provide a value for the carrying capacity (<span class="math inline">\(K\)</span>) as this will limit population growth. <em>Defined in code as</em> <code>Pop</code>.</li>
<li><strong>Anthropogenic deposition</strong> (<span class="math inline">\(A\)</span>): Amount of bone kilogram/year deposited by each group at a time <span class="math inline">\(t\)</span>. This is a continuous variable, with range <span class="math inline">\([0,\infty]\)</span>, measured in <em>Kg</em>. See <em>Anthropogenic deposition protocol</em> for full definition.</li>
<li><strong>Natural deposition rates</strong> (<span class="math inline">\(r\)</span>): This is a continuous variable, with range <span class="math inline">\([0,0.5]\)</span>, measured in <em>cm/year</em>. Because, under normal circumstances, bones are thicker than any possible amount of earth deposited per year, even in a perfectly uncorrupted archaeological sequence (which is what is being modelled here), those would occupy microstrats belonging to different years. This variable is one of the responsibles for how many microstrats will each bone be occupying. See <em>Depth protocol</em> to understand how it works. <em>Defined in code as</em> <code>r</code>.</li>
<li><strong>Site function</strong>: Has not been considered as a variable <em>per se</em> but, rather, as a group of variables, which are defined by the functionality of the site, and that condition the outcome of <span class="math inline">\(A\)</span>. See <em>Anthropogenic deposition protocol</em> to understand how these are modelled.</li>
<li><strong>Site type</strong>: Site type (whether a site is a cave, a rockshelter or an open-air camp) can heavily condition the deposition rates at any archaeological location. However, in order to reduce uncertainty and not make an overcomplex model, we have decided to embed this condition, and the possible expert knowledge related to it, within the definition of the variable <span class="math inline">\(r\)</span>.</li>
</ul>
</div>
<div id="implementation" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Implementation<a href="recgen.html#implementation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This simulation for the creation of the archaeological record has been divided in three phases, or protocols.</p>
<p>The first one has been described in the <a href="popgrowth.html#popgrowth">previous chapter</a>, where we populated the site, according to a stochastic demographic process on top of which migration and war events occurred. Here we focus on how these populations generate waste, and how this waste will be stored in the archaeological record and where. This is done in two steps ; we first generate a sample of waste for each time <span class="math inline">\(t\)</span> and, in second step, we distribute the amount of waste for each depth <span class="math inline">\(d\)</span>.</p>
<p>In order to fully understand the process, first we go through the protocols and functions used.</p>
<div id="population-pop-protocol" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Population <span class="math inline">\(Pop\)</span>-protocol<a href="recgen.html#population-pop-protocol" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before anything, in order to account for the chronological occupation of the site, a demographic process must be produced <em>ie</em> sites need to be occupied. From these occupation a record sample is generated accordingly. This is what his done and described in the <a href="popgrowth.html#popgrowth">previous chapter</a>, but here we will use the function <code>Pop_stoch</code> to generate a simple stochastic growth and apply our loss function to it in order to describe and test the other protocols.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="recgen.html#cb56-1" tabindex="-1"></a>?Pop_stoch</span></code></pre></div>
<p><br></p>
</div>
<div id="anthropogenic-deposition-a-protocol" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Anthropogenic deposition <span class="math inline">\(A\)</span>-protocol<a href="recgen.html#anthropogenic-deposition-a-protocol" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This generates the amount of human waste produced for each <span class="math inline">\(t\)</span> (In kilograms of bone). It is defined as:</p>
<p><span class="math display">\[A(t)= Pop(t)\times O(t)\times F(t) \times G(t),\\ \text{with}\ t = 1,2,...,T_{death} \tag{2}\]</span> Where:</p>
<ul>
<li><span class="math inline">\(Pop(t)\)</span> is a discrete variable representing the number of living people at a time <span class="math inline">\(t\)</span>.</li>
<li><span class="math inline">\(O(t)\)</span> is the proportion of time of the year that the group spends in the camp for each time <span class="math inline">\(t\)</span>. It is a continuous variable with range <span class="math inline">\([0,1]\)</span>. In the code, this is defined as the parameter <code>in_camp_stay</code> and it is provided as the number of weeks, considering 52 the maximum number of weeks for a year.</li>
<li><span class="math inline">\(F(t)\)</span> is the proportion of bone for the full weight of each Kg of an animal consumed for a time <span class="math inline">\(t\)</span>. This is a unit interval variable <span class="math inline">\([0,1]\)</span>.</li>
<li><span class="math inline">\(G(t)\)</span> is the quantity, in Kg, of a (full-weight) animal consumed in a site by each individual at a time <span class="math inline">\(t\)</span>. This is a continuous variable with range <span class="math inline">\([0,\propto K]\)</span>. This is a hierarchical variable, defined as follows:</li>
</ul>
<p><span class="math display">\[G(t)=S(t)\times\frac{C(t)}{R(t)} = S(t)\times\frac{B(t)\times M(t)}{R(t)} \tag{3}\]</span></p>
<p>Where:</p>
<ul>
<li><p><span class="math inline">\(S(t)\)</span> is the proportion of meat consumed within the camp. <span class="math inline">\([0,1]\)</span></p></li>
<li><p><span class="math inline">\(R(t)\)</span> is the quantity of kilocalories produced for each kilogram of meat. This is a continuous with range <span class="math inline">\([1,2.5]\)</span>. Total kilocalories have been divided by 1000 for easier computation.</p></li>
<li><p>And <span class="math inline">\(C(t)\)</span> is the quantity of kilocalories, extracted from meat, consumed by person for each time <span class="math inline">\(t\)</span>. It is in turned is defined as <span class="math inline">\(C(t)=B(t) \times M(t)\)</span>, where</p>
<ul>
<li><p><span class="math inline">\(B(t)\)</span> is the quantity of kilocalories consumed by an individual for each <span class="math inline">\(t\)</span>, and it has a range <span class="math inline">\([1.5,2.5]\times 365\)</span>. For easier computation, the actual average of kilocalories consumed per person/day has been divided by 1000.</p></li>
<li><p><span class="math inline">\(M(t)\)</span> is the proportion of kilocalories coming from meat relating to the total calories consumed per each individual. <span class="math inline">\([0,1]\)</span>.</p></li>
</ul></li>
</ul>
<p>As it can be seen, the above definitions embed the functionality of the site, which can be considered by the user. In practice, setting the variables <span class="math inline">\(O(t) = 1\)</span> and <span class="math inline">\(S(t) = 1\)</span> would eliminate site functionality. This would assume that a site is inhabited by all the group during the full year, and that this group consumes all the food in the site.</p>
<p>Up to now, we have obtained the value for the variable <span class="math inline">\(A\)</span>, which is the amount of kilograms of bone produced at each time <span class="math inline">\(t\)</span>. If we consider 4 grams of non-heated bones per sample, we can extract the number of samples at time <span class="math inline">\(t\)</span>, which we cal <span class="math inline">\(W(t)\)</span></p>
<p><span class="math display">\[W(t)=\mbox{Integer part of } \Bigg(\frac{1000 \times A(t)}{4} \Bigg) \tag{4}\]</span></p>
<p>This protocol is captured in the function <code>A_rates</code>:</p>
You can inspect the <code>A_rates</code> code here:
<details>
<summary>
Show code
</summary>
<p><strong>Code</strong></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="recgen.html#cb57-1" tabindex="-1"></a><span class="do">## Function 5. Simulate anthropogenic deposition</span></span>
<span id="cb57-2"><a href="recgen.html#cb57-2" tabindex="-1"></a>A_rates <span class="ot">&lt;-</span> <span class="cf">function</span>(x,</span>
<span id="cb57-3"><a href="recgen.html#cb57-3" tabindex="-1"></a>                    <span class="at">kcalpers =</span> <span class="dv">2</span>,</span>
<span id="cb57-4"><a href="recgen.html#cb57-4" tabindex="-1"></a>                    <span class="at">kcalmeat_eat =</span> <span class="fl">0.45</span>,</span>
<span id="cb57-5"><a href="recgen.html#cb57-5" tabindex="-1"></a>                    <span class="at">kcalmeat_prod =</span> <span class="fl">1.5</span>,</span>
<span id="cb57-6"><a href="recgen.html#cb57-6" tabindex="-1"></a>                    <span class="at">in_camp_eat =</span> <span class="fl">0.55</span>,</span>
<span id="cb57-7"><a href="recgen.html#cb57-7" tabindex="-1"></a>                    <span class="at">in_camp_stay =</span> <span class="dv">13</span>,</span>
<span id="cb57-8"><a href="recgen.html#cb57-8" tabindex="-1"></a>                    <span class="at">kg =</span> <span class="fl">0.07</span>){</span>
<span id="cb57-9"><a href="recgen.html#cb57-9" tabindex="-1"></a>  </span>
<span id="cb57-10"><a href="recgen.html#cb57-10" tabindex="-1"></a>  </span>
<span id="cb57-11"><a href="recgen.html#cb57-11" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.data.frame</span>(x) <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb57-12"><a href="recgen.html#cb57-12" tabindex="-1"></a>    P <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb57-13"><a href="recgen.html#cb57-13" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb57-14"><a href="recgen.html#cb57-14" tabindex="-1"></a>    P <span class="ot">&lt;-</span> x</span>
<span id="cb57-15"><a href="recgen.html#cb57-15" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb57-16"><a href="recgen.html#cb57-16" tabindex="-1"></a>    P <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb57-17"><a href="recgen.html#cb57-17" tabindex="-1"></a>  }</span>
<span id="cb57-18"><a href="recgen.html#cb57-18" tabindex="-1"></a>  </span>
<span id="cb57-19"><a href="recgen.html#cb57-19" tabindex="-1"></a>  <span class="co"># Check variable values are within the defined ranges</span></span>
<span id="cb57-20"><a href="recgen.html#cb57-20" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fl">1.5</span> <span class="sc">&lt;=</span> kcalpers <span class="sc">&amp;</span> kcalpers <span class="sc">&lt;=</span> <span class="fl">2.5</span>){</span>
<span id="cb57-21"><a href="recgen.html#cb57-21" tabindex="-1"></a>    B <span class="ot">&lt;-</span> kcalpers<span class="sc">*</span><span class="dv">365</span></span>
<span id="cb57-22"><a href="recgen.html#cb57-22" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb57-23"><a href="recgen.html#cb57-23" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&#39;kcalpers must be within [1.5, 2.5]&#39;</span>)</span>
<span id="cb57-24"><a href="recgen.html#cb57-24" tabindex="-1"></a>  }</span>
<span id="cb57-25"><a href="recgen.html#cb57-25" tabindex="-1"></a>  </span>
<span id="cb57-26"><a href="recgen.html#cb57-26" tabindex="-1"></a>  <span class="cf">if</span> (<span class="dv">0</span> <span class="sc">&lt;=</span> kcalmeat_eat <span class="sc">&amp;</span> kcalmeat_eat <span class="sc">&lt;=</span> <span class="dv">1</span>) {</span>
<span id="cb57-27"><a href="recgen.html#cb57-27" tabindex="-1"></a>    M <span class="ot">&lt;-</span> kcalmeat_eat</span>
<span id="cb57-28"><a href="recgen.html#cb57-28" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb57-29"><a href="recgen.html#cb57-29" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&#39;kcalmeat_eat must be within [0, 1]&#39;</span>)</span>
<span id="cb57-30"><a href="recgen.html#cb57-30" tabindex="-1"></a>  }</span>
<span id="cb57-31"><a href="recgen.html#cb57-31" tabindex="-1"></a>  </span>
<span id="cb57-32"><a href="recgen.html#cb57-32" tabindex="-1"></a>  <span class="cf">if</span> (<span class="dv">1</span> <span class="sc">&lt;=</span> kcalmeat_prod <span class="sc">&amp;</span> kcalmeat_prod <span class="sc">&lt;</span> <span class="fl">2.5</span>) {</span>
<span id="cb57-33"><a href="recgen.html#cb57-33" tabindex="-1"></a>    R <span class="ot">&lt;-</span> kcalmeat_prod</span>
<span id="cb57-34"><a href="recgen.html#cb57-34" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb57-35"><a href="recgen.html#cb57-35" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&#39;kcalmeat_prod must be within [1, 25]&#39;</span>)</span>
<span id="cb57-36"><a href="recgen.html#cb57-36" tabindex="-1"></a>  }</span>
<span id="cb57-37"><a href="recgen.html#cb57-37" tabindex="-1"></a>  </span>
<span id="cb57-38"><a href="recgen.html#cb57-38" tabindex="-1"></a>  <span class="cf">if</span> (<span class="dv">0</span> <span class="sc">&lt;=</span> in_camp_eat <span class="sc">&amp;</span> in_camp_eat <span class="sc">&lt;=</span> <span class="dv">1</span>){</span>
<span id="cb57-39"><a href="recgen.html#cb57-39" tabindex="-1"></a>    S <span class="ot">&lt;-</span> in_camp_eat</span>
<span id="cb57-40"><a href="recgen.html#cb57-40" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb57-41"><a href="recgen.html#cb57-41" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&#39;in_camp_eat must be within [0, 1]&#39;</span>)</span>
<span id="cb57-42"><a href="recgen.html#cb57-42" tabindex="-1"></a>  }</span>
<span id="cb57-43"><a href="recgen.html#cb57-43" tabindex="-1"></a>  </span>
<span id="cb57-44"><a href="recgen.html#cb57-44" tabindex="-1"></a>  <span class="cf">if</span> (in_camp_stay <span class="sc">&lt;=</span> <span class="dv">52</span>){</span>
<span id="cb57-45"><a href="recgen.html#cb57-45" tabindex="-1"></a>    O <span class="ot">&lt;-</span> <span class="fu">round</span>(in_camp_stay<span class="sc">/</span><span class="dv">52</span>,<span class="dv">2</span>)</span>
<span id="cb57-46"><a href="recgen.html#cb57-46" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb57-47"><a href="recgen.html#cb57-47" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&#39;A year cannot have more than 52 weeks&#39;</span>)</span>
<span id="cb57-48"><a href="recgen.html#cb57-48" tabindex="-1"></a>  }</span>
<span id="cb57-49"><a href="recgen.html#cb57-49" tabindex="-1"></a>  </span>
<span id="cb57-50"><a href="recgen.html#cb57-50" tabindex="-1"></a>  C <span class="ot">&lt;-</span> B<span class="sc">*</span>M</span>
<span id="cb57-51"><a href="recgen.html#cb57-51" tabindex="-1"></a>  G <span class="ot">&lt;-</span> (C <span class="sc">*</span> S) <span class="sc">/</span> R <span class="do">## Quantity (in kg) of animal consumed per person in camp during year t</span></span>
<span id="cb57-52"><a href="recgen.html#cb57-52" tabindex="-1"></a>  A <span class="ot">&lt;-</span> P <span class="sc">*</span> O <span class="sc">*</span> kg <span class="sc">*</span> G <span class="do">## kilograms of meat consumed within a camp by the group</span></span>
<span id="cb57-53"><a href="recgen.html#cb57-53" tabindex="-1"></a>  W <span class="ot">&lt;-</span> <span class="fu">round</span>((<span class="dv">1000</span> <span class="sc">*</span> A) <span class="sc">/</span> <span class="dv">4</span>) <span class="do">## samples extracted from that meat</span></span>
<span id="cb57-54"><a href="recgen.html#cb57-54" tabindex="-1"></a>  </span>
<span id="cb57-55"><a href="recgen.html#cb57-55" tabindex="-1"></a>  <span class="fu">return</span>(W)</span>
<span id="cb57-56"><a href="recgen.html#cb57-56" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
<div id="depth-d-protocol" class="section level3 hasAnchor" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Depth <span class="math inline">\(D\)</span>-protocol<a href="recgen.html#depth-d-protocol" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This protocol is designed to respond to the fact that, despite a bone is deposited at time <span class="math inline">\(t\)</span>, it can occupy the estratigraphic space of many subsequent years until it is fully buried. The amount of years it takes to be fully buried depends on the thickness of the bone and the natural deposition rates <span class="math inline">\(r\)</span>.</p>
<p>Since the thickest bones are usually the minority within a sample, while the majority is usually conformed of smaller bones, we have considered that bone presence decreases exponentially from <span class="math inline">\(t_0\)</span>, the year when it was deposited. Thus, this process is modeled as follows:</p>
<p><span class="math display">\[W_b(t_u,t_l)=W(t=t_l)\times(1-e^{-\lambda(t_u-t_l)}),\ t_u &lt; t_l \tag{5}\]</span></p>
<p>Where</p>
<ul>
<li><span class="math inline">\(W\)</span> as defined before, it is the number of samples deposited at a time <span class="math inline">\(t_l\)</span></li>
<li><span class="math inline">\(W_b\)</span>: is the number of samples buried at a time <span class="math inline">\(t_u\)</span> from the ones generated at <span class="math inline">\(t_l\)</span>. Thus, <span class="math inline">\(t_u \geq t_l\)</span></li>
<li><span class="math inline">\(t_l\)</span> is the moment in time <span class="math inline">\(t\)</span> when the samples <span class="math inline">\(W\)</span> are deposited.</li>
<li><span class="math inline">\(t_u\)</span> is each time <span class="math inline">\(t\)</span>, <span class="math inline">\(t \geq t_l\)</span>, when the sample is being buried according to the parameter <span class="math inline">\(r\)</span>.</li>
<li>At <span class="math inline">\(t_{u_{max}}\)</span>, the sample is completely buried. <span class="math inline">\(t_{u_{max}}&gt;=t_u&gt;=t_l\)</span></li>
</ul>
<p><span class="math inline">\(t_{u_{max}}\)</span> depends on two factors:</p>
<ul>
<li><span class="math inline">\(L\)</span> is maximum thickness of the thickest bone in the direction of the deposition, in cm.</li>
<li><span class="math inline">\(r\)</span> is the natural deposition rate, in <span class="math inline">\(\mbox{cm/year}\)</span>. For this model, we have considered the values 0.1, 0.2, 0.3, 0.4 and 0.5</li>
</ul>
<p>Thus we can calculate the time it takes for a sample to be fully buried as</p>
<p><span class="math display">\[r = \frac{L}{t_{u_{max}}} \Rightarrow t_{u_{max}}=\frac{L}{r} \tag{6}\]</span></p>
<p><strong>Estimation of</strong> <span class="math inline">\(\lambda\)</span></p>
<p>Now we need to estimate the exponential rate <span class="math inline">\(\lambda\)</span> in equation <span class="math inline">\((5)\)</span>. In order to do so, we consider the state of the model when <span class="math inline">\(t_l=0\)</span> and <span class="math inline">\(t_u=t_{u_{max}}\)</span>, which marks the time at which the first samples deposited are completely buried. And consider the following</p>
<p><span class="math display">\[\frac{W_b(t_u,t_l)}{W(t=t_l)} \tag{7}\]</span></p>
<p>is the proportion of buried samples in <span class="math inline">\(t_{u}\)</span> from the ones that were deposited in <span class="math inline">\(t_l\)</span>. Thus, if we substitute the time points specified above and plug in equation 5, we have that</p>
<p><span class="math display">\[\frac{W_b(t_u=t_{u_{max}},t_l)}{W(t_l=1)}=1-e^{-t_{u_{max}}\lambda} \tag{8}\]</span></p>
<p>However, since we consider that all of the samples buried in <span class="math inline">\(t_{u_{max}}\)</span>, then the proportion on the left hand side is 1, and in this situation <span class="math inline">\(\lambda \rightarrow \infty\)</span> so we cannot use the equation. We can especify an error margin, <span class="math inline">\(\theta_e\)</span> to the proportion of buried samples in <span class="math inline">\(t_{u_{max}}\)</span>, say <span class="math inline">\(99\%\)</span>. In this case, <span class="math inline">\(\lambda\)</span> can be easily computed as follows</p>
<p><span class="math display">\[\theta_e=1-e^{-\lambda t_{u_{max}}}\]</span></p>
<p>and thus, solving for <span class="math inline">\(\lambda\)</span> and taking logarithms on both sides,</p>
<p><span class="math display">\[\lambda=\frac{-log(1-\theta_e)}{t_{u_{max}}} \tag{9}\]</span></p>
<p>Where <span class="math inline">\(\theta_b&lt;1\)</span> is the proportion of buried samples in <span class="math inline">\(t_{u_{max}}\)</span>, which is calculated in equation 6.</p>
<p>At the end, the function <code>Rec_c</code> runs <code>D_along</code> over a period of time, effectively producing an archaeological record. In the function <code>Rec_c</code> the user can consider whether to divide the total sample by the area of the site, or not. In addition, the user can use the modeled values (with the functions above) as an input to this function, or introduce them directly, for example, in the case that fix population rates per year were preferred.</p>
<p>The function <code>D_along</code> captures this process.</p>
<p>As usual, you can learn all about the parameters of <code>D_rates</code> and <code>Rec_c</code></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="recgen.html#cb58-1" tabindex="-1"></a>?D_along</span>
<span id="cb58-2"><a href="recgen.html#cb58-2" tabindex="-1"></a>?Rec_c</span></code></pre></div>
<p><br></p>
As before, you can check the code here:
<details>
<summary>
Show code
</summary>
<p><strong>Code</strong></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="recgen.html#cb59-1" tabindex="-1"></a><span class="do">## Function 6. Depth protocol deposition</span></span>
<span id="cb59-2"><a href="recgen.html#cb59-2" tabindex="-1"></a>D_along <span class="ot">&lt;-</span> <span class="cf">function</span>(W_t, r, <span class="at">max_bone_thickness =</span> <span class="fu">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&#39;s&#39;</span>, <span class="st">&#39;l&#39;</span>, <span class="st">&#39;vl&#39;</span>),</span>
<span id="cb59-3"><a href="recgen.html#cb59-3" tabindex="-1"></a>                    <span class="at">prop_buried =</span> .<span class="dv">9999</span>){</span>
<span id="cb59-4"><a href="recgen.html#cb59-4" tabindex="-1"></a>  </span>
<span id="cb59-5"><a href="recgen.html#cb59-5" tabindex="-1"></a>  <span class="co"># Define parameter r</span></span>
<span id="cb59-6"><a href="recgen.html#cb59-6" tabindex="-1"></a>  <span class="cf">if</span>(r <span class="sc">&gt;</span> <span class="fl">0.5</span>) <span class="fu">stop</span>(<span class="st">&quot;values &gt; 0.5 are not accepted for param &#39;r&#39;&quot;</span>)</span>
<span id="cb59-7"><a href="recgen.html#cb59-7" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">round</span>(r, <span class="dv">1</span>)</span>
<span id="cb59-8"><a href="recgen.html#cb59-8" tabindex="-1"></a>  <span class="co"># Constraints for parameter Pb</span></span>
<span id="cb59-9"><a href="recgen.html#cb59-9" tabindex="-1"></a>  <span class="cf">if</span> (prop_buried <span class="sc">&gt;=</span> <span class="dv">1</span>) <span class="fu">stop</span>(<span class="st">&quot;Pb must be lower than 1&quot;</span>)</span>
<span id="cb59-10"><a href="recgen.html#cb59-10" tabindex="-1"></a>  </span>
<span id="cb59-11"><a href="recgen.html#cb59-11" tabindex="-1"></a>  <span class="co"># Define parameter Max_bone_thickness (L)</span></span>
<span id="cb59-12"><a href="recgen.html#cb59-12" tabindex="-1"></a>  max_bone_thickness <span class="ot">=</span> <span class="fu">match.arg</span>(max_bone_thickness)</span>
<span id="cb59-13"><a href="recgen.html#cb59-13" tabindex="-1"></a>  <span class="cf">if</span> (max_bone_thickness <span class="sc">==</span> <span class="st">&#39;s&#39;</span>){</span>
<span id="cb59-14"><a href="recgen.html#cb59-14" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fl">2.5</span></span>
<span id="cb59-15"><a href="recgen.html#cb59-15" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (max_bone_thickness <span class="sc">==</span> <span class="st">&#39;m&#39;</span>){</span>
<span id="cb59-16"><a href="recgen.html#cb59-16" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb59-17"><a href="recgen.html#cb59-17" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (max_bone_thickness <span class="sc">==</span> <span class="st">&#39;l&#39;</span>){</span>
<span id="cb59-18"><a href="recgen.html#cb59-18" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb59-19"><a href="recgen.html#cb59-19" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (max_bone_thickness <span class="sc">==</span> <span class="st">&#39;vl&#39;</span>){</span>
<span id="cb59-20"><a href="recgen.html#cb59-20" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb59-21"><a href="recgen.html#cb59-21" tabindex="-1"></a>  }</span>
<span id="cb59-22"><a href="recgen.html#cb59-22" tabindex="-1"></a>  </span>
<span id="cb59-23"><a href="recgen.html#cb59-23" tabindex="-1"></a>  <span class="co"># Define tmax</span></span>
<span id="cb59-24"><a href="recgen.html#cb59-24" tabindex="-1"></a>  tm <span class="ot">&lt;-</span> L<span class="sc">/</span>r</span>
<span id="cb59-25"><a href="recgen.html#cb59-25" tabindex="-1"></a>  <span class="co"># Estimate lambda</span></span>
<span id="cb59-26"><a href="recgen.html#cb59-26" tabindex="-1"></a>  l <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> prop_buried) <span class="sc">/</span> tm</span>
<span id="cb59-27"><a href="recgen.html#cb59-27" tabindex="-1"></a>  </span>
<span id="cb59-28"><a href="recgen.html#cb59-28" tabindex="-1"></a>  ss <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">round</span>(tm)) <span class="do">## Vector to distribute samples over</span></span>
<span id="cb59-29"><a href="recgen.html#cb59-29" tabindex="-1"></a>  tl <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># Year where the sample is deposited</span></span>
<span id="cb59-30"><a href="recgen.html#cb59-30" tabindex="-1"></a>  tu <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Year when it is covered</span></span>
<span id="cb59-31"><a href="recgen.html#cb59-31" tabindex="-1"></a>  </span>
<span id="cb59-32"><a href="recgen.html#cb59-32" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>tm){</span>
<span id="cb59-33"><a href="recgen.html#cb59-33" tabindex="-1"></a>    Wb <span class="ot">&lt;-</span> W_t <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>l<span class="sc">*</span>(tu<span class="sc">-</span>tl))) <span class="co"># Apply formula for tu</span></span>
<span id="cb59-34"><a href="recgen.html#cb59-34" tabindex="-1"></a>    Wbprev <span class="ot">&lt;-</span> W_t <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>l<span class="sc">*</span>((tu<span class="dv">-1</span>)<span class="sc">-</span>tl))) <span class="co"># Calculate for previous to tu</span></span>
<span id="cb59-35"><a href="recgen.html#cb59-35" tabindex="-1"></a>    ss[i] <span class="ot">&lt;-</span> <span class="fu">round</span>(Wb <span class="sc">-</span> Wbprev) <span class="co"># Number of samples for each year</span></span>
<span id="cb59-36"><a href="recgen.html#cb59-36" tabindex="-1"></a>    tu <span class="ot">&lt;-</span> tu <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb59-37"><a href="recgen.html#cb59-37" tabindex="-1"></a>  }</span>
<span id="cb59-38"><a href="recgen.html#cb59-38" tabindex="-1"></a>  </span>
<span id="cb59-39"><a href="recgen.html#cb59-39" tabindex="-1"></a>  <span class="fu">return</span>(ss)</span>
<span id="cb59-40"><a href="recgen.html#cb59-40" tabindex="-1"></a>}</span>
<span id="cb59-41"><a href="recgen.html#cb59-41" tabindex="-1"></a></span>
<span id="cb59-42"><a href="recgen.html#cb59-42" tabindex="-1"></a><span class="do">## 7. Archaeological deposition record</span></span>
<span id="cb59-43"><a href="recgen.html#cb59-43" tabindex="-1"></a>Rec_c <span class="ot">&lt;-</span> <span class="cf">function</span>(x, area, ts, InitBP, <span class="at">persqm =</span> <span class="cn">FALSE</span>, ...){</span>
<span id="cb59-44"><a href="recgen.html#cb59-44" tabindex="-1"></a>  </span>
<span id="cb59-45"><a href="recgen.html#cb59-45" tabindex="-1"></a>  <span class="do">## Whether sqm division must be included or not</span></span>
<span id="cb59-46"><a href="recgen.html#cb59-46" tabindex="-1"></a>  <span class="cf">if</span> (persqm <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb59-47"><a href="recgen.html#cb59-47" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x <span class="sc">/</span> area</span>
<span id="cb59-48"><a href="recgen.html#cb59-48" tabindex="-1"></a>  }</span>
<span id="cb59-49"><a href="recgen.html#cb59-49" tabindex="-1"></a>  </span>
<span id="cb59-50"><a href="recgen.html#cb59-50" tabindex="-1"></a>  <span class="do">## Spread dates along different depths</span></span>
<span id="cb59-51"><a href="recgen.html#cb59-51" tabindex="-1"></a>  matdim <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb59-52"><a href="recgen.html#cb59-52" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span>matdim, <span class="at">ncol=</span>matdim)</span>
<span id="cb59-53"><a href="recgen.html#cb59-53" tabindex="-1"></a>  </span>
<span id="cb59-54"><a href="recgen.html#cb59-54" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>matdim){</span>
<span id="cb59-55"><a href="recgen.html#cb59-55" tabindex="-1"></a>    new <span class="ot">&lt;-</span> <span class="fu">D_along</span>(x[i], ...)</span>
<span id="cb59-56"><a href="recgen.html#cb59-56" tabindex="-1"></a>    st <span class="ot">&lt;-</span> i <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb59-57"><a href="recgen.html#cb59-57" tabindex="-1"></a>    pos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, st), new)</span>
<span id="cb59-58"><a href="recgen.html#cb59-58" tabindex="-1"></a>    pos <span class="ot">&lt;-</span> pos[<span class="dv">1</span><span class="sc">:</span>matdim]</span>
<span id="cb59-59"><a href="recgen.html#cb59-59" tabindex="-1"></a>    mat[, i] <span class="ot">&lt;-</span> pos</span>
<span id="cb59-60"><a href="recgen.html#cb59-60" tabindex="-1"></a>  }</span>
<span id="cb59-61"><a href="recgen.html#cb59-61" tabindex="-1"></a>  mat[<span class="fu">is.na</span>(mat)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb59-62"><a href="recgen.html#cb59-62" tabindex="-1"></a>  </span>
<span id="cb59-63"><a href="recgen.html#cb59-63" tabindex="-1"></a>  <span class="do">## Names for columns (each year)</span></span>
<span id="cb59-64"><a href="recgen.html#cb59-64" tabindex="-1"></a>  years <span class="ot">&lt;-</span> <span class="fu">seq</span>(InitBP, InitBP<span class="sc">-</span>ts)</span>
<span id="cb59-65"><a href="recgen.html#cb59-65" tabindex="-1"></a>  <span class="fu">colnames</span>(mat) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(years, <span class="st">&quot; BP&quot;</span>)[<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(mat)]</span>
<span id="cb59-66"><a href="recgen.html#cb59-66" tabindex="-1"></a>  </span>
<span id="cb59-67"><a href="recgen.html#cb59-67" tabindex="-1"></a>  <span class="do">## Names for rows (each depth)</span></span>
<span id="cb59-68"><a href="recgen.html#cb59-68" tabindex="-1"></a>  <span class="co"># Extract arguments as a list</span></span>
<span id="cb59-69"><a href="recgen.html#cb59-69" tabindex="-1"></a>  extract_args <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...){ </span>
<span id="cb59-70"><a href="recgen.html#cb59-70" tabindex="-1"></a>    extras <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb59-71"><a href="recgen.html#cb59-71" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">extras=</span>extras)) </span>
<span id="cb59-72"><a href="recgen.html#cb59-72" tabindex="-1"></a>  }</span>
<span id="cb59-73"><a href="recgen.html#cb59-73" tabindex="-1"></a>  </span>
<span id="cb59-74"><a href="recgen.html#cb59-74" tabindex="-1"></a>  dr <span class="ot">&lt;-</span> <span class="fu">extract_args</span>(D_along, ...)</span>
<span id="cb59-75"><a href="recgen.html#cb59-75" tabindex="-1"></a>  dr <span class="ot">&lt;-</span> dr<span class="sc">$</span>extras<span class="sc">$</span>r</span>
<span id="cb59-76"><a href="recgen.html#cb59-76" tabindex="-1"></a>  </span>
<span id="cb59-77"><a href="recgen.html#cb59-77" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">cumsum</span>(<span class="fu">rep</span>(dr, <span class="fu">nrow</span>(mat)))) <span class="do">## computes depths</span></span>
<span id="cb59-78"><a href="recgen.html#cb59-78" tabindex="-1"></a>  <span class="fu">rownames</span>(mat) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;d = &quot;</span>, d, <span class="st">&quot; cm&quot;</span>)</span>
<span id="cb59-79"><a href="recgen.html#cb59-79" tabindex="-1"></a>  </span>
<span id="cb59-80"><a href="recgen.html#cb59-80" tabindex="-1"></a>  <span class="fu">return</span>(mat)</span>
<span id="cb59-81"><a href="recgen.html#cb59-81" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
</div>
<div id="minimal-example-and-simulation" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Minimal example and simulation<a href="recgen.html#minimal-example-and-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>With the above functions, the user can apply to any generative demographic process: (1) how many samples would a group of people produce in a site, according to different constraints and (2) how those dates distribute along the depth of a site under the assumption that there has not been any kind of record loss or post-depositional process (this will be modelled in a second layer of modelling).</p>
<p>We can create a very basic and simple simulation to illustrate these processes following the parameters seen below (or defaults in function definitions above) following these steps:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(Pop\)</span>-protocol. Using <code>Pop_stoch</code>, we generate a stochastic population dynamic that will give us the number of individuals for each year.</li>
<li><span class="math inline">\(A\)</span>-protocol. Knowing the population size per year, we apply <code>A_rates</code> to each of them and generate the anthropogenic deposition, and get the number of samples per year.</li>
<li><span class="math inline">\(D\)</span>-protocol. Knowing how many samples are generates each year, using <code>Rec_c</code>, we distribute them along the depth record.</li>
</ol>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="recgen.html#cb60-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb60-2"><a href="recgen.html#cb60-2" tabindex="-1"></a><span class="co"># 1. Pop-protocol</span></span>
<span id="cb60-3"><a href="recgen.html#cb60-3" tabindex="-1"></a>Ps <span class="ot">&lt;-</span> <span class="fu">Pop_stoch</span>(<span class="at">pop_size=</span><span class="dv">100</span>, <span class="at">ts=</span><span class="dv">100</span>, <span class="at">K=</span><span class="dv">150</span>)</span>
<span id="cb60-4"><a href="recgen.html#cb60-4" tabindex="-1"></a><span class="co"># 2. A-protocol</span></span>
<span id="cb60-5"><a href="recgen.html#cb60-5" tabindex="-1"></a>samp <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(Ps, A_rates)) <span class="do">## Extract sample per time steps</span></span>
<span id="cb60-6"><a href="recgen.html#cb60-6" tabindex="-1"></a><span class="co"># 3. D-protocol</span></span>
<span id="cb60-7"><a href="recgen.html#cb60-7" tabindex="-1"></a>Rec <span class="ot">&lt;-</span> <span class="fu">Rec_c</span>(samp, <span class="at">InitBP =</span> <span class="dv">7500</span>, <span class="at">ts =</span> <span class="dv">100</span>, <span class="at">r =</span> <span class="fl">0.2</span>, <span class="at">max_bone_thickness =</span> <span class="st">&quot;m&quot;</span>)</span></code></pre></div>
<p>With this we obtain, among other things, the distribution of the samples deposited for each date along the depth of the sit, and its comparison to the total population. For better comprehension, we have decided not to include all of the dates in the plot below, but only some of them as an example. The user can also check how the model works and its results <a href="https://acortell3.shinyapps.io/archaeo_record_model">here</a>. <em>The total number of population has been adapted for visualisation</em></p>
<p><img src="_main_files/figure-html/visu-record-1.png" width="672" /><img src="_main_files/figure-html/visu-record-2.png" width="672" /></p>
<p>Notice the exponential decay in the amount of samples per depth layer for the same year.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="main-simu.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="recloss.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
