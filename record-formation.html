<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Record formation | Methods Riddles, the ultimate revelations</title>
  <meta name="description" content="First draft of Rbookdown to describe how data have been generated" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Record formation | Methods Riddles, the ultimate revelations" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="First draft of Rbookdown to describe how data have been generated" />
  <meta name="github-repo" content="acortell3/archaeoriddle" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Record formation | Methods Riddles, the ultimate revelations" />
  
  <meta name="twitter:description" content="First draft of Rbookdown to describe how data have been generated" />
  

<meta name="author" content="CDAL" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="population-growth-on-multiple-sites.html"/>
<link rel="next" href="record-loss.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.11/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-archaeoriddle"><i class="fa fa-check"></i><b>1.1</b> What is archaeoriddle?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-will-you-find-in-this-bookdown"><i class="fa fa-check"></i><b>1.2</b> What will you find in this bookdown?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-can-you-do-with-this"><i class="fa fa-check"></i><b>1.3</b> What can you do with this?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="landscape-climate-environment.html"><a href="landscape-climate-environment.html"><i class="fa fa-check"></i><b>2</b> Landscape, climate &amp; Environment</a>
<ul>
<li class="chapter" data-level="2.1" data-path="landscape-climate-environment.html"><a href="landscape-climate-environment.html#temperature-and-climate"><i class="fa fa-check"></i><b>2.1</b> Temperature and climate</a></li>
<li class="chapter" data-level="2.2" data-path="landscape-climate-environment.html"><a href="landscape-climate-environment.html#slope-and-elevation"><i class="fa fa-check"></i><b>2.2</b> Slope and Elevation</a></li>
<li class="chapter" data-level="2.3" data-path="landscape-climate-environment.html"><a href="landscape-climate-environment.html#settlements-position"><i class="fa fa-check"></i><b>2.3</b> Settlements position</a></li>
<li class="chapter" data-level="2.4" data-path="landscape-climate-environment.html"><a href="landscape-climate-environment.html#network-site-size-and-climate-deprecated"><i class="fa fa-check"></i><b>2.4</b> Network, Site Size And Climate â€“ DEPRECATED</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="population-growth-on-multiple-sites.html"><a href="population-growth-on-multiple-sites.html"><i class="fa fa-check"></i><b>3</b> Population growth on multiple sites</a>
<ul>
<li class="chapter" data-level="3.1" data-path="population-growth-on-multiple-sites.html"><a href="population-growth-on-multiple-sites.html#environmental-resources"><i class="fa fa-check"></i><b>3.1</b> Environmental resources</a></li>
<li class="chapter" data-level="3.2" data-path="population-growth-on-multiple-sites.html"><a href="population-growth-on-multiple-sites.html#initial-sites-and-size"><i class="fa fa-check"></i><b>3.2</b> Initial sites and size:</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="record-formation.html"><a href="record-formation.html"><i class="fa fa-check"></i><b>4</b> Record formation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="record-formation.html"><a href="record-formation.html#theoretical-model"><i class="fa fa-check"></i><b>4.1</b> Theoretical model</a></li>
<li class="chapter" data-level="4.2" data-path="record-formation.html"><a href="record-formation.html#implementation"><i class="fa fa-check"></i><b>4.2</b> Implementation</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="record-formation.html"><a href="record-formation.html#population-pop-protocol"><i class="fa fa-check"></i><b>4.2.1</b> Population <span class="math inline">\(Pop\)</span>-protocol</a></li>
<li class="chapter" data-level="4.2.2" data-path="record-formation.html"><a href="record-formation.html#anthropogenic-deposition-a-protocol"><i class="fa fa-check"></i><b>4.2.2</b> Anthropogenic deposition <span class="math inline">\(A\)</span>-protocol</a></li>
<li class="chapter" data-level="4.2.3" data-path="record-formation.html"><a href="record-formation.html#depth-d-protocol"><i class="fa fa-check"></i><b>4.2.3</b> Depth <span class="math inline">\(D\)</span>-protocol</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="record-formation.html"><a href="record-formation.html#example-and-simulation"><i class="fa fa-check"></i><b>4.3</b> Example and simulation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="record-loss.html"><a href="record-loss.html"><i class="fa fa-check"></i><b>5</b> Record loss</a>
<ul>
<li class="chapter" data-level="5.1" data-path="record-loss.html"><a href="record-loss.html#theoretical-model-1"><i class="fa fa-check"></i><b>5.1</b> Theoretical model</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="record-loss.html"><a href="record-loss.html#general-purpose"><i class="fa fa-check"></i><b>5.1.1</b> General purpose</a></li>
<li class="chapter" data-level="5.1.2" data-path="record-loss.html"><a href="record-loss.html#model-layers"><i class="fa fa-check"></i><b>5.1.2</b> Model layers</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="record-loss.html"><a href="record-loss.html#implementation-1"><i class="fa fa-check"></i><b>5.2</b> Implementation</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="final-choice-and-simulation.html"><a href="final-choice-and-simulation.html"><i class="fa fa-check"></i><b>6</b> Final Choice and simulation</a></li>
<li class="chapter" data-level="7" data-path="generate-archaeological-remaind-and-squares.html"><a href="generate-archaeological-remaind-and-squares.html"><i class="fa fa-check"></i><b>7</b> Generate Archaeological remaind and squares</a>
<ul>
<li class="chapter" data-level="7.1" data-path="generate-archaeological-remaind-and-squares.html"><a href="generate-archaeological-remaind-and-squares.html#using-sites-size-to-generate-deposite"><i class="fa fa-check"></i><b>7.1</b> Using sites size to generate deposite</a></li>
<li class="chapter" data-level="7.2" data-path="generate-archaeological-remaind-and-squares.html"><a href="generate-archaeological-remaind-and-squares.html#split-environment-in-a-grid"><i class="fa fa-check"></i><b>7.2</b> Split environment in a grid</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/acortell3/archaeoriddle/">
source</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Methods Riddles, the ultimate revelations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="record-formation" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Record formation<a href="record-formation.html#record-formation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="theoretical-model" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Theoretical model<a href="record-formation.html#theoretical-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We have produced a computational model, replicating the process of formation of the archaeological record in a specific site, accounting for different variables. In order to consider the possible relation between those variables, we have decided to express them as a Directed Acyclic Graph (DAG), following the ECS-DAG methodology proposed by Ferguson et al.Â (2020). In this case, however, and because our goal is to obtain an accurate initial template for the development of the model, we have not considered setting an exposure variable, but rather to propose different theoretical directional and causal relationships without relying on the conventional exposure-outcome assessment. Therefore, highlights in the graph below do not intend to differentiate among confounders, mediators, etc., but to emphasize the possible weight that each variable has for producing the outcome (produced waste by <span class="math inline">\(m^2\)</span>).</p>
<div class="grViz html-widget html-fill-item" id="htmlwidget-29293f0b395177c519c4" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-29293f0b395177c519c4">{"x":{"diagram":"\n  digraph record_formation {\n  \n    graph [layout = dot, ## Set title and layout\n           label = \"Record formation process\",\n           labelloc = \"t\"\n           fontname = Helvetica,\n           fontsize = 30]\n    \n    # node definitions with substituted label text\n    node [fontname = Helvetica, ## General node definition\n          style = filled,\n          color = MistyRose]\n          \n    ## Per node definition\n    a [label = \"Pop (group size)\",\n       fillcolor = orange]\n    b [label = \"Site function\",\n       fillcolor = cadetblue1]\n    c [label = \"Anthropogenic deposition rates\",\n       fillcolor = orange]\n    d [label = \"Site type\",\n       fillcolor = cadetblue1]\n    e [label = \"Natural deposition rates\",\n       fillcolor = orange]\n    f [label = \"Waste/sqrm\",\n       fillcolor = cadetblue,\n       fixedsize = shape,\n       width = 4.5,\n       height = 1,\n       fontsize = 30]\n    \n    ## General edge definition\n    edge [color = grey,\n           arrowhead = vee,\n           arrowtail = vee]\n    \n    ## Specific edges\n    a -> {c}\n    b -> {c}\n    c -> {f}\n    d -> {e}\n    e -> {f}\n  }\n  \n  ## Label definition","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>The above graph depicts a very schematic way to represent the formation of the archaeological record (<span class="math inline">\(W/m^2\)</span>). In this case, we are interested in radiocarbon dating, focusing on bone samples; that is the number (and range) of potential 14C dates produced in a site, and this is key to understand the way in which we produced the model. We are aware that generating a specific archaeological palimpsest depends on a large quantity of variables, some of which may be controlled by field archaeologists and some of which may not (or are not). Therefore, the graph above must be read as follows. Asides from the outcome variable, the exposure variables, <em>Pop (group size)</em>, <em>Anthropogenic deposition rates</em> and <em>Natural deposition rates</em> (depicted in orange), are designed in a way that they can be activated for the model to infer them, they can be provided by the archaeologist, or they can be simply ignored. In the most elementary case, the archaeologist could introduce directly the outcome variable (<span class="math inline">\(W/m^2\)</span>) without taking into account anything else, if she/he is confident to provide an accurate value.</p>
<p>However, in most cases, this information will not be known to the field researcher, and in this situation, these variables can be modeled to different extents of complexity. While, for example, in the case of the most simple simulation, the field archaeologist could ignore deposition rates. In this case, and because we are only considering 14C dates, then the quantity of the sample becomes broadly proportional to the number of people present in a site, and thus it could be modeled like this.</p>
<div class="grViz html-widget html-fill-item" id="htmlwidget-037f178f6b7cafa79829" style="width:50%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-037f178f6b7cafa79829">{"x":{"diagram":"\n  digraph record_formation {\n  \n    graph [layout = dot, ## Set title and layout\n           label = \"Record formation process\",\n           labelloc = \"t\"\n           fontname = Helvetica,\n           fontsize = 30]\n    \n    # node definitions with substituted label text\n    node [fontname = Helvetica, ## General node definition\n          style = filled,\n          color = MistyRose]\n           \n    ## Per node definition\n    a [label = \"Pop (group size)\",\n       fillcolor = orange]\n    b [label = \"Waste/sqrm\",\n       fillcolor = cadetblue,\n       fixedsize = shape,\n       width = 4.5,\n       height = 1,\n       fontsize = 30]\n    \n    ## General edge definition\n    edge [color = grey,\n           arrowhead = vee,\n           arrowtail = vee]\n    \n    ## Specific edges\n    a -> {b}\n  }\n  \n  ## Label definition","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>However, deposition rates are difficult to ignore if we want to account for the formation process of the archaeological record. If these are known to the archaeologists that developed fieldwork, then this would be the behaviour of the model for creating <span class="math inline">\(W/m^2\)</span>.</p>
<div class="grViz html-widget html-fill-item" id="htmlwidget-1e3130746ffd949a52b2" style="width:60%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-1e3130746ffd949a52b2">{"x":{"diagram":"\n  digraph record_formation {\n  \n    graph [layout = dot, ## Set title and layout\n           label = \"Record formation process\",\n           labelloc = \"t\"\n           fontname = Helvetica,\n           fontsize = 30]\n    \n    # node definitions with substituted label text\n    node [fontname = Helvetica, ## General node definition\n          style = filled,\n          color = MistyRose]\n          \n    ## Per node definition\n    a [label = \"Anthropogenic deposition rates\",\n       fillcolor = orange]\n    b [label = \"Natural deposition rates\",\n       fillcolor = orange]\n    c [label = \"Waste/sqrm\",\n       fillcolor = cadetblue,\n       fixedsize = shape,\n       width = 4.5,\n       height = 1,\n       fontsize = 30]\n    \n    ## General edge definition\n    edge [color = grey,\n           arrowhead = vee,\n           arrowtail = vee]\n    \n    ## Specific edges\n    a -> {c}\n    b -> {c}\n  }\n  \n  ## Label definition","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Finally, if these are not known to the archaeologist, but they want to model them, then we would go back to the first DAG. In this case, keep reading for the specificities of the model.</p>
<p>This is how each variable works specifically:</p>
<ul>
<li><strong>Waste produced</strong> (<span class="math inline">\(W/m^2\)</span> or just <span class="math inline">\(W\)</span>) <strong>(outcome variable)</strong>: Archaeological record present per <span class="math inline">\(m^2\)</span>. Since we are considering C14 dates coming from bone, this is the quantity of C14 samples present a time <em>t</em> and at a depth <em>d</em>. Thus, this variable depends on time and depth.</li>
</ul>
<p><span class="math display">\[W(t,d)=function(t,d)\]</span>.</p>
<p>We have considered this a discrete variable (number of potential samples) with range <span class="math inline">\([0,\propto K]\)</span>. <em>Defined in code as</em> <code>W</code>.</p>
<p>The variables time (<span class="math inline">\(T\)</span>) and depth (<span class="math inline">\(D\)</span>) must also be defined. Thus</p>
<ul>
<li><strong>T</strong> describes the time, discretely, in years, of existence of the site. For the simulation, this time will be known. Thus, in the simulation <span class="math inline">\(T_{birth}=(T=0)\)</span> and <span class="math inline">\(T_{max}=T_{death}\)</span>. Values of <span class="math inline">\(T\)</span> are represented by <span class="math inline">\(t\)</span>.</li>
<li><strong>D</strong> is the depth, in cms, where each specific sample is deposited at a time <span class="math inline">\(t\)</span>. This is a continuous variable with range <span class="math inline">\([0,\infty]\)</span>, and for any <span class="math inline">\(t\)</span>, we know that <span class="math inline">\(0\leq D(t)\leq d_0\)</span> and that</li>
</ul>
<p><span class="math display">\[D(t)=max\{D(t-1)-r,0\} \tag{1},\\ t=1,2,...,T_{max},\]</span></p>
<p>where <span class="math inline">\(r\)</span> is the natural deposition rates.</p>
<ul>
<li><strong>Population (group size)</strong> (<span class="math inline">\(P\)</span>): Discrete variable with range <span class="math inline">\([0,\sim K]\)</span>. Population group size is key to determine anthropogenic deposition rates (which in turn determine <span class="math inline">\(W\)</span>) but it can also be used as a proxy to determine <span class="math inline">\(W\)</span> in case deposition rates are not accounted for since, in any case, <span class="math inline">\(W \propto Pop\)</span>. The model includes the possibility to create a stochastic demographic process (see below), but the user can also set fix values for population or set the parameters in a way that the stochastic process is constrained. In any case, the user does have to provide a value for the carrying capacity (<span class="math inline">\(K\)</span>) as this will limit population growth. <em>Defined in code as</em> <code>Pop</code>.</li>
<li><strong>Anthropogenic deposition</strong> (<span class="math inline">\(A\)</span>): Amount of bone kilogram/year deposited by each group at a time <span class="math inline">\(t\)</span>. This is a continuous variable, with range <span class="math inline">\([0,\infty]\)</span>, measured in <em>Kg</em>. See <em>Anthropogenic deposition protocol</em> for full definition.</li>
<li><strong>Natural deposition rates</strong> (<span class="math inline">\(r\)</span>): This is a continuous variable, with range <span class="math inline">\([0,0.5]\)</span>, measured in <em>cm/year</em>. Because, under normal circumstances, bones are thicker than any possible amount of earth deposited per year, even in a perfectly uncorrupted archaeological sequence (which is what is being modelled here), those would occupy microstrats belonging to different years. This variable is one of the responsibles for how many microstrats will each bone be occupying. See <em>Depth protocol</em> to understand how it works. <em>Defined in code as</em> <code>r</code>.</li>
<li><strong>Site function</strong>: Has not been considered as a variable <em>per se</em> but, rather, as a group of variables, which are defined by the functionality of the site, and that condition the outcome of <span class="math inline">\(A\)</span>. See <em>Anthropogenic deposition protocol</em> to understand how these are modelled.</li>
<li><strong>Site type</strong>: Site type (whether a site is a cave, a rockshelter or an open-air camp) can heavily condition the deposition rates at any archaeological location. However, in order to reduce uncertainty and not make an overcomplex model, we have decided to embed this condition, and the possible expert knowledge related to it, within the definition of the variable <span class="math inline">\(r\)</span>.</li>
</ul>
</div>
<div id="implementation" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Implementation<a href="record-formation.html#implementation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This simulation for the creation of the archaeological record has been divided in three phases, or protocols. First, we populate the site, according to a stochastic demographic process, second we generate a sample for each time <span class="math inline">\(t\)</span> and, in the third and final step, we distribute the amount of waste for each <span class="math inline">\(d\)</span>.</p>
<p>In order to fully understand the process, first we will show the protocols and functions used. To start with, letâ€™s inspect the package with the functions functions:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="record-formation.html#cb38-1" tabindex="-1"></a><span class="do">## See some of the archaeoriddle functions</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Package</th>
<th align="left">Topic</th>
<th align="left">Title</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">archaeoriddle</td>
<td align="left">A_rates</td>
<td align="left">Simulate anthropogenic deposition</td>
</tr>
<tr class="even">
<td align="left">archaeoriddle</td>
<td align="left">D_along</td>
<td align="left">Depth protocol deposition</td>
</tr>
<tr class="odd">
<td align="left">archaeoriddle</td>
<td align="left">Gpd</td>
<td align="left">Generation of population dynamics</td>
</tr>
<tr class="even">
<td align="left">archaeoriddle</td>
<td align="left">K_lim</td>
<td align="left">Simulation of carrying capacity limitation</td>
</tr>
<tr class="odd">
<td align="left">archaeoriddle</td>
<td align="left">Pop_stoch</td>
<td align="left">Stochastic population generation</td>
</tr>
<tr class="even">
<td align="left">archaeoriddle</td>
<td align="left">death</td>
<td align="left">Simulation of death process</td>
</tr>
</tbody>
</table>
<div id="population-pop-protocol" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Population <span class="math inline">\(Pop\)</span>-protocol<a href="record-formation.html#population-pop-protocol" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This protocol generates a stochastic demographic process with maximum population <span class="math inline">\(\sim K\)</span>. It is based on three functions. The first function, <code>Gpd()</code>, is the core of the protocol. It receives a population <code>matrix</code> or <code>data.frame</code> with a specific number of individuals (<code>nrow</code>), their age (<code>df[,1]</code>) and their sex (<code>df[,2]</code>) and produces another object with the same format but with a different population based on the current one. Introduced in a loop, this function produces a time series of population, which ensures the Markov property of the stochastic process <span class="math inline">\(p(x_n+1|x_n)\)</span>.</p>
<p><br></p>
<div class="r-help-page"><div class="container">

<table style="width: 100%;"><tr><td>Gpd</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2 id='Gpd'>Generation of population dynamics</h2>

<h3>Description</h3>

<p>Protocol to generate a stochastic demographic process
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Gpd(
  x,
  K,
  W_fert_age = c(10, 45),
  M_fert_age = c(15, 55),
  p_offspring = 0.3,
  prob = 0.8,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Gpd_:_x">x</code></td>
<td>
<p>Input data with initial population matrix. A data frame or matrix
with two columns and <code>nrow</code> equal to the initial population. One row per individual.
The first column is the age of the individual.
The second column is the sex of the individual, and must be <code>c("F","M")</code>.
The columns must be named Age and Sex respectively.</p>
</td></tr>
<tr><td><code id="Gpd_:_K">K</code></td>
<td>
<p>Carrying capacity.</p>
</td></tr>
<tr><td><code id="Gpd_:_W_fert_age">W_fert_age</code></td>
<td>
<p>Vector with two values. The first value is the youngest age
at which is considered that women can have children for prehistoric societies.
The second value is the oldest age at which is considered that women can
have children. Default is <code>c(10,30)</code>.</p>
</td></tr>
<tr><td><code id="Gpd_:_M_fert_age">M_fert_age</code></td>
<td>
<p>Vector with two values. The first value is the youngest age
at which is considered that men can have children for prehistoric societies.
The second value is the oldest age at which is considered that men can have
children. Default is <code>c(15,40)</code></p>
</td></tr>
<tr><td><code id="Gpd_:_p_offspring">p_offspring</code></td>
<td>
<p>Probability of a woman having a son per year. Default is 0.3.</p>
</td></tr>
<tr><td><code id="Gpd_:_prob">prob</code></td>
<td>
<p>Probability that an individual will die per year if total population
exceeds K. Default is 0.8</p>
</td></tr>
<tr><td><code id="Gpd_:_...">...</code></td>
<td>
<p>Arguments passed to <code>death()</code>. The mortality probability by age matrix.
Their arguments can be added.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>data.frame with two columns, where the number of rows is the number of
people. The first column contains the ages and the second column contains the sex.
</p>


</div>
</div>
<p><br></p>
<p>However, this function also relies on two the other functions: <code>death()</code> and <code>K_lim()</code>. <code>death()</code> is the process of people dying each year. It is based on an age-structured probability matrix, where infants and old people have more probabilities of deceasing. The matrix is provided, but the user can set its own. <code>K_lim()</code> limits the population when it reaches <span class="math inline">\(K\)</span>. The user should specify the appropriate value for <span class="math inline">\(K\)</span> according to the size of the site, its type, the group economy, etc. Also, the user can change the probability that exceeding people dies with parameter <code>prob</code>. Default is 0.8.</p>
<p><br></p>
<div class="r-help-page"><div class="container">

<table style="width: 100%;"><tr><td>death</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2 id='death'>Simulation of death process</h2>

<h3>Description</h3>

<p>For a single individual, returns whether it lives (0) or dies (1)
Meant to be used with apply on the population data.frame x
</p>


<h3>Usage</h3>

<pre><code class='language-R'>death(
  x,
  pd = data.frame(Age = c(0:99), P_d = c(rep(0.14, 1), rep(0.16, 4), rep(0.05, 5),
    rep(0.01, 24), rep(0.03, 14), rep(0.1, 10), rep(0.3, 42)))
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="death_:_x">x</code></td>
<td>
<p>A vector or data.frame with a single row from the population matrix.
It must contain two values or columns, Age and Sex</p>
</td></tr>
<tr><td><code id="death_:_pd">pd</code></td>
<td>
<p>The probability matrix for mortality by age
The age-structured data frame is based on Gurven, Kaplan and Supa, 2007.
It is extracted adapted after computation from their text (not graphs or tables)</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A value 0 or 1 where 0 = person lives and 1 = person dies, based
on pd (the probability matrix)
</p>


</div>
</div>
<p><br></p>
<div class="r-help-page"><div class="container">

<table style="width: 100%;"><tr><td>K_lim</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2 id='K_lim'>Simulation of carrying capacity limitation</h2>

<h3>Description</h3>

<p>If the population exceeds the carrying capacity, it eliminates oversize
with prob probability per person exceeding.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>K_lim(x, K, prob = 0.8)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="K_lim_:_x">x</code></td>
<td>
<p>Data frame or matrix. Population (number of people)</p>
</td></tr>
<tr><td><code id="K_lim_:_K">K</code></td>
<td>
<p>Integer. Carrying capacity. Provided by the user</p>
</td></tr>
<tr><td><code id="K_lim_:_prob">prob</code></td>
<td>
<p>It is the probability of dying when surpassing carrying capacity</p>
</td></tr>
</table>


<h3>Value</h3>

<p>Returns a data.frame with the updated population
</p>


</div>
</div>
<p><br></p>
<p>In order to account for the chronological occupation of the site, a demographic process must be produced, where the sample is generated accordingly. The function <code>Pop_stoch</code> consider this.</p>
<p><br></p>
<div class="r-help-page"><div class="container">

<table style="width: 100%;"><tr><td>Pop_stoch</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2 id='Pop_stoch'>Stochastic population generation</h2>

<h3>Description</h3>

<p>It reproduces the population stochastic process. The result is a vector with the
number of individuals for each year.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Pop_stoch(pop_size, K, ts, prob = 0.8, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Pop_stoch_:_pop_size">pop_size</code></td>
<td>
<p>Integer, the initial population</p>
</td></tr>
<tr><td><code id="Pop_stoch_:_K">K</code></td>
<td>
<p>Only if model_pop = TRUE. In this case, it is the carrying capacity</p>
</td></tr>
<tr><td><code id="Pop_stoch_:_ts">ts</code></td>
<td>
<p>Time-span, the number of years considered for the process</p>
</td></tr>
<tr><td><code id="Pop_stoch_:_prob">prob</code></td>
<td>
<p>Probability that an individual will die if total population
exceeds K. Default is 0.8</p>
</td></tr>
<tr><td><code id="Pop_stoch_:_...">...</code></td>
<td>
<p>Additional arguments passed to <code>Gpd()</code>, and in turn to <code>death()</code></p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector with the population size for each year from 1 to ts
</p>


</div>
</div>
<p><br></p>
If you want to delve into the code of the functions you can open it here:
<details>
<summary>
Show code
</summary>
<p><strong>Code</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="record-formation.html#cb39-1" tabindex="-1"></a><span class="do">## Function 1. Generation of population dynamics</span></span>
<span id="cb39-2"><a href="record-formation.html#cb39-2" tabindex="-1"></a>Gpd <span class="ot">&lt;-</span> <span class="cf">function</span>(x, K, <span class="at">W_fert_age =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">45</span>), <span class="at">M_fert_age =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">55</span>),</span>
<span id="cb39-3"><a href="record-formation.html#cb39-3" tabindex="-1"></a>                <span class="at">p_offspring =</span> <span class="fl">0.3</span>, <span class="at">prob =</span> <span class="fl">0.8</span>, ...){</span>
<span id="cb39-4"><a href="record-formation.html#cb39-4" tabindex="-1"></a>  </span>
<span id="cb39-5"><a href="record-formation.html#cb39-5" tabindex="-1"></a>  <span class="do">## Process of having offspring</span></span>
<span id="cb39-6"><a href="record-formation.html#cb39-6" tabindex="-1"></a>  <span class="co"># Female fertile population</span></span>
<span id="cb39-7"><a href="record-formation.html#cb39-7" tabindex="-1"></a>  W <span class="ot">&lt;-</span> x[x[,<span class="dv">2</span>]<span class="sc">==</span><span class="st">&quot;F&quot;</span>, ]</span>
<span id="cb39-8"><a href="record-formation.html#cb39-8" tabindex="-1"></a>  W_fert <span class="ot">&lt;-</span> W[W<span class="sc">$</span>Age <span class="sc">&gt;</span> W_fert_age[<span class="dv">1</span>] <span class="sc">&amp;</span> W<span class="sc">$</span>Age <span class="sc">&lt;</span> W_fert_age[<span class="dv">2</span>], ]</span>
<span id="cb39-9"><a href="record-formation.html#cb39-9" tabindex="-1"></a>  <span class="co"># Male fertile population</span></span>
<span id="cb39-10"><a href="record-formation.html#cb39-10" tabindex="-1"></a>  M <span class="ot">&lt;-</span> x[x[,<span class="dv">2</span>]<span class="sc">==</span><span class="st">&quot;M&quot;</span>, ]</span>
<span id="cb39-11"><a href="record-formation.html#cb39-11" tabindex="-1"></a>  M_fert <span class="ot">&lt;-</span> M[M<span class="sc">$</span>Age <span class="sc">&gt;</span> M_fert_age[<span class="dv">1</span>] <span class="sc">&amp;</span> M<span class="sc">$</span>Age <span class="sc">&lt;</span> M_fert_age[<span class="dv">2</span>], ]</span>
<span id="cb39-12"><a href="record-formation.html#cb39-12" tabindex="-1"></a>  </span>
<span id="cb39-13"><a href="record-formation.html#cb39-13" tabindex="-1"></a>  <span class="do">## Probability of having descendance per woman</span></span>
<span id="cb39-14"><a href="record-formation.html#cb39-14" tabindex="-1"></a>  <span class="co"># Penalisation in case there are too few men</span></span>
<span id="cb39-15"><a href="record-formation.html#cb39-15" tabindex="-1"></a>  pen <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(M_fert)<span class="sc">*</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">nrow</span>(W_fert), <span class="dv">2</span>) <span class="co"># Assumes one man can have two women</span></span>
<span id="cb39-16"><a href="record-formation.html#cb39-16" tabindex="-1"></a>  pen[pen<span class="sc">&gt;</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="do">## The men penalisation can never multiply the birth rate per woman</span></span>
<span id="cb39-17"><a href="record-formation.html#cb39-17" tabindex="-1"></a>  <span class="co"># Probability of a woman having a son per year</span></span>
<span id="cb39-18"><a href="record-formation.html#cb39-18" tabindex="-1"></a>  p_offspring <span class="ot">&lt;-</span> p_offspring<span class="sc">*</span>pen</span>
<span id="cb39-19"><a href="record-formation.html#cb39-19" tabindex="-1"></a>  </span>
<span id="cb39-20"><a href="record-formation.html#cb39-20" tabindex="-1"></a>  <span class="do">## Aging process. They get one year older</span></span>
<span id="cb39-21"><a href="record-formation.html#cb39-21" tabindex="-1"></a>  x<span class="sc">$</span>Age <span class="ot">&lt;-</span> x<span class="sc">$</span>Age<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb39-22"><a href="record-formation.html#cb39-22" tabindex="-1"></a>  </span>
<span id="cb39-23"><a href="record-formation.html#cb39-23" tabindex="-1"></a>  <span class="do">## Births are new population that&#39;s added</span></span>
<span id="cb39-24"><a href="record-formation.html#cb39-24" tabindex="-1"></a>  n_offspring <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">rbinom</span>(<span class="fu">nrow</span>(W_fert), <span class="dv">1</span>, p_offspring))</span>
<span id="cb39-25"><a href="record-formation.html#cb39-25" tabindex="-1"></a>  new_pop <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-26"><a href="record-formation.html#cb39-26" tabindex="-1"></a>    <span class="st">&quot;Age&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_offspring),</span>
<span id="cb39-27"><a href="record-formation.html#cb39-27" tabindex="-1"></a>    <span class="st">&quot;Sex&quot;</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>), n_offspring, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="at">replace=</span><span class="cn">TRUE</span>))</span>
<span id="cb39-28"><a href="record-formation.html#cb39-28" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rbind</span>(x, new_pop)</span>
<span id="cb39-29"><a href="record-formation.html#cb39-29" tabindex="-1"></a>  </span>
<span id="cb39-30"><a href="record-formation.html#cb39-30" tabindex="-1"></a>  <span class="do">## Process of dying</span></span>
<span id="cb39-31"><a href="record-formation.html#cb39-31" tabindex="-1"></a>  vec_d <span class="ot">&lt;-</span> <span class="fu">apply</span>(x, <span class="dv">1</span>, death, ...)</span>
<span id="cb39-32"><a href="record-formation.html#cb39-32" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x[vec_d<span class="sc">==</span><span class="dv">0</span>, ]</span>
<span id="cb39-33"><a href="record-formation.html#cb39-33" tabindex="-1"></a>  </span>
<span id="cb39-34"><a href="record-formation.html#cb39-34" tabindex="-1"></a>  <span class="do">## Apply carrying capacty restrictions</span></span>
<span id="cb39-35"><a href="record-formation.html#cb39-35" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">K_lim</span>(x, <span class="at">K =</span> K, <span class="at">prob =</span> prob)</span>
<span id="cb39-36"><a href="record-formation.html#cb39-36" tabindex="-1"></a>  </span>
<span id="cb39-37"><a href="record-formation.html#cb39-37" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb39-38"><a href="record-formation.html#cb39-38" tabindex="-1"></a>}</span>
<span id="cb39-39"><a href="record-formation.html#cb39-39" tabindex="-1"></a></span>
<span id="cb39-40"><a href="record-formation.html#cb39-40" tabindex="-1"></a></span>
<span id="cb39-41"><a href="record-formation.html#cb39-41" tabindex="-1"></a><span class="do">## Function 2. Simulation of death process</span></span>
<span id="cb39-42"><a href="record-formation.html#cb39-42" tabindex="-1"></a>death <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">pd=</span><span class="fu">data.frame</span>(<span class="st">&quot;Age&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">99</span>),</span>
<span id="cb39-43"><a href="record-formation.html#cb39-43" tabindex="-1"></a>                                   <span class="st">&quot;P_d&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fl">0.14</span>,<span class="dv">1</span>),</span>
<span id="cb39-44"><a href="record-formation.html#cb39-44" tabindex="-1"></a>                                             <span class="fu">rep</span>(<span class="fl">0.16</span>,<span class="dv">4</span>),</span>
<span id="cb39-45"><a href="record-formation.html#cb39-45" tabindex="-1"></a>                                             <span class="fu">rep</span>(<span class="fl">0.05</span>,<span class="dv">5</span>),</span>
<span id="cb39-46"><a href="record-formation.html#cb39-46" tabindex="-1"></a>                                             <span class="fu">rep</span>(<span class="fl">0.01</span>,<span class="dv">24</span>),</span>
<span id="cb39-47"><a href="record-formation.html#cb39-47" tabindex="-1"></a>                                             <span class="fu">rep</span>(<span class="fl">0.03</span>,<span class="dv">14</span>),</span>
<span id="cb39-48"><a href="record-formation.html#cb39-48" tabindex="-1"></a>                                             <span class="fu">rep</span>(<span class="fl">0.1</span>,<span class="dv">10</span>),</span>
<span id="cb39-49"><a href="record-formation.html#cb39-49" tabindex="-1"></a>                                             <span class="fu">rep</span>(<span class="fl">0.3</span>,<span class="dv">42</span>)))){</span>
<span id="cb39-50"><a href="record-formation.html#cb39-50" tabindex="-1"></a>  age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x[<span class="dv">1</span>])</span>
<span id="cb39-51"><a href="record-formation.html#cb39-51" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="at">prob=</span>pd[pd<span class="sc">$</span>Age<span class="sc">==</span>age, <span class="dv">2</span>]))</span>
<span id="cb39-52"><a href="record-formation.html#cb39-52" tabindex="-1"></a>}</span>
<span id="cb39-53"><a href="record-formation.html#cb39-53" tabindex="-1"></a></span>
<span id="cb39-54"><a href="record-formation.html#cb39-54" tabindex="-1"></a><span class="do">## Function 3. Simulation of carrying capacity limitation</span></span>
<span id="cb39-55"><a href="record-formation.html#cb39-55" tabindex="-1"></a>K_lim <span class="ot">&lt;-</span> <span class="cf">function</span>(x, K, <span class="at">prob=</span><span class="fl">0.8</span>){</span>
<span id="cb39-56"><a href="record-formation.html#cb39-56" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb39-57"><a href="record-formation.html#cb39-57" tabindex="-1"></a>  <span class="cf">if</span> (p<span class="sc">&gt;</span>K){</span>
<span id="cb39-58"><a href="record-formation.html#cb39-58" tabindex="-1"></a>    o <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(p<span class="sc">-</span>K, <span class="dv">1</span>, prob)</span>
<span id="cb39-59"><a href="record-formation.html#cb39-59" tabindex="-1"></a>    o <span class="ot">&lt;-</span> <span class="fu">sum</span>(o[o<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb39-60"><a href="record-formation.html#cb39-60" tabindex="-1"></a>    o[o<span class="sc">==</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Avoids problem eliminating all the df if remove == 0</span></span>
<span id="cb39-61"><a href="record-formation.html#cb39-61" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x[<span class="sc">-</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(x), o, <span class="at">replace=</span><span class="cn">FALSE</span>), ]</span>
<span id="cb39-62"><a href="record-formation.html#cb39-62" tabindex="-1"></a>  }</span>
<span id="cb39-63"><a href="record-formation.html#cb39-63" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb39-64"><a href="record-formation.html#cb39-64" tabindex="-1"></a>}</span>
<span id="cb39-65"><a href="record-formation.html#cb39-65" tabindex="-1"></a></span>
<span id="cb39-66"><a href="record-formation.html#cb39-66" tabindex="-1"></a></span>
<span id="cb39-67"><a href="record-formation.html#cb39-67" tabindex="-1"></a><span class="do">## Function 4. Stochastic population generation</span></span>
<span id="cb39-68"><a href="record-formation.html#cb39-68" tabindex="-1"></a>Pop_stoch <span class="ot">&lt;-</span> <span class="cf">function</span>(pop_size, K, ts, <span class="at">prob =</span> <span class="fl">0.8</span>, ...){</span>
<span id="cb39-69"><a href="record-formation.html#cb39-69" tabindex="-1"></a>  </span>
<span id="cb39-70"><a href="record-formation.html#cb39-70" tabindex="-1"></a>  <span class="do">## Create initial population</span></span>
<span id="cb39-71"><a href="record-formation.html#cb39-71" tabindex="-1"></a>  pop_matrix <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-72"><a href="record-formation.html#cb39-72" tabindex="-1"></a>    <span class="st">&quot;Age&quot;</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">30</span>, pop_size, <span class="dv">10</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb39-73"><a href="record-formation.html#cb39-73" tabindex="-1"></a>    <span class="st">&quot;Sex&quot;</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>), pop_size, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-74"><a href="record-formation.html#cb39-74" tabindex="-1"></a>  )</span>
<span id="cb39-75"><a href="record-formation.html#cb39-75" tabindex="-1"></a>  </span>
<span id="cb39-76"><a href="record-formation.html#cb39-76" tabindex="-1"></a>  <span class="do">## Initialize vector with population size for each year  </span></span>
<span id="cb39-77"><a href="record-formation.html#cb39-77" tabindex="-1"></a>  pop <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length=</span>ts)</span>
<span id="cb39-78"><a href="record-formation.html#cb39-78" tabindex="-1"></a>  pop[<span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="fu">nrow</span>(pop_matrix)</span>
<span id="cb39-79"><a href="record-formation.html#cb39-79" tabindex="-1"></a>  <span class="do">## Run stochastic process  </span></span>
<span id="cb39-80"><a href="record-formation.html#cb39-80" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ts){</span>
<span id="cb39-81"><a href="record-formation.html#cb39-81" tabindex="-1"></a>    pop_matrix <span class="ot">&lt;-</span> <span class="fu">Gpd</span>(pop_matrix, <span class="at">K=</span>K, <span class="at">prob=</span>prob, ...)</span>
<span id="cb39-82"><a href="record-formation.html#cb39-82" tabindex="-1"></a>    pop[i] <span class="ot">&lt;-</span> <span class="fu">nrow</span>(pop_matrix)</span>
<span id="cb39-83"><a href="record-formation.html#cb39-83" tabindex="-1"></a>  }</span>
<span id="cb39-84"><a href="record-formation.html#cb39-84" tabindex="-1"></a>  </span>
<span id="cb39-85"><a href="record-formation.html#cb39-85" tabindex="-1"></a>  <span class="fu">return</span>(pop)</span>
<span id="cb39-86"><a href="record-formation.html#cb39-86" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
<div id="anthropogenic-deposition-a-protocol" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Anthropogenic deposition <span class="math inline">\(A\)</span>-protocol<a href="record-formation.html#anthropogenic-deposition-a-protocol" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This generates the amount of human waste produced for each <span class="math inline">\(t\)</span> (In kilograms of bone). It is defined as:</p>
<p><span class="math display">\[A(t)= Pop(t)\times O(t)\times F(t) \times G(t),\\ \text{with}\ t = 1,2,...,T_{death} \tag{2}\]</span> Where:</p>
<ul>
<li><span class="math inline">\(Pop(t)\)</span> is a discrete variable representing the number of living people at a time <span class="math inline">\(t\)</span>.</li>
<li><span class="math inline">\(O(t)\)</span> is the proportion of time of the year that the group spends in the camp for each time <span class="math inline">\(t\)</span>. It is a continuous variable with range <span class="math inline">\([0,1]\)</span>. In the code, this is defined as the parameter <code>in_camp_stay</code> and it is provided as the number of weeks, considering 52 the maximum number of weeks for a year.</li>
<li><span class="math inline">\(F(t)\)</span> is the proportion of bone for the full weight of each Kg of an animal consumed for a time <span class="math inline">\(t\)</span>. This is a unit interval variable <span class="math inline">\([0,1]\)</span>.</li>
<li><span class="math inline">\(G(t)\)</span> is the quantity, in Kg, of a (full-weight) animal consumed in a site by each individual at a time <span class="math inline">\(t\)</span>. This is a continuous variable with range <span class="math inline">\([0,\propto K]\)</span>. This is a hierarchical variable, defined as follows:</li>
</ul>
<p><span class="math display">\[G(t)=S(t)\times\frac{C(t)}{R(t)} = S(t)\times\frac{B(t)\times M(t)}{R(t)} \tag{3}\]</span></p>
<p>Where:</p>
<ul>
<li><p><span class="math inline">\(S(t)\)</span> is the proportion of meat consumed within the camp. <span class="math inline">\([0,1]\)</span></p></li>
<li><p><span class="math inline">\(R(t)\)</span> is the quantity of kilocalories produced for each kilogram of meat. This is a continuous with range <span class="math inline">\([1,2.5]\)</span>. Total kilocalories have been divided by 1000 for easier computation.</p></li>
<li><p>And <span class="math inline">\(C(t)\)</span> is the quantity of kilocalories, extracted from meat, consumed by person for each time <span class="math inline">\(t\)</span>. It is in turned is defined as <span class="math inline">\(C(t)=B(t) \times M(t)\)</span>, where</p>
<ul>
<li><p><span class="math inline">\(B(t)\)</span> is the quantity of kilocalories consumed by an individual for each <span class="math inline">\(t\)</span>, and it has a range <span class="math inline">\([1.5,2.5]\times 365\)</span>. For easier computation, the actual average of kilocalories consumed per person/day has been divided by 1000.</p></li>
<li><p><span class="math inline">\(M(t)\)</span> is the proportion of kilocalories coming from meat relating to the total calories consumed per each individual. <span class="math inline">\([0,1]\)</span>.</p></li>
</ul></li>
</ul>
<p>As it can be seen, the above definitions embed the functionality of the site, which can be considered by the user. In practice, setting the variables <span class="math inline">\(O(t) = 1\)</span> and <span class="math inline">\(S(t) = 1\)</span> would eliminate site functionality. This would assume that a site is inhabited by all the group during the full year, and that this group consumes all the food in the site.</p>
<p>Up to now, we have obtained the value for the variable <span class="math inline">\(A\)</span>, which is the amount of kilograms of bone produced at each time <span class="math inline">\(t\)</span>. If we consider 4 grams of non-heated bones per sample, we can extract the number of samples at time <span class="math inline">\(t\)</span>, which we cal <span class="math inline">\(W(t)\)</span></p>
<p><span class="math display">\[W(t)=\mbox{Integer part of } \Bigg(\frac{1000 \times A(t)}{4} \Bigg) \tag{4}\]</span></p>
<p>This protocol is captured in the following function:</p>
<p><br></p>
<div class="r-help-page"><div class="container">

<table style="width: 100%;"><tr><td>A_rates</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2 id='A_rates'>Simulate anthropogenic deposition</h2>

<h3>Description</h3>

<p>Simulation of samples generated per year (anthropogenic deposition rates)
Returns the Kilograms of bone produced per year in a site.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>A_rates(
  x,
  kcalpers = 2,
  kcalmeat_eat = 0.45,
  kcalmeat_prod = 1.5,
  in_camp_eat = 0.55,
  in_camp_stay = 13,
  kg = 0.07
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="A_rates_:_x">x</code></td>
<td>
<p>Integer (user provided), vector or data.frame. If integer, it is the number of
people inhabiting the site. If data.frame, the number of people is the number
of rows. If vector, it is the length of the vector. It is <code class="reqn">Pop(t)</code> in equation 3</p>
</td></tr>
<tr><td><code id="A_rates_:_kcalpers">kcalpers</code></td>
<td>
<p>Quantity of kilocalories consumed per day per adult person.
It corresponds to <code class="reqn">B(t)</code> in the equation 3. But in the formula it is per year.
Tt has a range of <code style="white-space: pre;">&#8288;[1.5,2.5]&#8288;</code>. Default is 2.</p>
</td></tr>
<tr><td><code id="A_rates_:_kcalmeat_eat">kcalmeat_eat</code></td>
<td>
<p>Proportion of kilocalories extracted from meat. Range 0,1.
Default is 0.45, based on Cordain et al (2000). It is <code class="reqn">M(t)</code> in equation 3.</p>
</td></tr>
<tr><td><code id="A_rates_:_kcalmeat_prod">kcalmeat_prod</code></td>
<td>
<p>Quantity of kiocalories per meat kilogram. Range 1,2.5
Default is 1.5, considering goat meat. It is <code class="reqn">R(t)</code> in euqation 3.</p>
</td></tr>
<tr><td><code id="A_rates_:_in_camp_eat">in_camp_eat</code></td>
<td>
<p>Proportion of food consumed within the camp. Range 0,1.
Default is 0.55 based on Collette-Barbesque et al. (2016). <code class="reqn">S(t)</code> in equation 3.</p>
</td></tr>
<tr><td><code id="A_rates_:_in_camp_stay">in_camp_stay</code></td>
<td>
<p>Proportion of time spent in a specific camp. Valid for
groups with high mobility. The proportion is computed within the function, but
the user introduces the weeks of occupation of the camp, where the maximum is
52 (full year). Default is 13 (weeks, or 0.25 of the year, or three months a year).
It corresponds to <code class="reqn">O(t)</code> in equation 3.</p>
</td></tr>
<tr><td><code id="A_rates_:_kg">kg</code></td>
<td>
<p>Bone proportion for each animal consumed. Default is 0.07
based on Johnston et al. (2021). It corresponds to <code class="reqn">F(t)</code> in equation 3.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The number of samples
</p>


</div>
</div>
<p><br></p>
You can inspect the <code>A_rates</code> code here:
<details>
<summary>
Show code
</summary>
<p><strong>Code</strong></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="record-formation.html#cb40-1" tabindex="-1"></a><span class="do">## Function 5. Simulate anthropogenic deposition</span></span>
<span id="cb40-2"><a href="record-formation.html#cb40-2" tabindex="-1"></a>A_rates <span class="ot">&lt;-</span> <span class="cf">function</span>(x,</span>
<span id="cb40-3"><a href="record-formation.html#cb40-3" tabindex="-1"></a>                    <span class="at">kcalpers =</span> <span class="dv">2</span>,</span>
<span id="cb40-4"><a href="record-formation.html#cb40-4" tabindex="-1"></a>                    <span class="at">kcalmeat_eat =</span> <span class="fl">0.45</span>,</span>
<span id="cb40-5"><a href="record-formation.html#cb40-5" tabindex="-1"></a>                    <span class="at">kcalmeat_prod =</span> <span class="fl">1.5</span>,</span>
<span id="cb40-6"><a href="record-formation.html#cb40-6" tabindex="-1"></a>                    <span class="at">in_camp_eat =</span> <span class="fl">0.55</span>,</span>
<span id="cb40-7"><a href="record-formation.html#cb40-7" tabindex="-1"></a>                    <span class="at">in_camp_stay =</span> <span class="dv">13</span>,</span>
<span id="cb40-8"><a href="record-formation.html#cb40-8" tabindex="-1"></a>                    <span class="at">kg =</span> <span class="fl">0.07</span>){</span>
<span id="cb40-9"><a href="record-formation.html#cb40-9" tabindex="-1"></a>  </span>
<span id="cb40-10"><a href="record-formation.html#cb40-10" tabindex="-1"></a>  </span>
<span id="cb40-11"><a href="record-formation.html#cb40-11" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.data.frame</span>(x) <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb40-12"><a href="record-formation.html#cb40-12" tabindex="-1"></a>    P <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb40-13"><a href="record-formation.html#cb40-13" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb40-14"><a href="record-formation.html#cb40-14" tabindex="-1"></a>    P <span class="ot">&lt;-</span> x</span>
<span id="cb40-15"><a href="record-formation.html#cb40-15" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb40-16"><a href="record-formation.html#cb40-16" tabindex="-1"></a>    P <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb40-17"><a href="record-formation.html#cb40-17" tabindex="-1"></a>  }</span>
<span id="cb40-18"><a href="record-formation.html#cb40-18" tabindex="-1"></a>  </span>
<span id="cb40-19"><a href="record-formation.html#cb40-19" tabindex="-1"></a>  <span class="co"># Check variable values are within the defined ranges</span></span>
<span id="cb40-20"><a href="record-formation.html#cb40-20" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fl">1.5</span> <span class="sc">&lt;=</span> kcalpers <span class="sc">&amp;</span> kcalpers <span class="sc">&lt;=</span> <span class="fl">2.5</span>){</span>
<span id="cb40-21"><a href="record-formation.html#cb40-21" tabindex="-1"></a>    B <span class="ot">&lt;-</span> kcalpers<span class="sc">*</span><span class="dv">365</span></span>
<span id="cb40-22"><a href="record-formation.html#cb40-22" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb40-23"><a href="record-formation.html#cb40-23" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&#39;kcalpers must be within [1.5, 2.5]&#39;</span>)</span>
<span id="cb40-24"><a href="record-formation.html#cb40-24" tabindex="-1"></a>  }</span>
<span id="cb40-25"><a href="record-formation.html#cb40-25" tabindex="-1"></a>  </span>
<span id="cb40-26"><a href="record-formation.html#cb40-26" tabindex="-1"></a>  <span class="cf">if</span> (<span class="dv">0</span> <span class="sc">&lt;=</span> kcalmeat_eat <span class="sc">&amp;</span> kcalmeat_eat <span class="sc">&lt;=</span> <span class="dv">1</span>) {</span>
<span id="cb40-27"><a href="record-formation.html#cb40-27" tabindex="-1"></a>    M <span class="ot">&lt;-</span> kcalmeat_eat</span>
<span id="cb40-28"><a href="record-formation.html#cb40-28" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb40-29"><a href="record-formation.html#cb40-29" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&#39;kcalmeat_eat must be within [0, 1]&#39;</span>)</span>
<span id="cb40-30"><a href="record-formation.html#cb40-30" tabindex="-1"></a>  }</span>
<span id="cb40-31"><a href="record-formation.html#cb40-31" tabindex="-1"></a>  </span>
<span id="cb40-32"><a href="record-formation.html#cb40-32" tabindex="-1"></a>  <span class="cf">if</span> (<span class="dv">1</span> <span class="sc">&lt;=</span> kcalmeat_prod <span class="sc">&amp;</span> kcalmeat_prod <span class="sc">&lt;</span> <span class="fl">2.5</span>) {</span>
<span id="cb40-33"><a href="record-formation.html#cb40-33" tabindex="-1"></a>    R <span class="ot">&lt;-</span> kcalmeat_prod</span>
<span id="cb40-34"><a href="record-formation.html#cb40-34" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb40-35"><a href="record-formation.html#cb40-35" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&#39;kcalmeat_prod must be within [1, 25]&#39;</span>)</span>
<span id="cb40-36"><a href="record-formation.html#cb40-36" tabindex="-1"></a>  }</span>
<span id="cb40-37"><a href="record-formation.html#cb40-37" tabindex="-1"></a>  </span>
<span id="cb40-38"><a href="record-formation.html#cb40-38" tabindex="-1"></a>  <span class="cf">if</span> (<span class="dv">0</span> <span class="sc">&lt;=</span> in_camp_eat <span class="sc">&amp;</span> in_camp_eat <span class="sc">&lt;=</span> <span class="dv">1</span>){</span>
<span id="cb40-39"><a href="record-formation.html#cb40-39" tabindex="-1"></a>    S <span class="ot">&lt;-</span> in_camp_eat</span>
<span id="cb40-40"><a href="record-formation.html#cb40-40" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb40-41"><a href="record-formation.html#cb40-41" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&#39;in_camp_eat must be within [0, 1]&#39;</span>)</span>
<span id="cb40-42"><a href="record-formation.html#cb40-42" tabindex="-1"></a>  }</span>
<span id="cb40-43"><a href="record-formation.html#cb40-43" tabindex="-1"></a>  </span>
<span id="cb40-44"><a href="record-formation.html#cb40-44" tabindex="-1"></a>  <span class="cf">if</span> (in_camp_stay <span class="sc">&lt;=</span> <span class="dv">52</span>){</span>
<span id="cb40-45"><a href="record-formation.html#cb40-45" tabindex="-1"></a>    O <span class="ot">&lt;-</span> <span class="fu">round</span>(in_camp_stay<span class="sc">/</span><span class="dv">52</span>,<span class="dv">2</span>)</span>
<span id="cb40-46"><a href="record-formation.html#cb40-46" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb40-47"><a href="record-formation.html#cb40-47" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&#39;A year cannot have more than 52 weeks&#39;</span>)</span>
<span id="cb40-48"><a href="record-formation.html#cb40-48" tabindex="-1"></a>  }</span>
<span id="cb40-49"><a href="record-formation.html#cb40-49" tabindex="-1"></a>  </span>
<span id="cb40-50"><a href="record-formation.html#cb40-50" tabindex="-1"></a>  C <span class="ot">&lt;-</span> B<span class="sc">*</span>M</span>
<span id="cb40-51"><a href="record-formation.html#cb40-51" tabindex="-1"></a>  G <span class="ot">&lt;-</span> (C <span class="sc">*</span> S) <span class="sc">/</span> R <span class="do">## Quantity (in kg) of animal consumed per person in camp during year t</span></span>
<span id="cb40-52"><a href="record-formation.html#cb40-52" tabindex="-1"></a>  A <span class="ot">&lt;-</span> P <span class="sc">*</span> O <span class="sc">*</span> kg <span class="sc">*</span> G <span class="do">## kilograms of meat consumed within a camp by the group</span></span>
<span id="cb40-53"><a href="record-formation.html#cb40-53" tabindex="-1"></a>  W <span class="ot">&lt;-</span> <span class="fu">round</span>((<span class="dv">1000</span> <span class="sc">*</span> A) <span class="sc">/</span> <span class="dv">4</span>) <span class="do">## samples extracted from that meat</span></span>
<span id="cb40-54"><a href="record-formation.html#cb40-54" tabindex="-1"></a>  </span>
<span id="cb40-55"><a href="record-formation.html#cb40-55" tabindex="-1"></a>  <span class="fu">return</span>(W)</span>
<span id="cb40-56"><a href="record-formation.html#cb40-56" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
<div id="depth-d-protocol" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Depth <span class="math inline">\(D\)</span>-protocol<a href="record-formation.html#depth-d-protocol" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This protocol is designed to respond to the fact that, despite a bone is deposited at time <span class="math inline">\(t\)</span>, it can occupy the estratigraphic space of many subsequent years until it is fully buried. The amount of years it takes to be fully buried depends on the thickness of the bone and the natural deposition rates <span class="math inline">\(r\)</span>.</p>
<p>Since the thickest bones are usually the minority within a sample, while the majority is usually conformed of smaller bones, we have considered that bone presence decreases exponentially from <span class="math inline">\(t_0\)</span>, the year when it was deposited. Thus, this process is modeled as follows:</p>
<p><span class="math display">\[W_b(t_u,t_l)=W(t=t_l)\times(1-e^{-\lambda(t_u-t_l)}),\ t_u &lt; t_l \tag{5}\]</span></p>
<p>Where</p>
<ul>
<li><span class="math inline">\(W\)</span> as defined before, it is the number of samples deposited at a time <span class="math inline">\(t_l\)</span></li>
<li><span class="math inline">\(W_b\)</span>: is the number of samples buried at a time <span class="math inline">\(t_u\)</span> from the ones generated at <span class="math inline">\(t_l\)</span>. Thus, <span class="math inline">\(t_u \geq t_l\)</span></li>
<li><span class="math inline">\(t_l\)</span> is the moment in time <span class="math inline">\(t\)</span> when the samples <span class="math inline">\(W\)</span> are deposited.</li>
<li><span class="math inline">\(t_u\)</span> is each time <span class="math inline">\(t\)</span>, <span class="math inline">\(t \geq t_l\)</span>, when the sample is being buried according to the parameter <span class="math inline">\(r\)</span>.</li>
<li>At <span class="math inline">\(t_{u_{max}}\)</span>, the sample is completely buried. <span class="math inline">\(t_{u_{max}}&gt;=t_u&gt;=t_l\)</span></li>
</ul>
<p><span class="math inline">\(t_{u_{max}}\)</span> depends on two factors:</p>
<ul>
<li><span class="math inline">\(L\)</span> is maximum thickness of the thickest bone in the direction of the deposition, in cm.</li>
<li><span class="math inline">\(r\)</span> is the natural deposition rate, in <span class="math inline">\(\mbox{cm/year}\)</span>. For this model, we have considered the values 0.1, 0.2, 0.3, 0.4 and 0.5</li>
</ul>
<p>Thus we can calculate the time it takes for a sample to be fully buried as</p>
<p><span class="math display">\[r = \frac{L}{t_{u_{max}}} \Rightarrow t_{u_{max}}=\frac{L}{r} \tag{6}\]</span></p>
<p><strong>Estimation of</strong> <span class="math inline">\(\lambda\)</span></p>
<p>Now we need to estimate the exponential rate <span class="math inline">\(\lambda\)</span> in equation <span class="math inline">\((5)\)</span>. In order to do so, we consider the state of the model when <span class="math inline">\(t_l=0\)</span> and <span class="math inline">\(t_u=t_{u_{max}}\)</span>, which marks the time at which the first samples deposited are completely buried. And consider the following</p>
<p><span class="math display">\[\frac{W_b(t_u,t_l)}{W(t=t_l)} \tag{7}\]</span></p>
<p>is the proportion of buried samples in <span class="math inline">\(t_{u}\)</span> from the ones that were deposited in <span class="math inline">\(t_l\)</span>. Thus, if we substitute the time points specified above and plug in equation 5, we have that</p>
<p><span class="math display">\[\frac{W_b(t_u=t_{u_{max}},t_l)}{W(t_l=1)}=1-e^{-t_{u_{max}}\lambda} \tag{8}\]</span></p>
<p>However, since we consider that all of the samples buried in <span class="math inline">\(t_{u_{max}}\)</span>, then the proportion on the left hand side is 1, and in this situation <span class="math inline">\(\lambda \rightarrow \infty\)</span> so we cannot use the equation. We can especify an error margin, <span class="math inline">\(\theta_e\)</span> to the proportion of buried samples in <span class="math inline">\(t_{u_{max}}\)</span>, say <span class="math inline">\(99\%\)</span>. In this case, <span class="math inline">\(\lambda\)</span> can be easily computed as follows</p>
<p><span class="math display">\[\theta_e=1-e^{-\lambda t_{u_{max}}}\]</span></p>
<p>and thus, solving for <span class="math inline">\(\lambda\)</span> and taking logarithms on both sides,</p>
<p><span class="math display">\[\lambda=\frac{-log(1-\theta_e)}{t_{u_{max}}} \tag{9}\]</span></p>
<p>Where <span class="math inline">\(\theta_b&lt;1\)</span> is the proportion of buried samples in <span class="math inline">\(t_{u_{max}}\)</span>, which is calculated in equation 6.</p>
<p>The function <code>D_along</code> captures this process:</p>
<p><br></p>
<div class="r-help-page"><div class="container">

<table style="width: 100%;"><tr><td>D_along</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2 id='D_along'>Depth protocol deposition</h2>

<h3>Description</h3>

<p>It distributes the samples produced in one specific year along the depth of the
site, without any kind of post-depositional alteration, and according to
pre-established post-deposition rates. Returns a vector with the samples exponentially
distributed. The vector is as long as L/r and the error (prop_buried, <code class="reqn">\theta_{\epsilon}</code>) is considered.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>D_along(
  W_t,
  r,
  max_bone_thickness = c("m", "s", "l", "vl"),
  prop_buried = 0.9999
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="D_along_:_W_t">W_t</code></td>
<td>
<p>Integer (user provided), vector or data.frame. It is the number samples
produced at a specific 't'.</p>
</td></tr>
<tr><td><code id="D_along_:_r">r</code></td>
<td>
<p>Is the natural deposition rates. At this moment. Values greater than 0.5 are not accepted.
If values with two or more decimals are provided, the function will automatically round
the value to one decimal.</p>
</td></tr>
<tr><td><code id="D_along_:_max_bone_thickness">max_bone_thickness</code></td>
<td>
<p>Maximum thickness of bones within the assemblage. Four
values are possible: <code>'s'</code> (small) = 2.5 cm; <code>'m'</code> (medium) = 5 cm; <code>'l'</code> (large) = 10 cm
and <code>'vl'</code> (very large) = 20 cm. Default is <code>'m'</code>.</p>
</td></tr>
<tr><td><code id="D_along_:_prop_buried">prop_buried</code></td>
<td>
<p>Proportion of samples buried sample at tmax, considering error. Pb
needs to be smaller than 1. Default is 0.9999, which stands for 99.99%.
This is <code class="reqn">\theta_{\epsilon}</code> in equation 9</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A vector of samples buried at times from tl to tm
</p>


</div>
</div>
<p><br></p>
<p>At the end, the function <code>Rec_c</code> runs <code>D_along</code> over a period of time, effectively producing an archaeological record. In the function <code>Rec_c</code> the user can consider whether to divide the total sample by the area of the site, or not. In addition, the user can use the modeled values (with the functions above) as an input to this function, or introduce them directly, for example, in the case that fix population rates per year were preferred.</p>
<p><br></p>
<div class="r-help-page"><div class="container">

<table style="width: 100%;"><tr><td>Rec_c</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2 id='Rec_c'>Archaeological deposition record</h2>

<h3>Description</h3>

<p>Generate archaeological deposition record over time and depth
It iterates over D_along to spread the amount of samples produced at each time point over different profundities
</p>


<h3>Usage</h3>

<pre><code class='language-R'>Rec_c(x, area, ts, InitBP, persqm = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr><td><code id="Rec_c_:_x">x</code></td>
<td>
<p>Vector with the number of samples per year. As produced as produced by iterating over A_rates.</p>
</td></tr>
<tr><td><code id="Rec_c_:_area">area</code></td>
<td>
<p>Only if <code>persqm = TRUE</code>. In this case, the total area of the site
must be provided</p>
</td></tr>
<tr><td><code id="Rec_c_:_ts">ts</code></td>
<td>
<p>Time-span, the number of years considered for the process</p>
</td></tr>
<tr><td><code id="Rec_c_:_InitBP">InitBP</code></td>
<td>
<p>Initial year considered for the process. In BP.</p>
</td></tr>
<tr><td><code id="Rec_c_:_persqm">persqm</code></td>
<td>
<p>If TRUE, the total record is divided by the area of the site
(in square meters), so that the output is per square meter. Default is FALSE</p>
</td></tr>
<tr><td><code id="Rec_c_:_...">...</code></td>
<td>
<p>This function uses the functions <code>D_along()</code>. The additional
arguments can be added.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A square matrix of size ts. It contains the amount of samples deposited at each year (columns) and each depth (rows)
</p>


</div>
</div>
<p><br></p>
As before, you can check the code here:
<details>
<summary>
Show code
</summary>
<p><strong>Code</strong></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="record-formation.html#cb41-1" tabindex="-1"></a><span class="do">## Function 6. Depth protocol deposition</span></span>
<span id="cb41-2"><a href="record-formation.html#cb41-2" tabindex="-1"></a>D_along <span class="ot">&lt;-</span> <span class="cf">function</span>(W_t, r, <span class="at">max_bone_thickness =</span> <span class="fu">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&#39;s&#39;</span>, <span class="st">&#39;l&#39;</span>, <span class="st">&#39;vl&#39;</span>),</span>
<span id="cb41-3"><a href="record-formation.html#cb41-3" tabindex="-1"></a>                    <span class="at">prop_buried =</span> .<span class="dv">9999</span>){</span>
<span id="cb41-4"><a href="record-formation.html#cb41-4" tabindex="-1"></a>  </span>
<span id="cb41-5"><a href="record-formation.html#cb41-5" tabindex="-1"></a>  <span class="co"># Define parameter r</span></span>
<span id="cb41-6"><a href="record-formation.html#cb41-6" tabindex="-1"></a>  <span class="cf">if</span>(r <span class="sc">&gt;</span> <span class="fl">0.5</span>) <span class="fu">stop</span>(<span class="st">&quot;values &gt; 0.5 are not accepted for param &#39;r&#39;&quot;</span>)</span>
<span id="cb41-7"><a href="record-formation.html#cb41-7" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">round</span>(r, <span class="dv">1</span>)</span>
<span id="cb41-8"><a href="record-formation.html#cb41-8" tabindex="-1"></a>  <span class="co"># Constraints for parameter Pb</span></span>
<span id="cb41-9"><a href="record-formation.html#cb41-9" tabindex="-1"></a>  <span class="cf">if</span> (prop_buried <span class="sc">&gt;=</span> <span class="dv">1</span>) <span class="fu">stop</span>(<span class="st">&quot;Pb must be lower than 1&quot;</span>)</span>
<span id="cb41-10"><a href="record-formation.html#cb41-10" tabindex="-1"></a>  </span>
<span id="cb41-11"><a href="record-formation.html#cb41-11" tabindex="-1"></a>  <span class="co"># Define parameter Max_bone_thickness (L)</span></span>
<span id="cb41-12"><a href="record-formation.html#cb41-12" tabindex="-1"></a>  max_bone_thickness <span class="ot">=</span> <span class="fu">match.arg</span>(max_bone_thickness)</span>
<span id="cb41-13"><a href="record-formation.html#cb41-13" tabindex="-1"></a>  <span class="cf">if</span> (max_bone_thickness <span class="sc">==</span> <span class="st">&#39;s&#39;</span>){</span>
<span id="cb41-14"><a href="record-formation.html#cb41-14" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fl">2.5</span></span>
<span id="cb41-15"><a href="record-formation.html#cb41-15" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (max_bone_thickness <span class="sc">==</span> <span class="st">&#39;m&#39;</span>){</span>
<span id="cb41-16"><a href="record-formation.html#cb41-16" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb41-17"><a href="record-formation.html#cb41-17" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (max_bone_thickness <span class="sc">==</span> <span class="st">&#39;l&#39;</span>){</span>
<span id="cb41-18"><a href="record-formation.html#cb41-18" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb41-19"><a href="record-formation.html#cb41-19" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (max_bone_thickness <span class="sc">==</span> <span class="st">&#39;vl&#39;</span>){</span>
<span id="cb41-20"><a href="record-formation.html#cb41-20" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb41-21"><a href="record-formation.html#cb41-21" tabindex="-1"></a>  }</span>
<span id="cb41-22"><a href="record-formation.html#cb41-22" tabindex="-1"></a>  </span>
<span id="cb41-23"><a href="record-formation.html#cb41-23" tabindex="-1"></a>  <span class="co"># Define tmax</span></span>
<span id="cb41-24"><a href="record-formation.html#cb41-24" tabindex="-1"></a>  tm <span class="ot">&lt;-</span> L<span class="sc">/</span>r</span>
<span id="cb41-25"><a href="record-formation.html#cb41-25" tabindex="-1"></a>  <span class="co"># Estimate lambda</span></span>
<span id="cb41-26"><a href="record-formation.html#cb41-26" tabindex="-1"></a>  l <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> prop_buried) <span class="sc">/</span> tm</span>
<span id="cb41-27"><a href="record-formation.html#cb41-27" tabindex="-1"></a>  </span>
<span id="cb41-28"><a href="record-formation.html#cb41-28" tabindex="-1"></a>  ss <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">round</span>(tm)) <span class="do">## Vector to distribute samples over</span></span>
<span id="cb41-29"><a href="record-formation.html#cb41-29" tabindex="-1"></a>  tl <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># Year where the sample is deposited</span></span>
<span id="cb41-30"><a href="record-formation.html#cb41-30" tabindex="-1"></a>  tu <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Year when it is covered</span></span>
<span id="cb41-31"><a href="record-formation.html#cb41-31" tabindex="-1"></a>  </span>
<span id="cb41-32"><a href="record-formation.html#cb41-32" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>tm){</span>
<span id="cb41-33"><a href="record-formation.html#cb41-33" tabindex="-1"></a>    Wb <span class="ot">&lt;-</span> W_t <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>l<span class="sc">*</span>(tu<span class="sc">-</span>tl))) <span class="co"># Apply formula for tu</span></span>
<span id="cb41-34"><a href="record-formation.html#cb41-34" tabindex="-1"></a>    Wbprev <span class="ot">&lt;-</span> W_t <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>l<span class="sc">*</span>((tu<span class="dv">-1</span>)<span class="sc">-</span>tl))) <span class="co"># Calculate for previous to tu</span></span>
<span id="cb41-35"><a href="record-formation.html#cb41-35" tabindex="-1"></a>    ss[i] <span class="ot">&lt;-</span> <span class="fu">round</span>(Wb <span class="sc">-</span> Wbprev) <span class="co"># Number of samples for each year</span></span>
<span id="cb41-36"><a href="record-formation.html#cb41-36" tabindex="-1"></a>    tu <span class="ot">&lt;-</span> tu <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb41-37"><a href="record-formation.html#cb41-37" tabindex="-1"></a>  }</span>
<span id="cb41-38"><a href="record-formation.html#cb41-38" tabindex="-1"></a>  </span>
<span id="cb41-39"><a href="record-formation.html#cb41-39" tabindex="-1"></a>  <span class="fu">return</span>(ss)</span>
<span id="cb41-40"><a href="record-formation.html#cb41-40" tabindex="-1"></a>}</span>
<span id="cb41-41"><a href="record-formation.html#cb41-41" tabindex="-1"></a></span>
<span id="cb41-42"><a href="record-formation.html#cb41-42" tabindex="-1"></a><span class="do">## 7. Archaeological deposition record</span></span>
<span id="cb41-43"><a href="record-formation.html#cb41-43" tabindex="-1"></a>Rec_c <span class="ot">&lt;-</span> <span class="cf">function</span>(x, area, ts, InitBP, <span class="at">persqm =</span> <span class="cn">FALSE</span>, ...){</span>
<span id="cb41-44"><a href="record-formation.html#cb41-44" tabindex="-1"></a>  </span>
<span id="cb41-45"><a href="record-formation.html#cb41-45" tabindex="-1"></a>  <span class="do">## Whether sqm division must be included or not</span></span>
<span id="cb41-46"><a href="record-formation.html#cb41-46" tabindex="-1"></a>  <span class="cf">if</span> (persqm <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb41-47"><a href="record-formation.html#cb41-47" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x <span class="sc">/</span> area</span>
<span id="cb41-48"><a href="record-formation.html#cb41-48" tabindex="-1"></a>  }</span>
<span id="cb41-49"><a href="record-formation.html#cb41-49" tabindex="-1"></a>  </span>
<span id="cb41-50"><a href="record-formation.html#cb41-50" tabindex="-1"></a>  <span class="do">## Spread dates along different depths</span></span>
<span id="cb41-51"><a href="record-formation.html#cb41-51" tabindex="-1"></a>  matdim <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb41-52"><a href="record-formation.html#cb41-52" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span>matdim, <span class="at">ncol=</span>matdim)</span>
<span id="cb41-53"><a href="record-formation.html#cb41-53" tabindex="-1"></a>  </span>
<span id="cb41-54"><a href="record-formation.html#cb41-54" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>matdim){</span>
<span id="cb41-55"><a href="record-formation.html#cb41-55" tabindex="-1"></a>    new <span class="ot">&lt;-</span> <span class="fu">D_along</span>(x[i], ...)</span>
<span id="cb41-56"><a href="record-formation.html#cb41-56" tabindex="-1"></a>    st <span class="ot">&lt;-</span> i <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb41-57"><a href="record-formation.html#cb41-57" tabindex="-1"></a>    pos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, st), new)</span>
<span id="cb41-58"><a href="record-formation.html#cb41-58" tabindex="-1"></a>    pos <span class="ot">&lt;-</span> pos[<span class="dv">1</span><span class="sc">:</span>matdim]</span>
<span id="cb41-59"><a href="record-formation.html#cb41-59" tabindex="-1"></a>    mat[, i] <span class="ot">&lt;-</span> pos</span>
<span id="cb41-60"><a href="record-formation.html#cb41-60" tabindex="-1"></a>  }</span>
<span id="cb41-61"><a href="record-formation.html#cb41-61" tabindex="-1"></a>  mat[<span class="fu">is.na</span>(mat)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb41-62"><a href="record-formation.html#cb41-62" tabindex="-1"></a>  </span>
<span id="cb41-63"><a href="record-formation.html#cb41-63" tabindex="-1"></a>  <span class="do">## Names for columns (each year)</span></span>
<span id="cb41-64"><a href="record-formation.html#cb41-64" tabindex="-1"></a>  years <span class="ot">&lt;-</span> <span class="fu">seq</span>(InitBP, InitBP<span class="sc">-</span>ts)</span>
<span id="cb41-65"><a href="record-formation.html#cb41-65" tabindex="-1"></a>  nyears <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb41-66"><a href="record-formation.html#cb41-66" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>matdim){</span>
<span id="cb41-67"><a href="record-formation.html#cb41-67" tabindex="-1"></a>    nyears[i] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(years[i], <span class="st">&quot; BP&quot;</span>)</span>
<span id="cb41-68"><a href="record-formation.html#cb41-68" tabindex="-1"></a>  }</span>
<span id="cb41-69"><a href="record-formation.html#cb41-69" tabindex="-1"></a>  <span class="fu">colnames</span>(mat) <span class="ot">&lt;-</span> nyears</span>
<span id="cb41-70"><a href="record-formation.html#cb41-70" tabindex="-1"></a>  </span>
<span id="cb41-71"><a href="record-formation.html#cb41-71" tabindex="-1"></a>  <span class="do">## Names for rows (each depth)</span></span>
<span id="cb41-72"><a href="record-formation.html#cb41-72" tabindex="-1"></a>  <span class="co"># Extract arguments as a list</span></span>
<span id="cb41-73"><a href="record-formation.html#cb41-73" tabindex="-1"></a>  extract_args <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...){ </span>
<span id="cb41-74"><a href="record-formation.html#cb41-74" tabindex="-1"></a>    extras <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb41-75"><a href="record-formation.html#cb41-75" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">extras=</span>extras)) </span>
<span id="cb41-76"><a href="record-formation.html#cb41-76" tabindex="-1"></a>  }</span>
<span id="cb41-77"><a href="record-formation.html#cb41-77" tabindex="-1"></a>  </span>
<span id="cb41-78"><a href="record-formation.html#cb41-78" tabindex="-1"></a>  dr <span class="ot">&lt;-</span> <span class="fu">extract_args</span>(D_along, ...)</span>
<span id="cb41-79"><a href="record-formation.html#cb41-79" tabindex="-1"></a>  dr <span class="ot">&lt;-</span> dr<span class="sc">$</span>extras<span class="sc">$</span>r</span>
<span id="cb41-80"><a href="record-formation.html#cb41-80" tabindex="-1"></a>  </span>
<span id="cb41-81"><a href="record-formation.html#cb41-81" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">cumsum</span>(<span class="fu">rep</span>(dr, <span class="fu">nrow</span>(mat)))) <span class="do">## computes depths</span></span>
<span id="cb41-82"><a href="record-formation.html#cb41-82" tabindex="-1"></a>  <span class="fu">rownames</span>(mat) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;d = &quot;</span>, d, <span class="st">&quot; cm&quot;</span>)</span>
<span id="cb41-83"><a href="record-formation.html#cb41-83" tabindex="-1"></a>  </span>
<span id="cb41-84"><a href="record-formation.html#cb41-84" tabindex="-1"></a>  <span class="fu">return</span>(mat)</span>
<span id="cb41-85"><a href="record-formation.html#cb41-85" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
</div>
<div id="example-and-simulation" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Example and simulation<a href="record-formation.html#example-and-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>With the above functions, the user can model (1) a generative demographic process, (2) how many samples would a group of people produce in a site, according to different constraints and (3) how those dates distribute along the depth of a site under the assumption that there has not been any kind of record loss or post-depositional process (this will be modelled in a second layer of modelling).</p>
<p>We can start the simulation with the parameters seen below (or defaults in function definitions above). To sum up, these are the steps of the simulation:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(Pop\)</span>-protocol. Using <code>Pop_stoch</code>, we generate a stochastic population dynamic that will give us the number of individuals for each year.</li>
<li><span class="math inline">\(A\)</span>-protocol. Knowing the population size per year, we apply <code>A_rates</code> to each of them and generate the anthropogenic deposition, and get the number of samples per year.</li>
<li><span class="math inline">\(D\)</span>-protocol. Knowing how many samples are generates each year, using <code>Rec_c</code>, we distribute them along the depth record.</li>
</ol>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="record-formation.html#cb42-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb42-2"><a href="record-formation.html#cb42-2" tabindex="-1"></a><span class="co"># 1. Pop-protocol</span></span>
<span id="cb42-3"><a href="record-formation.html#cb42-3" tabindex="-1"></a>Ps <span class="ot">&lt;-</span> <span class="fu">Pop_stoch</span>(<span class="at">pop_size=</span><span class="dv">100</span>, <span class="at">ts=</span><span class="dv">100</span>, <span class="at">K=</span><span class="dv">150</span>)</span>
<span id="cb42-4"><a href="record-formation.html#cb42-4" tabindex="-1"></a><span class="co"># 2. A-protocol</span></span>
<span id="cb42-5"><a href="record-formation.html#cb42-5" tabindex="-1"></a>samp <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(Ps, A_rates)) <span class="do">## Extract sample per time steps</span></span>
<span id="cb42-6"><a href="record-formation.html#cb42-6" tabindex="-1"></a><span class="co"># 3. D-protocol</span></span>
<span id="cb42-7"><a href="record-formation.html#cb42-7" tabindex="-1"></a>Rec <span class="ot">&lt;-</span> <span class="fu">Rec_c</span>(samp, <span class="at">InitBP =</span> <span class="dv">7500</span>, <span class="at">ts =</span> <span class="dv">100</span>, <span class="at">r =</span> <span class="fl">0.2</span>, <span class="at">max_bone_thickness =</span> <span class="st">&quot;m&quot;</span>)</span></code></pre></div>
<p>With this we obtain, among other things, the distribution of the samples deposited for each date along the depth of the sit, and its comparison to the total population. For better comprehension, we have decided not to include all of the dates in the plot below, but only some of them as an example. The user can also check how the model works and its results <a href="https://acortell3.shinyapps.io/archaeo_record_model">here</a>. <em>The total number of population has been adapted for visualisation</em></p>
<p><img src="_main_files/figure-html/unnamed-chunk-60-1.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-60-2.png" width="672" /></p>
<p>Notice the exponential decay in the amount of samples per depth layer for the same year.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="population-growth-on-multiple-sites.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="record-loss.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
