<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Landscape &amp; Resources | Methods Riddles, the ultimate revelations</title>
  <meta name="description" content="First draft of Rbookdown to describe how data have been generated" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Landscape &amp; Resources | Methods Riddles, the ultimate revelations" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="First draft of Rbookdown to describe how data have been generated" />
  <meta name="github-repo" content="acortell3/archaeoriddle" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Landscape &amp; Resources | Methods Riddles, the ultimate revelations" />
  
  <meta name="twitter:description" content="First draft of Rbookdown to describe how data have been generated" />
  

<meta name="author" content="CDAL" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="introduction.html"/>
<link rel="next" href="popgrowth.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.11/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-archaeoriddle"><i class="fa fa-check"></i><b>1.1</b> What is archaeoriddle?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-will-you-find-in-this-bookdown"><i class="fa fa-check"></i><b>1.2</b> What will you find in this bookdown?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-can-you-do-with-this"><i class="fa fa-check"></i><b>1.3</b> What can you do with this?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="env.html"><a href="env.html"><i class="fa fa-check"></i><b>2</b> Landscape &amp; Resources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="env.html"><a href="env.html#autocorrelated-noise-generation"><i class="fa fa-check"></i><b>2.1</b> Autocorrelated noise generation</a></li>
<li class="chapter" data-level="2.2" data-path="env.html"><a href="env.html#slope-and-elevation"><i class="fa fa-check"></i><b>2.2</b> Slope and Elevation</a></li>
<li class="chapter" data-level="2.3" data-path="env.html"><a href="env.html#environmental-resources"><i class="fa fa-check"></i><b>2.3</b> Environmental resources</a></li>
<li class="chapter" data-level="2.4" data-path="env.html"><a href="env.html#manual-selection"><i class="fa fa-check"></i><b>2.4</b> Manually Select Resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="popgrowth.html"><a href="popgrowth.html"><i class="fa fa-check"></i><b>3</b> Population structure &amp; growth</a>
<ul>
<li class="chapter" data-level="3.1" data-path="popgrowth.html"><a href="popgrowth.html#settlements-position"><i class="fa fa-check"></i><b>3.1</b> Settlements position</a></li>
<li class="chapter" data-level="3.2" data-path="popgrowth.html"><a href="popgrowth.html#initsize"><i class="fa fa-check"></i><b>3.2</b> Initializing Site Population and Culture</a></li>
<li class="chapter" data-level="3.3" data-path="popgrowth.html"><a href="popgrowth.html#base-pop-growth"><i class="fa fa-check"></i><b>3.3</b> Population Growth : <span class="math inline">\(Pop\)</span>-protocol</a>
<ul>
<li class="chapter" data-level="" data-path="popgrowth.html"><a href="popgrowth.html#source"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="conflict.html"><a href="conflict.html"><i class="fa fa-check"></i><b>4</b> Migration &amp; Conflict</a>
<ul>
<li class="chapter" data-level="4.1" data-path="conflict.html"><a href="conflict.html#fission"><i class="fa fa-check"></i><b>4.1</b> Fission</a></li>
<li class="chapter" data-level="4.2" data-path="conflict.html"><a href="conflict.html#migration"><i class="fa fa-check"></i><b>4.2</b> Migration</a></li>
<li class="chapter" data-level="4.3" data-path="conflict.html"><a href="conflict.html#conflict-and-war"><i class="fa fa-check"></i><b>4.3</b> Conflict and War</a></li>
<li class="chapter" data-level="4.4" data-path="conflict.html"><a href="conflict.html#network-site-size-and-climate-deprecated"><i class="fa fa-check"></i><b>4.4</b> ~~ Network, Site Size And Climate â€“ DEPRECATED ~~</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="main-simu.html"><a href="main-simu.html"><i class="fa fa-check"></i><b>5</b> Main Simulation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="main-simu.html"><a href="main-simu.html#initial-parameters"><i class="fa fa-check"></i><b>5.1</b> Initial Parameters</a></li>
<li class="chapter" data-level="5.2" data-path="main-simu.html"><a href="main-simu.html#preparation"><i class="fa fa-check"></i><b>5.2</b> Preparation</a></li>
<li class="chapter" data-level="5.3" data-path="main-simu.html"><a href="main-simu.html#algorithm"><i class="fa fa-check"></i><b>5.3</b> Algorithm</a>
<ul>
<li class="chapter" data-level="" data-path="main-simu.html"><a href="main-simu.html#source-code"><i class="fa fa-check"></i>Source code</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="main-simu.html"><a href="main-simu.html#explore-simulation"><i class="fa fa-check"></i><b>5.4</b> Explore simulation:</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="recgen.html"><a href="recgen.html"><i class="fa fa-check"></i><b>6</b> Record formation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="recgen.html"><a href="recgen.html#theoretical-model"><i class="fa fa-check"></i><b>6.1</b> Theoretical model</a></li>
<li class="chapter" data-level="6.2" data-path="recgen.html"><a href="recgen.html#implementation"><i class="fa fa-check"></i><b>6.2</b> Implementation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="recgen.html"><a href="recgen.html#population-pop-protocol"><i class="fa fa-check"></i><b>6.2.1</b> Population <span class="math inline">\(Pop\)</span>-protocol</a></li>
<li class="chapter" data-level="6.2.2" data-path="recgen.html"><a href="recgen.html#anthropogenic-deposition-a-protocol"><i class="fa fa-check"></i><b>6.2.2</b> Anthropogenic deposition <span class="math inline">\(A\)</span>-protocol</a></li>
<li class="chapter" data-level="6.2.3" data-path="recgen.html"><a href="recgen.html#depth-d-protocol"><i class="fa fa-check"></i><b>6.2.3</b> Depth <span class="math inline">\(D\)</span>-protocol</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="recgen.html"><a href="recgen.html#minimal-example-and-simulation"><i class="fa fa-check"></i><b>6.3</b> Minimal example and simulation</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="recloss.html"><a href="recloss.html"><i class="fa fa-check"></i><b>7</b> Record loss</a>
<ul>
<li class="chapter" data-level="7.1" data-path="recloss.html"><a href="recloss.html#theoretical-model-1"><i class="fa fa-check"></i><b>7.1</b> Theoretical model</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="recloss.html"><a href="recloss.html#general-purpose"><i class="fa fa-check"></i><b>7.1.1</b> General purpose</a></li>
<li class="chapter" data-level="7.1.2" data-path="recloss.html"><a href="recloss.html#model-layers"><i class="fa fa-check"></i><b>7.1.2</b> Model layers</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="recloss.html"><a href="recloss.html#implementation-1"><i class="fa fa-check"></i><b>7.2</b> Implementation</a>
<ul>
<li class="chapter" data-level="" data-path="recloss.html"><a href="recloss.html#source-1"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="recloss.html"><a href="recloss.html#usage"><i class="fa fa-check"></i><b>7.3</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="final-output.html"><a href="final-output.html"><i class="fa fa-check"></i><b>8</b> Generate final archaeological record</a>
<ul>
<li class="chapter" data-level="8.1" data-path="final-output.html"><a href="final-output.html#using-sites-size-to-generate-deposit"><i class="fa fa-check"></i><b>8.1</b> Using sites size to generate deposit</a></li>
<li class="chapter" data-level="8.2" data-path="final-output.html"><a href="final-output.html#split-environment-in-a-grid"><i class="fa fa-check"></i><b>8.2</b> Split environment in a grid</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="final-output.html"><a href="final-output.html#giving-name-to-the-publicly-available-data"><i class="fa fa-check"></i><b>8.2.1</b> Giving name to the publicly available data</a></li>
<li class="chapter" data-level="8.2.2" data-path="final-output.html"><a href="final-output.html#export-and-download-dates"><i class="fa fa-check"></i><b>8.2.2</b> Export and download dates</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="final-output.html"><a href="final-output.html#bonus-maps"><i class="fa fa-check"></i><b>8.3</b> Bonus maps</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="original-challenge.html"><a href="original-challenge.html"><i class="fa fa-check"></i><b>9</b> Archaeoriddle: the original challenge</a>
<ul>
<li class="chapter" data-level="9.1" data-path="original-challenge.html"><a href="original-challenge.html#context"><i class="fa fa-check"></i><b>9.1</b> Context</a></li>
<li class="chapter" data-level="9.2" data-path="original-challenge.html"><a href="original-challenge.html#implementation-2"><i class="fa fa-check"></i><b>9.2</b> Implementation</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="original-challenge.html"><a href="original-challenge.html#generate-and-share-final-simulation"><i class="fa fa-check"></i><b>9.2.1</b> Generate and share final simulation</a></li>
<li class="chapter" data-level="9.2.2" data-path="original-challenge.html"><a href="original-challenge.html#split-environment-in-a-grid-1"><i class="fa fa-check"></i><b>9.2.2</b> Split environment in a grid</a></li>
<li class="chapter" data-level="9.2.3" data-path="original-challenge.html"><a href="original-challenge.html#naming"><i class="fa fa-check"></i><b>9.2.3</b> Giving name to the publicly available data</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="original-challenge.html"><a href="original-challenge.html#the-challenge"><i class="fa fa-check"></i><b>9.3</b> The challenge</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="original-challenge.html"><a href="original-challenge.html#research-question"><i class="fa fa-check"></i><b>9.3.1</b> Research Question</a></li>
<li class="chapter" data-level="9.3.2" data-path="original-challenge.html"><a href="original-challenge.html#challenge-eaa-workshop"><i class="fa fa-check"></i><b>9.3.2</b> Challenge &amp; EAA workshop</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="original-challenge.html"><a href="original-challenge.html#proposals"><i class="fa fa-check"></i><b>9.4</b> Proposals</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="original-challenge.html"><a href="original-challenge.html#p1"><i class="fa fa-check"></i><b>9.4.1</b> P1</a></li>
<li class="chapter" data-level="9.4.2" data-path="original-challenge.html"><a href="original-challenge.html#p2"><i class="fa fa-check"></i><b>9.4.2</b> P2</a></li>
<li class="chapter" data-level="9.4.3" data-path="original-challenge.html"><a href="original-challenge.html#p3"><i class="fa fa-check"></i><b>9.4.3</b> P3</a></li>
<li class="chapter" data-level="9.4.4" data-path="original-challenge.html"><a href="original-challenge.html#p4"><i class="fa fa-check"></i><b>9.4.4</b> P4</a></li>
<li class="chapter" data-level="9.4.5" data-path="original-challenge.html"><a href="original-challenge.html#p5"><i class="fa fa-check"></i><b>9.4.5</b> P5</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/acortell3/archaeoriddle/">
source</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Methods Riddles, the ultimate revelations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="env" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Landscape &amp; Resources<a href="env.html#env" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>To simulate the interaction between two groups, we need an environment in which they can interact in. This chapter walks you through how to generate a landscape and an environment for your simulated groups to explore.
An important part of the simulation is to generate a landscape and an environment. Environmental variable are often autocorrelated. For example, The temperature at a given time is never <em>extremly</em> different to the temperature slightly before and slightly after this time. Same is true with the slope, or the elevation of a place,</p>
<div id="autocorrelated-noise-generation" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Autocorrelated noise generation<a href="env.html#autocorrelated-noise-generation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>An interesting way to generate such auto-correlated variable is to use <a href="https://en.wikipedia.org/wiki/Colors_of_noise">coloured noise</a>. This use specific distribution to define the relation between frequencies found in your signal with the power of these frequencies. In <a href="https://en.wikipedia.org/wiki/Pink_noise">pink noise</a> (or <span class="math inline">\(\frac{1}{f}\)</span>-noise) for example, the power of each frequencis will be invertly proportional to the frequencies (<em>ie</em> you will have, low frequencies with high power, high frequencies with low ones). We defined an <code>environment</code> function, which in turns uses <code>TK95</code> to generate a power law noise.</p>
<p>To generate a single auto-correlated variable (like temperature), whoâ€™s spectrum decomposition ( power wrt frequency) has a slope of -3 and a standard deviation of 1.5:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="env.html#cb7-1" tabindex="-1"></a>tstep <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb7-2"><a href="env.html#cb7-2" tabindex="-1"></a>faketemp <span class="ot">&lt;-</span> <span class="fu">environment</span>(tstep, <span class="at">omega=</span><span class="dv">3</span>, <span class="at">delta=</span><span class="fl">1.5</span>) <span class="sc">+</span> <span class="fl">1.5</span></span>
<span id="cb7-3"><a href="env.html#cb7-3" tabindex="-1"></a><span class="fu">plot</span>(faketemp, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;temperature change&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;time&quot;</span>,<span class="at">lwd=</span><span class="dv">3</span>)   </span></code></pre></div>
<p><img src="_main_files/figure-html/generateFakeClimate-1.png" width="672" /></p>
You can inspect the code of <code>environment</code> and <code>TK95</code> functions here:
<details>
<summary>
Show code
</summary>
<p><strong>Code</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="env.html#cb8-1" tabindex="-1"></a><span class="do">## Function 10. Power law noise from Kimmer &amp; Koening</span></span>
<span id="cb8-2"><a href="env.html#cb8-2" tabindex="-1"></a>TK95 <span class="ot">&lt;-</span> <span class="cf">function</span>(N, <span class="at">alpha =</span> <span class="dv">1</span>){ </span>
<span id="cb8-3"><a href="env.html#cb8-3" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span>pi, <span class="at">length.out=</span>(N<span class="sc">/</span><span class="dv">2</span><span class="sc">+</span><span class="dv">1</span>))[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,(N<span class="sc">/</span><span class="dv">2</span><span class="sc">+</span><span class="dv">1</span>))] <span class="co"># Fourier frequencies</span></span>
<span id="cb8-4"><a href="env.html#cb8-4" tabindex="-1"></a>  f_ <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> f<span class="sc">^</span>alpha <span class="co"># Power law</span></span>
<span id="cb8-5"><a href="env.html#cb8-5" tabindex="-1"></a>  RW <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fl">0.5</span><span class="sc">*</span>f_) <span class="sc">*</span> <span class="fu">rnorm</span>(N<span class="sc">/</span><span class="dv">2-1</span>) <span class="co"># for the real part</span></span>
<span id="cb8-6"><a href="env.html#cb8-6" tabindex="-1"></a>  IW <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fl">0.5</span><span class="sc">*</span>f_) <span class="sc">*</span> <span class="fu">rnorm</span>(N<span class="sc">/</span><span class="dv">2-1</span>) <span class="co"># for the imaginary part</span></span>
<span id="cb8-7"><a href="env.html#cb8-7" tabindex="-1"></a>  fR <span class="ot">&lt;-</span> <span class="fu">complex</span>(<span class="at">real=</span><span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>), RW, <span class="fu">rnorm</span>(<span class="dv">1</span>), RW[(N<span class="sc">/</span><span class="dv">2-1</span>)<span class="sc">:</span><span class="dv">1</span>]), </span>
<span id="cb8-8"><a href="env.html#cb8-8" tabindex="-1"></a>                <span class="at">imaginary=</span><span class="fu">c</span>(<span class="dv">0</span>, IW, <span class="dv">0</span>, <span class="sc">-</span>IW[(N<span class="sc">/</span><span class="dv">2-1</span>)<span class="sc">:</span><span class="dv">1</span>]),</span>
<span id="cb8-9"><a href="env.html#cb8-9" tabindex="-1"></a>                <span class="at">length.out=</span>N)</span>
<span id="cb8-10"><a href="env.html#cb8-10" tabindex="-1"></a>  <span class="co"># Those complex numbers that are to be back transformed for</span></span>
<span id="cb8-11"><a href="env.html#cb8-11" tabindex="-1"></a>  <span class="co"># Fourier Frequencies 0, 2pi/N, 2*2pi/N, ..., pi, ..., 2pi-1/N </span></span>
<span id="cb8-12"><a href="env.html#cb8-12" tabindex="-1"></a>  <span class="co"># Choose in a way that frequencies are complex-conjugated and symmetric around pi </span></span>
<span id="cb8-13"><a href="env.html#cb8-13" tabindex="-1"></a>  <span class="co"># 0 and pi do not need an imaginary part</span></span>
<span id="cb8-14"><a href="env.html#cb8-14" tabindex="-1"></a>  reihe <span class="ot">&lt;-</span> <span class="fu">fft</span>(fR, <span class="at">inverse=</span><span class="cn">TRUE</span>) <span class="co"># go back into time domain</span></span>
<span id="cb8-15"><a href="env.html#cb8-15" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">Re</span>(reihe)) <span class="co"># imaginary part is 0</span></span>
<span id="cb8-16"><a href="env.html#cb8-16" tabindex="-1"></a>}</span>
<span id="cb8-17"><a href="env.html#cb8-17" tabindex="-1"></a></span>
<span id="cb8-18"><a href="env.html#cb8-18" tabindex="-1"></a><span class="do">## Function 11. Environment generator</span></span>
<span id="cb8-19"><a href="env.html#cb8-19" tabindex="-1"></a>environment <span class="ot">&lt;-</span> <span class="cf">function</span>(N, omega, delta, <span class="at">vt=</span><span class="cn">NULL</span>){</span>
<span id="cb8-20"><a href="env.html#cb8-20" tabindex="-1"></a>  ts <span class="ot">&lt;-</span> <span class="fu">TK95</span>(N, omega)</span>
<span id="cb8-21"><a href="env.html#cb8-21" tabindex="-1"></a>  ts <span class="ot">&lt;-</span> delta <span class="sc">*</span> ts<span class="sc">/</span><span class="fu">sd</span>(ts)</span>
<span id="cb8-22"><a href="env.html#cb8-22" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(vt)) {</span>
<span id="cb8-23"><a href="env.html#cb8-23" tabindex="-1"></a>    ts <span class="ot">=</span> ts <span class="sc">+</span> vt<span class="sc">*</span><span class="dv">1</span><span class="sc">:</span>N</span>
<span id="cb8-24"><a href="env.html#cb8-24" tabindex="-1"></a>  }</span>
<span id="cb8-25"><a href="env.html#cb8-25" tabindex="-1"></a>  <span class="fu">return</span>(ts)</span>
<span id="cb8-26"><a href="env.html#cb8-26" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>This generates autocorrelated time series that can be used to define temporal change in climate (rain, temperature, etcâ€¦.). But we havenâ€™t used such changes for the Archaeoriddle challenge. Coloured noise remains a very straightforward way to simulated factor and could be easily added in the simulations.</p>
</div>
<div id="slope-and-elevation" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Slope and Elevation<a href="env.html#slope-and-elevation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>An important aspect of the simulation is a way to generate elevation and slope. To generate 2D autocorrelation we used a slightly methods known as <a href="https://en.wikipedia.org/wiki/Perlin_noise">perlin noise</a> ; using the implementation found on <a href="https://stackoverflow.com/questions/15387328/realistic-simulated-elevation-data-in-r-perlin-noise">this stackoverflow.com post</a>.</p>
<p><br></p>
And you can see the code here:
<details>
<summary>
Show code
</summary>
<p><strong>Code</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="env.html#cb9-1" tabindex="-1"></a><span class="do">## Function 12. Perlin noise</span></span>
<span id="cb9-2"><a href="env.html#cb9-2" tabindex="-1"></a>perlin_noise <span class="ot">&lt;-</span> <span class="cf">function</span>( </span>
<span id="cb9-3"><a href="env.html#cb9-3" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">5</span>,   <span class="at">m =</span> <span class="dv">7</span>,    </span>
<span id="cb9-4"><a href="env.html#cb9-4" tabindex="-1"></a>    <span class="at">N =</span> <span class="dv">100</span>, <span class="at">M =</span> <span class="dv">100</span></span>
<span id="cb9-5"><a href="env.html#cb9-5" tabindex="-1"></a>) {</span>
<span id="cb9-6"><a href="env.html#cb9-6" tabindex="-1"></a>  <span class="co"># For each point on this n*m grid, choose a unit 1 vector</span></span>
<span id="cb9-7"><a href="env.html#cb9-7" tabindex="-1"></a>  vector_field <span class="ot">&lt;-</span> <span class="fu">apply</span>(</span>
<span id="cb9-8"><a href="env.html#cb9-8" tabindex="-1"></a>    <span class="fu">array</span>( <span class="fu">rnorm</span>( <span class="dv">2</span> <span class="sc">*</span> n <span class="sc">*</span> m ), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>,n,m) ),</span>
<span id="cb9-9"><a href="env.html#cb9-9" tabindex="-1"></a>    <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb9-10"><a href="env.html#cb9-10" tabindex="-1"></a>    <span class="cf">function</span>(u) u <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(u<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb9-11"><a href="env.html#cb9-11" tabindex="-1"></a>  )</span>
<span id="cb9-12"><a href="env.html#cb9-12" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb9-13"><a href="env.html#cb9-13" tabindex="-1"></a>    <span class="co"># Find the grid cell in which the point (x,y) is</span></span>
<span id="cb9-14"><a href="env.html#cb9-14" tabindex="-1"></a>    i <span class="ot">&lt;-</span> <span class="fu">floor</span>(x)</span>
<span id="cb9-15"><a href="env.html#cb9-15" tabindex="-1"></a>    j <span class="ot">&lt;-</span> <span class="fu">floor</span>(y)</span>
<span id="cb9-16"><a href="env.html#cb9-16" tabindex="-1"></a>    <span class="fu">stopifnot</span>( i <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">||</span> j <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">||</span> i <span class="sc">&lt;</span> n <span class="sc">||</span> j <span class="sc">&lt;</span> m )</span>
<span id="cb9-17"><a href="env.html#cb9-17" tabindex="-1"></a>    <span class="co"># The 4 vectors, from the vector field, at the vertices of the square</span></span>
<span id="cb9-18"><a href="env.html#cb9-18" tabindex="-1"></a>    v1 <span class="ot">&lt;-</span> vector_field[, i, j]</span>
<span id="cb9-19"><a href="env.html#cb9-19" tabindex="-1"></a>    v2 <span class="ot">&lt;-</span> vector_field[, i<span class="sc">+</span><span class="dv">1</span>, j]</span>
<span id="cb9-20"><a href="env.html#cb9-20" tabindex="-1"></a>    v3 <span class="ot">&lt;-</span> vector_field[, i, j<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb9-21"><a href="env.html#cb9-21" tabindex="-1"></a>    v4 <span class="ot">&lt;-</span> vector_field[, i<span class="sc">+</span><span class="dv">1</span>, j<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb9-22"><a href="env.html#cb9-22" tabindex="-1"></a>    <span class="co"># Vectors from the point to the vertices</span></span>
<span id="cb9-23"><a href="env.html#cb9-23" tabindex="-1"></a>    u1 <span class="ot">&lt;-</span> <span class="fu">c</span>(x,y) <span class="sc">-</span> <span class="fu">c</span>(i, j)</span>
<span id="cb9-24"><a href="env.html#cb9-24" tabindex="-1"></a>    u2 <span class="ot">&lt;-</span> <span class="fu">c</span>(x,y) <span class="sc">-</span> <span class="fu">c</span>(i<span class="sc">+</span><span class="dv">1</span>, j)</span>
<span id="cb9-25"><a href="env.html#cb9-25" tabindex="-1"></a>    u3 <span class="ot">&lt;-</span> <span class="fu">c</span>(x,y) <span class="sc">-</span> <span class="fu">c</span>(i, j<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb9-26"><a href="env.html#cb9-26" tabindex="-1"></a>    u4 <span class="ot">&lt;-</span> <span class="fu">c</span>(x,y) <span class="sc">-</span> <span class="fu">c</span>(i<span class="sc">+</span><span class="dv">1</span>, j<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb9-27"><a href="env.html#cb9-27" tabindex="-1"></a>    <span class="co"># Scalar products</span></span>
<span id="cb9-28"><a href="env.html#cb9-28" tabindex="-1"></a>    a1 <span class="ot">&lt;-</span> <span class="fu">sum</span>( v1 <span class="sc">*</span> u1 )</span>
<span id="cb9-29"><a href="env.html#cb9-29" tabindex="-1"></a>    a2 <span class="ot">&lt;-</span> <span class="fu">sum</span>( v2 <span class="sc">*</span> u2 )</span>
<span id="cb9-30"><a href="env.html#cb9-30" tabindex="-1"></a>    a3 <span class="ot">&lt;-</span> <span class="fu">sum</span>( v3 <span class="sc">*</span> u3 )</span>
<span id="cb9-31"><a href="env.html#cb9-31" tabindex="-1"></a>    a4 <span class="ot">&lt;-</span> <span class="fu">sum</span>( v4 <span class="sc">*</span> u4 )</span>
<span id="cb9-32"><a href="env.html#cb9-32" tabindex="-1"></a>    <span class="co"># Weighted average of the scalar products</span></span>
<span id="cb9-33"><a href="env.html#cb9-33" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="cf">function</span>(p) <span class="dv">3</span> <span class="sc">*</span> p<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> p<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb9-34"><a href="env.html#cb9-34" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">s</span>( x <span class="sc">-</span> i )</span>
<span id="cb9-35"><a href="env.html#cb9-35" tabindex="-1"></a>    q <span class="ot">&lt;-</span> <span class="fu">s</span>( y <span class="sc">-</span> j )</span>
<span id="cb9-36"><a href="env.html#cb9-36" tabindex="-1"></a>    b1 <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">*</span>a1 <span class="sc">+</span> p<span class="sc">*</span>a2</span>
<span id="cb9-37"><a href="env.html#cb9-37" tabindex="-1"></a>    b2 <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">*</span>a3 <span class="sc">+</span> p<span class="sc">*</span>a4</span>
<span id="cb9-38"><a href="env.html#cb9-38" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">-</span>q) <span class="sc">*</span> b1 <span class="sc">+</span> q <span class="sc">*</span> b2</span>
<span id="cb9-39"><a href="env.html#cb9-39" tabindex="-1"></a>  }</span>
<span id="cb9-40"><a href="env.html#cb9-40" tabindex="-1"></a>  xs <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> n, <span class="at">length =</span> N<span class="sc">+</span><span class="dv">1</span>)[<span class="sc">-</span>(N<span class="sc">+</span><span class="dv">1</span>)]</span>
<span id="cb9-41"><a href="env.html#cb9-41" tabindex="-1"></a>  ys <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> m, <span class="at">length =</span> M<span class="sc">+</span><span class="dv">1</span>)[<span class="sc">-</span>(M<span class="sc">+</span><span class="dv">1</span>)]</span>
<span id="cb9-42"><a href="env.html#cb9-42" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">outer</span>( xs, ys, <span class="fu">Vectorize</span>(f) ))</span>
<span id="cb9-43"><a href="env.html#cb9-43" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Various parameters for the Perlin noise will result in either a higher or lower level of definition for our future DEM raster. Our aim is to find a balance between having the environment sufficiently detailed across a relatively wide area, while also ensuring it remains manageable in terms of memory usage.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="env.html#cb10-1" tabindex="-1"></a><span class="fu">require</span>(terra)</span>
<span id="cb10-2"><a href="env.html#cb10-2" tabindex="-1"></a><span class="fu">require</span>(sf)</span>
<span id="cb10-3"><a href="env.html#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="env.html#cb10-4" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb10-5"><a href="env.html#cb10-5" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb10-6"><a href="env.html#cb10-6" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">perlin_noise</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span><span class="sc">^</span>k, <span class="dv">2</span><span class="sc">^</span>k)</span>
<span id="cb10-7"><a href="env.html#cb10-7" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>k )</span>
<span id="cb10-8"><a href="env.html#cb10-8" tabindex="-1"></a>  m <span class="ot">&lt;-</span> m <span class="sc">+</span> a<span class="sc">^</span>i <span class="sc">*</span> <span class="fu">perlin_noise</span>(<span class="dv">2</span><span class="sc">^</span>i, <span class="dv">2</span><span class="sc">^</span>i, <span class="dv">2</span><span class="sc">^</span>k, <span class="dv">2</span><span class="sc">^</span>k)</span></code></pre></div>
<p>If we change k (that dictates the total resolution of the DEM), the size of the raster grow explonentially and would be quickly hard to manage.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="env.html#cb11-1" tabindex="-1"></a></span>
<span id="cb11-2"><a href="env.html#cb11-2" tabindex="-1"></a>allsizes <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,<span class="cf">function</span>(k)</span>
<span id="cb11-3"><a href="env.html#cb11-3" tabindex="-1"></a>{</span>
<span id="cb11-4"><a href="env.html#cb11-4" tabindex="-1"></a>    <span class="fu">print</span>(k)</span>
<span id="cb11-5"><a href="env.html#cb11-5" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">perlin_noise</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span><span class="sc">^</span>k, <span class="dv">2</span><span class="sc">^</span>k)</span>
<span id="cb11-6"><a href="env.html#cb11-6" tabindex="-1"></a>    <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>k ) m <span class="ot">&lt;-</span> m <span class="sc">+</span> <span class="fl">0.6</span><span class="sc">^</span>i <span class="sc">*</span> <span class="fu">perlin_noise</span>(<span class="dv">2</span><span class="sc">^</span>i, <span class="dv">2</span><span class="sc">^</span>i, <span class="dv">2</span><span class="sc">^</span>k, <span class="dv">2</span><span class="sc">^</span>k)</span>
<span id="cb11-7"><a href="env.html#cb11-7" tabindex="-1"></a>    <span class="fu">object.size</span>(m)  </span>
<span id="cb11-8"><a href="env.html#cb11-8" tabindex="-1"></a>})</span>
<span id="cb11-9"><a href="env.html#cb11-9" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb11-10"><a href="env.html#cb11-10" tabindex="-1"></a><span class="do">## [1] 2</span></span>
<span id="cb11-11"><a href="env.html#cb11-11" tabindex="-1"></a><span class="do">## [1] 3</span></span>
<span id="cb11-12"><a href="env.html#cb11-12" tabindex="-1"></a><span class="do">## [1] 4</span></span>
<span id="cb11-13"><a href="env.html#cb11-13" tabindex="-1"></a><span class="do">## [1] 5</span></span>
<span id="cb11-14"><a href="env.html#cb11-14" tabindex="-1"></a><span class="do">## [1] 6</span></span>
<span id="cb11-15"><a href="env.html#cb11-15" tabindex="-1"></a><span class="do">## [1] 7</span></span>
<span id="cb11-16"><a href="env.html#cb11-16" tabindex="-1"></a><span class="do">## [1] 8</span></span>
<span id="cb11-17"><a href="env.html#cb11-17" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">2</span><span class="sc">^</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),allsizes<span class="sc">/</span><span class="dv">1000</span>,<span class="at">type=</span><span class="st">&quot;b&quot;</span>,<span class="at">pch=</span><span class="dv">20</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>,<span class="at">cex=</span><span class="dv">2</span>,<span class="at">ylab=</span><span class="st">&quot;size of raster (kb)&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;resolution&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/explorePerlin-1.png" width="672" /></p>
<p>To enhance realism, slight adjustments were made to the extremes in order to create seas and mountains that more closely resemble those found in an <em>real</em> DEM.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="env.html#cb12-1" tabindex="-1"></a>height <span class="ot">&lt;-</span> (m[,])<span class="sc">*</span><span class="dv">20</span></span>
<span id="cb12-2"><a href="env.html#cb12-2" tabindex="-1"></a><span class="co">#height[height&lt;50]=0</span></span>
<span id="cb12-3"><a href="env.html#cb12-3" tabindex="-1"></a>height <span class="ot">&lt;-</span> height<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb12-4"><a href="env.html#cb12-4" tabindex="-1"></a>height <span class="ot">&lt;-</span> height<span class="sc">+</span><span class="fu">abs</span>(<span class="fu">mean</span>(height))</span>
<span id="cb12-5"><a href="env.html#cb12-5" tabindex="-1"></a>height[height<span class="sc">&lt;</span><span class="fu">min</span>(height)<span class="sc">*</span>.<span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="fu">min</span>(height)<span class="sc">*</span>.<span class="dv">25</span></span></code></pre></div>
<p>We can then visualise the result as a 2D raster. We setup the total extent of the raster to define exactly where it is on our GIS using a latlon projection.</p>
<p>We also define the mean high as the water level, all the thing below are then considered under water.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="env.html#cb13-1" tabindex="-1"></a>height.ras <span class="ot">&lt;-</span> <span class="fu">rast</span>(height, <span class="at">extent=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">3.5</span>), <span class="at">crs=</span><span class="st">&quot;+proj=latlon&quot;</span>)</span>
<span id="cb13-2"><a href="env.html#cb13-2" tabindex="-1"></a>maxh <span class="ot">&lt;-</span> <span class="fu">max</span>(height.ras[], <span class="at">na.rm=</span>T)</span>
<span id="cb13-3"><a href="env.html#cb13-3" tabindex="-1"></a><span class="fu">plot</span>(height.ras, <span class="at">col=</span><span class="fu">col_ramp</span>(<span class="dv">20</span>), <span class="at">legend=</span>F, <span class="at">reset=</span>F)</span>
<span id="cb13-4"><a href="env.html#cb13-4" tabindex="-1"></a>height.wat <span class="ot">&lt;-</span> height.ras</span>
<span id="cb13-5"><a href="env.html#cb13-5" tabindex="-1"></a>height.wat[height.wat<span class="sc">&gt;</span><span class="fu">mean</span>(height.wat[])] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb13-6"><a href="env.html#cb13-6" tabindex="-1"></a><span class="fu">plot</span>(height.wat, <span class="at">col=</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">add=</span>T, <span class="at">legend=</span>F)</span></code></pre></div>
<p><img src="_main_files/figure-html/2dVisu-1.png" width="672" /></p>
<p>This has been put in a function plotMap</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="env.html#cb14-1" tabindex="-1"></a><span class="fu">plotMap</span>(height.ras,height.wat)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>The actual raster used for the original <em>archaeoriddle</em> is available in <code>data_original/east_narnia4x.tif</code> and looks like</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="env.html#cb15-1" tabindex="-1"></a>original.ras <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&quot;data_original/east_narnia4x.tif&quot;</span>)</span>
<span id="cb15-2"><a href="env.html#cb15-2" tabindex="-1"></a>original.wat <span class="ot">&lt;-</span> original.ras</span>
<span id="cb15-3"><a href="env.html#cb15-3" tabindex="-1"></a>original.wat[original.wat<span class="sc">&gt;</span><span class="fu">mean</span>(original.wat[])] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb15-4"><a href="env.html#cb15-4" tabindex="-1"></a><span class="fu">plotMap</span>(original.ras,original.wat)</span></code></pre></div>
<p><img src="_main_files/figure-html/originalArchaeoriddle-1.png" width="672" /></p>
<p>If you really want to feel like being in a video game, you can play with rayshader, but getting the right parameters to have a nice rendering is tricky, slow, and itâ€™s not unlikely youâ€™ll loose a lot of time <code>Â¯\_(ãƒ„)_/Â¯</code></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="env.html#cb16-1" tabindex="-1"></a><span class="fu">require</span>(rayshader)</span>
<span id="cb16-2"><a href="env.html#cb16-2" tabindex="-1"></a>height_map <span class="ot">&lt;-</span> <span class="fu">raster_to_matrix</span>(raster<span class="sc">::</span><span class="fu">raster</span>(height)) </span>
<span id="cb16-3"><a href="env.html#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="env.html#cb16-4" tabindex="-1"></a>hm_shade <span class="ot">&lt;-</span> <span class="fu">sphere_shade</span>(height_map, <span class="at">texture =</span> <span class="st">&quot;imhof1&quot;</span>, <span class="at">zscale=</span><span class="dv">5</span>) </span>
<span id="cb16-5"><a href="env.html#cb16-5" tabindex="-1"></a>hm_ray <span class="ot">&lt;-</span> <span class="fu">add_shadow</span>(hm_shade, <span class="fu">ray_shade</span>(height_map, <span class="at">zscale =</span> <span class="dv">19</span>), <span class="fl">0.8</span>) </span>
<span id="cb16-6"><a href="env.html#cb16-6" tabindex="-1"></a>hm_ambiant <span class="ot">&lt;-</span> <span class="fu">add_shadow</span>(hm_ray, <span class="fu">ambient_shade</span>(height_map), <span class="dv">0</span>,<span class="dv">5</span>) </span>
<span id="cb16-7"><a href="env.html#cb16-7" tabindex="-1"></a>hm_lamb <span class="ot">&lt;-</span> <span class="fu">add_shadow</span>(hm_ambiant, <span class="fu">lamb_shade</span>(height_map), <span class="dv">0</span>) </span>
<span id="cb16-8"><a href="env.html#cb16-8" tabindex="-1"></a><span class="fu">plot_3d</span>(</span>
<span id="cb16-9"><a href="env.html#cb16-9" tabindex="-1"></a>  hm_lamb,height_map, <span class="at">zscale =</span> <span class="dv">10</span>, <span class="at">fov =</span> <span class="dv">0</span>, <span class="at">theta =</span> <span class="dv">20</span>, <span class="at">zoom =</span> .<span class="dv">5</span>, <span class="at">phi =</span> <span class="dv">45</span>,</span>
<span id="cb16-10"><a href="env.html#cb16-10" tabindex="-1"></a>  <span class="at">windowsize =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">800</span>),<span class="at">water =</span> <span class="cn">TRUE</span>, <span class="at">waterdepth =</span> <span class="dv">0</span>,</span>
<span id="cb16-11"><a href="env.html#cb16-11" tabindex="-1"></a>  <span class="at">wateralpha =</span> <span class="dv">1</span>, <span class="at">watercolor =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">waterlinecolor =</span> <span class="st">&quot;lightblue&quot;</span>,</span>
<span id="cb16-12"><a href="env.html#cb16-12" tabindex="-1"></a>  <span class="at">waterlinealpha =</span> .<span class="dv">7</span>, <span class="at">baseshape=</span><span class="st">&quot;hex&quot;</span>)</span>
<span id="cb16-13"><a href="env.html#cb16-13" tabindex="-1"></a></span>
<span id="cb16-14"><a href="env.html#cb16-14" tabindex="-1"></a><span class="co">#HQ render, very slow</span></span>
<span id="cb16-15"><a href="env.html#cb16-15" tabindex="-1"></a><span class="co">#render_highquality( samples=256, clear = TRUE,light=TRUE)</span></span></code></pre></div>
</div>
<div id="environmental-resources" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Environmental resources<a href="env.html#environmental-resources" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will generate zones of higher resources/fitness that will attract settlements and support higher carrying capacity <em>ie</em> population size.
The resources will be located at given hotspots with an area around in which they decay
with a logistic function. We provide a very basic function <code>logisticdecay</code> which allow to define multiple source with different decay array around them.</p>
Hereâ€™s the code for the generation of resources under logistic decay
<details>
<summary>
Show code
</summary>
<p><strong>Code</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="env.html#cb17-1" tabindex="-1"></a><span class="do">## Fucntion 13. Logistic decay for resource generation</span></span>
<span id="cb17-2"><a href="env.html#cb17-2" tabindex="-1"></a>logisticdecay <span class="ot">&lt;-</span> <span class="cf">function</span>(pt, rast, <span class="at">L=</span><span class="dv">1</span>, <span class="at">k=</span><span class="fl">0.0001</span>, <span class="at">x0=</span><span class="dv">60000</span>){</span>
<span id="cb17-3"><a href="env.html#cb17-3" tabindex="-1"></a>  ds <span class="ot">&lt;-</span> <span class="fu">distance</span>(rast, pt)</span>
<span id="cb17-4"><a href="env.html#cb17-4" tabindex="-1"></a>  logdec <span class="ot">=</span> L<span class="sc">-</span>L<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>k<span class="sc">*</span>(ds<span class="sc">-</span>x0)))</span>
<span id="cb17-5"><a href="env.html#cb17-5" tabindex="-1"></a>  <span class="fu">return</span>(logdec)</span>
<span id="cb17-6"><a href="env.html#cb17-6" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p><br></p>
<p>For the original <em>archaeoriddle</em>, these hotspots and their radius were manually selected given the topography of Rabbit Hole. These manual setups are given below:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="env.html#cb18-1" tabindex="-1"></a><span class="do">##resource geolocalisation set manually</span></span>
<span id="cb18-2"><a href="env.html#cb18-2" tabindex="-1"></a>goodresources <span class="ot">&lt;-</span> <span class="fu">vect</span>(</span>
<span id="cb18-3"><a href="env.html#cb18-3" tabindex="-1"></a>  <span class="fu">cbind</span>(</span>
<span id="cb18-4"><a href="env.html#cb18-4" tabindex="-1"></a>    <span class="at">x=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2300711</span>, <span class="sc">-</span><span class="fl">3.1455282</span>, <span class="sc">-</span><span class="fl">0.5086485</span>, <span class="sc">-</span><span class="fl">1.9639755</span>,</span>
<span id="cb18-5"><a href="env.html#cb18-5" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">0.4077843</span>, <span class="fl">0.019688</span>, <span class="sc">-</span><span class="fl">3.116710</span>),</span>
<span id="cb18-6"><a href="env.html#cb18-6" tabindex="-1"></a>    <span class="at">y=</span><span class="fu">c</span>(<span class="fl">3.6423000</span>, <span class="sc">-</span><span class="fl">0.2551019</span>, <span class="sc">-</span><span class="fl">0.7440748</span>, <span class="fl">1.1303214</span>,</span>
<span id="cb18-7"><a href="env.html#cb18-7" tabindex="-1"></a>        <span class="fl">1.0248567</span>, <span class="fl">0.2194895</span>, <span class="fl">2.0267718</span>)</span>
<span id="cb18-8"><a href="env.html#cb18-8" tabindex="-1"></a>  )</span>
<span id="cb18-9"><a href="env.html#cb18-9" tabindex="-1"></a>)</span>
<span id="cb18-10"><a href="env.html#cb18-10" tabindex="-1"></a><span class="co">#spread of resources</span></span>
<span id="cb18-11"><a href="env.html#cb18-11" tabindex="-1"></a>areas <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">2000</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">400</span>)</span>
<span id="cb18-12"><a href="env.html#cb18-12" tabindex="-1"></a><span class="co">#speed of ressource decay:</span></span>
<span id="cb18-13"><a href="env.html#cb18-13" tabindex="-1"></a>ks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.0002</span>, <span class="fl">0.0001000</span>, <span class="fl">0.0001600</span>, <span class="fl">0.0001800</span>, <span class="fl">0.00040</span>, .<span class="dv">0002</span>, <span class="fl">0.0002</span>)<span class="sc">/</span><span class="dv">4</span></span>
<span id="cb18-14"><a href="env.html#cb18-14" tabindex="-1"></a></span>
<span id="cb18-15"><a href="env.html#cb18-15" tabindex="-1"></a></span>
<span id="cb18-16"><a href="env.html#cb18-16" tabindex="-1"></a><span class="fu">crs</span>(goodresources) <span class="ot">&lt;-</span> <span class="fu">crs</span>(original.ras)</span></code></pre></div>
<p>The function <code>logisticdecay</code> generates individual rasters for all the identified hotspots, which are then merged to create an aggregate raster referred to as â€˜resourcesâ€™.</p>
<p>When considering the selection of hotspots, one may choose to retain the one utilized for the <em>archaeoriddle</em> but to adjust these resources center to your own topography ; one can use <code>locator()</code> to find the coordinates of the hotspot by clicking on the map. An example of that is given in <a href="env.html#manual-selection">this section of the chapter</a></p>
<p>These resource span along all the map but we want to restrict them to place where peoplewill be able to settle
Given this new landscape we can now generate sites in specific locations. We first need to define <em>where</em> the sites <em>can</em> appear (not in water nor too high in the mountains) ; so we first create a raster â€˜viableâ€™ which will give a binary maps where group of human can leave or not.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="env.html#cb19-1" tabindex="-1"></a>height.groups <span class="ot">&lt;-</span> height.ras <span class="co"># taking back the raster created before</span></span>
<span id="cb19-2"><a href="env.html#cb19-2" tabindex="-1"></a>height.groups[height.groups<span class="sc">&lt;</span><span class="fu">mean</span>(height.groups[])] <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co">#replace values that are below mean level (under water)</span></span>
<span id="cb19-3"><a href="env.html#cb19-3" tabindex="-1"></a>height.groups[height.groups<span class="sc">&lt;</span>(maxh<span class="sc">*</span>.<span class="dv">7</span>)] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># values below 70% of the maximum height are set as 1</span></span>
<span id="cb19-4"><a href="env.html#cb19-4" tabindex="-1"></a>height.groups[height.groups<span class="sc">&gt;</span>(maxh<span class="sc">*</span>.<span class="dv">7</span>)] <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co"># value above at 200 (high mountains)</span></span>
<span id="cb19-5"><a href="env.html#cb19-5" tabindex="-1"></a>height.groups[<span class="fu">is.na</span>(height.groups)] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="co">#  NA values (below waters) are set to -1</span></span>
<span id="cb19-6"><a href="env.html#cb19-6" tabindex="-1"></a>height.poly <span class="ot">&lt;-</span> <span class="fu">as.polygons</span>(height.groups) <span class="co"># convert height.groups as polygons that will be of three type: -1 =&gt; under water, 1, viable, and 200, high mountaines</span></span>
<span id="cb19-7"><a href="env.html#cb19-7" tabindex="-1"></a>viable <span class="ot">&lt;-</span> <span class="fu">makeValid</span>(height.poly[<span class="dv">2</span>,]) <span class="co"># select polygon with &#39;1&#39; and make it a valid polygon as it may have some loop and problems</span></span></code></pre></div>
<p>We now have also have a polygon <code>viable</code> representing the space where sites can be create.
This space is representing by the green area on the map below.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="env.html#cb20-1" tabindex="-1"></a><span class="fu">plot</span>(viable,<span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&quot;chartreuse&quot;</span>,.<span class="dv">8</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/viablearea-1.png" width="672" /></p>
<p>We then loop over all center manually defined previously and apply the logicitc decay within the <code>viable</code> raster.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="env.html#cb21-1" tabindex="-1"></a></span>
<span id="cb21-2"><a href="env.html#cb21-2" tabindex="-1"></a>allres <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb21-3"><a href="env.html#cb21-3" tabindex="-1"></a>  <span class="fu">seq_along</span>(goodresources),</span>
<span id="cb21-4"><a href="env.html#cb21-4" tabindex="-1"></a>  <span class="cf">function</span>(i){</span>
<span id="cb21-5"><a href="env.html#cb21-5" tabindex="-1"></a>    <span class="fu">logisticdecay</span>(goodresources[i], <span class="fu">mask</span>(height.ras, viable),</span>
<span id="cb21-6"><a href="env.html#cb21-6" tabindex="-1"></a>                  <span class="at">x=</span>areas[i], <span class="at">k=</span>ks[i]</span>
<span id="cb21-7"><a href="env.html#cb21-7" tabindex="-1"></a>    )</span>
<span id="cb21-8"><a href="env.html#cb21-8" tabindex="-1"></a>  }</span>
<span id="cb21-9"><a href="env.html#cb21-9" tabindex="-1"></a>)</span>
<span id="cb21-10"><a href="env.html#cb21-10" tabindex="-1"></a><span class="do">## |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          </span></span>
<span id="cb21-11"><a href="env.html#cb21-11" tabindex="-1"></a></span>
<span id="cb21-12"><a href="env.html#cb21-12" tabindex="-1"></a>allna <span class="ot">&lt;-</span> <span class="fu">sapply</span>(allres, <span class="cf">function</span>(i)<span class="fu">any</span>(<span class="fu">is.na</span>(<span class="fu">values</span>(i))))</span>
<span id="cb21-13"><a href="env.html#cb21-13" tabindex="-1"></a>allres <span class="ot">&lt;-</span> allres[<span class="sc">!</span>allna]</span></code></pre></div>
<p>And when the add all the ressource raster, which gives us a final <code>ress</code> raster as below:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="env.html#cb22-1" tabindex="-1"></a>ress <span class="ot">&lt;-</span> allres[[<span class="dv">1</span>]]</span>
<span id="cb22-2"><a href="env.html#cb22-2" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(allres))</span>
<span id="cb22-3"><a href="env.html#cb22-3" tabindex="-1"></a>    ress <span class="ot">&lt;-</span> ress <span class="sc">+</span> allres[[i]]</span>
<span id="cb22-4"><a href="env.html#cb22-4" tabindex="-1"></a>ress <span class="ot">&lt;-</span> <span class="fu">mask</span>(ress,viable)</span>
<span id="cb22-5"><a href="env.html#cb22-5" tabindex="-1"></a><span class="fu">plot</span>(ress)</span></code></pre></div>
<p><img src="_main_files/figure-html/showresrouce-1.png" width="672" /></p>
</div>
<div id="manual-selection" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Manually Select Resources<a href="env.html#manual-selection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Below some useful code to manually select the resource origins on the map (by clicking on the screen) and explore different decays around them</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="env.html#cb23-1" tabindex="-1"></a><span class="fu">plotMap</span>(height.ras, height.wat, <span class="fu">paste0</span>(<span class="st">&quot;year &quot;</span>, <span class="dv">0</span>))</span>
<span id="cb23-2"><a href="env.html#cb23-2" tabindex="-1"></a>new_site <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="fu">as.data.frame</span>(<span class="fu">locator</span>()), <span class="at">geom=</span><span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>))  <span class="co"># select point on the screen</span></span>
<span id="cb23-3"><a href="env.html#cb23-3" tabindex="-1"></a><span class="fu">crs</span>(new_site) <span class="ot">&lt;-</span> <span class="fu">crs</span>(height.ras)</span>
<span id="cb23-4"><a href="env.html#cb23-4" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">logisticdecay</span>(new_site, height.ras, <span class="at">x=</span><span class="dv">20000</span>) <span class="co"># generate a logistic decay around the point</span></span>
<span id="cb23-5"><a href="env.html#cb23-5" tabindex="-1"></a></span>
<span id="cb23-6"><a href="env.html#cb23-6" tabindex="-1"></a><span class="fu">plot</span>(d2)</span>
<span id="cb23-7"><a href="env.html#cb23-7" tabindex="-1"></a>w <span class="ot">&lt;-</span> (<span class="fl">0.7</span><span class="sc">*</span>d2 <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">*</span>ress) <span class="sc">/</span> (<span class="fl">0.7</span><span class="sc">*</span><span class="fu">minmax</span>(d2)[<span class="dv">2</span>] <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">*</span><span class="fu">minmax</span>(ress)[<span class="dv">2</span>])</span>
<span id="cb23-8"><a href="env.html#cb23-8" tabindex="-1"></a><span class="fu">plot</span>(w)</span>
<span id="cb23-9"><a href="env.html#cb23-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">mask</span>(w<span class="sc">*</span><span class="fu">logisticdecay</span>(new_site, height.ras, <span class="at">k=</span><span class="fl">0.00002</span>, <span class="at">x=</span><span class="dv">1</span>), territory))</span>
<span id="cb23-10"><a href="env.html#cb23-10" tabindex="-1"></a></span>
<span id="cb23-11"><a href="env.html#cb23-11" tabindex="-1"></a>multisamp <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb23-12"><a href="env.html#cb23-12" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb23-13"><a href="env.html#cb23-13" tabindex="-1"></a>  <span class="cf">function</span>(i){</span>
<span id="cb23-14"><a href="env.html#cb23-14" tabindex="-1"></a>    <span class="fu">spatSample</span>(<span class="at">x=</span>w, <span class="at">size=</span><span class="dv">1</span>, <span class="at">method=</span><span class="st">&quot;weights&quot;</span>, <span class="at">xy=</span>T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb23-15"><a href="env.html#cb23-15" tabindex="-1"></a>  }</span>
<span id="cb23-16"><a href="env.html#cb23-16" tabindex="-1"></a>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="popgrowth.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
