---
output:
  html_document: default
  pdf_document: default
  always_allow_html: true
---

# Record formation

## Theoretical model
We have produced an Agent-Based Model, replicating the process of formation of the archaeological record in a specific site, accounting for different variables. In order to consider the possible relation between those variables, we have decided to express them as a Directed Acyclic Graph (DAG), following the ECS-DAG methodology proposed by Ferguson et al. (2020). In this case, however, and because our goal is to obtain an accurate initial template for the development of the model, we have not considered setting an exposure variable, but rather to propose different theoretic directional and causal relationships without relying on the conventional exposure-outcome assessment. Therefore, highlights in the graph below do not intend to differentiate among confounders, mediators, etc., but to emphasize the possible weight that each variable has for producing the outcome (produced waste by $m^2$).

```{r, echo = FALSE}
library(DiagrammeR)

grViz("
digraph record_formation {

graph [layout = dot, ## Set title and layout
       label = 'Record formation process',
       labelloc = 't'
       fontname = Helvetica,
       fontsize = 30]

# node definitions with substituted label text
node [fontname = Helvetica, ## General node definition
      style = filled,
      color = MistyRose]
      
## Per node definition
a [label = '@@1',
   fillcolor = Orangered]
b [label = '@@2']
c [label = '@@3',
   fillcolor = Orangered]
d [label = '@@4']
e [label = '@@5',
   fillcolor = Orangered]
f [label = '@@6',
   fillcolor = orange,
   fixedsize = shape,
   width = 4.5,
   height = 1,
   fontsize = 30]

## General edge definition
edge [color = grey,
       arrowhead = vee,
       arrowtail = vee]

## Specific edges
a -> {c}
b -> {c}
c -> {f}
d -> {e}
e -> {f}
}

## Label definition
[1]: 'Pop (group size)'
[2]: 'Site function'
[3]: 'Anthropogenic deposition rates'
[4]: 'Site type'
[5]: 'Natural deposition rates'
[6]: 'Waste/sqrm'

")

```

The above graph represents a very schematic way to represent the formation of the archaeological record ($W/m^2$). In this case, we are interested in radiocarbon dating; that is the number (and range) of potential 14C dates produced in a site, and this is key to understand the way in which we produced the model. We are aware that generating a specific archaeological palimpsest depends on a large quantity of variables, some of which may be controlled by field archaeologists and some of which may not (or are not). Therefore, the graph above must be read as follows. Asides from the outcome variable, the exposure variables, *Pop (group size)*, *Anthropogenic deposition rates* and *Natural deposition rates* (depicted in orange), are designed in a way that they can be activated for the model to infer them, they can be provided by the archaeologist, or they can be simply ignored. In the most elementary case, the archaeologist could introduce directly the outcome variable ($W/m^2$) without taking into account anything else, if she/he is confident to provide an accurate value.

However, in most cases, this information will not be known to the field researcher, and in this situation, this variable can be modelled to different extents of complexity. While. For example, in the case of the most simple simulation, the field archaeologist could ignore deposition rates. In this case, and because we are only considering 14C dates, then the quantity of the sample becomes broadly proportional to the number of people present in a site, and thus it could be modelled like this.

```{r, echo = FALSE, out.width="50%"}
grViz("
digraph record_formation {

graph [layout = dot, ## Set title and layout
       label = 'Record formation process',
       labelloc = 't'
       fontname = Helvetica,
       fontsize = 30]

# node definitions with substituted label text
node [fontname = Helvetica, ## General node definition
      style = filled,
      color = MistyRose]
      
## Per node definition
a [label = '@@1',
   fillcolor = Orangered]
b [label = '@@2',
   fillcolor = orange,
   fixedsize = shape,
   width = 4.5,
   height = 1,
   fontsize = 30]

## General edge definition
edge [color = grey,
       arrowhead = vee,
       arrowtail = vee]

## Specific edges
a -> {b}
}

## Label definition
[1]: 'Pop (group size)'
[2]: 'Waste/sqrm'

")

```

However, deposition rates are difficult to ignore if we want to account for the formation process of the archaeological record. If these are known to the archaeologists that developed fieldwork, then this would be the behaviour of the model for creating $W/m^2$.

```{r, echo = FALSE, out.width="60%"}
grViz("
digraph record_formation {

graph [layout = dot, ## Set title and layout
       label = 'Record formation process',
       labelloc = 't'
       fontname = Helvetica,
       fontsize = 30]

# node definitions with substituted label text
node [fontname = Helvetica, ## General node definition
      style = filled,
      color = MistyRose]
      
## Per node definition
a [label = '@@1',
   fillcolor = Orangered]
b [label = '@@2',
   fillcolor = Orangered]
c [label = '@@3',
   fillcolor = orange,
   fixedsize = shape,
   width = 4.5,
   height = 1,
   fontsize = 30]

## General edge definition
edge [color = grey,
       arrowhead = vee,
       arrowtail = vee]

## Specific edges
a -> {c}
b -> {c}
}

## Label definition
[1]: 'Anthropogenic deposition rates'
[2]: 'Natural deposition rates'
[3]: 'Waste/sqrm'

")

```

Finally, if these are not known to the archaeologist, but she/he wants to model them, then we would go back to the first DAG where, again, each variable can be either enabled by the user, provided as a user defined value or directly disabled.

This is how each variable works specifically:

* **Waste produced** ($W/m^2$ or just $W$) **(outcome variable)**: Archaeological record present per $m^2$. Since we are considering C14 dates, then this is a proportion of the organic material that could be found in a site. We have considered these a discrete variable (number of potential samples) with range $[0,\propto K]$. *Defined in code as* `W`.
* **Population (group size)** ($Pop$): Discrete variable with range $[0,\sim K]$. Population group size is key to determine anthropogenic deposition rates (which in turn determine $W$) but it can also be used as a proxy to determine $W$ in case those are not accounted for since, in that case, $W \propto Pop$. Although this variable can, like the rest, be set as a constant by the user, this is unadvised, as demographic processes are rarely constant. In any case, the user does have to provide a value for the carrying capacity ($K$) as this will limit population growth. The user must infer carrying capacity (maximum possible number of people within a site) based on prior expert knowledge. *Defined in code as* `Pop`.
* **Anthropogenic deposition** ($Adr$): Amount of bone kilogram/year deposited by each unit (group or person). This is a continuous variable, with range $[0,\infty]$, measured in *Kg*. See *Anthropogenic deposition protocol* for full definition.
* **Natural deposition rates** ($Ndr$): This is a continuous variable, with range $[0,\infty]$, measured in *cm/year*. Deposition rates from natural causes can heavily condition the formation process of the archaeological record. In turn, the type of site (whether it is an open-air site, a cave or a rockshelter) can severely affect them. As in all the other cases, the user can chose to set them, if known, to model them or to disable them. *Defined in code as* `Ndr`. <font size ="0.5"> *The upper range must be reassessed based on literature* </font>.
* **Site function** ($Sf$): This is a categoric variable with four categories: *residential*, *logistic*, *permanent* and *funeral*. Although the production of archaeological waste usually is strongly related to $Pop$, the function of site ($Sf$), or what was its purpose, and the activities developed in that site, can also condition $Adr$. For example, in the most obvious case, a group with the same number of people would not be producing the same amount of waste per year for a residential camp, occupied during long periods or even permanently, than for a logistic camp, occupied only during a few weeks per year. *Defined in code as* `S_f`.
* **Site type** ($St$): Categoric variable with three categories, representing the three main types of site in Prehistory: *open-air site*, *cave* and *rockshelter*. The site belonging to one category or the other can have a strong effect on natural deposition rates ($Ndr$). Although this variable can also be disabled, in practice this forces the user to introduce a value for $Ndr$ in case it is considered for modelling. *Defined in code as* `S_t`.

## Implementation

In order to fully understand the process, first we will show the protocols and functions that we use to generate each variable.

### Population ($Pop$) Pop-protocol

This protocol generates a stochastic demographic process with maximum population $\sim K$. It is based on three functions. The first function `Gpd()` is the core of the protocol. It receives a `data.frame` with a specific number of individuals (`nrow`), their age (`df[,1]`) and their sex (`df[,2]`) and produces another data frame with the same format but with a different population based on the current one. Introduced in a loop, this function produces a time series of population, which ensures the Markov property of the stochastic process $p(x_n+1|x_n)$.

However, this function also relies on two other functions: `death()` and `K_lim()`.
`death()` is the process of people dying each year. It is based on an age-structured probability matrix, where infants and old people have more probabilities of deceasing. The matrix is provided, but the user can set its own. `K_lim()` limits the population when it reaches $K$. The user should specify the appropriate value for $K$ according to the size of the site, its type, the group economy, etc. Also, the user can change the probability that exceeding people dies with parameter `prob`. Default is 0.8.

```{r}

### Population protocol

## Function 1. Generation of population dynamics
#' Returns a data.frame with two columns, where the number of rows is the number of
#' people. The first column contains the ages and the second column contains the sex.
#' @title Gpd
#' @param x: Input data. A data frame or matrix with two columns and nrow = Initial
#' population. One row per individual. The first column is the age of the individual.
#' The second column is the sex of the individual, and must be c("F","M").
#' @param W_fer_age: Vector with two values. The first value is the youngest age
#' at which it is considered that women can have children for prehistoric societies.
#' The second value is the oldest age at which it is considered that women can 
#' have children. Default is c(10,30).
#' @param M_fer_age: Vector with two values. The first value is the youngest age
#' at which it is considered that men can have children for prehistoric societies.
#' The second value is the oldest age at which it is considered that men can have 
#' children. Default is c(15,40)
#' @param  P_o: Probability of a woman having a son per year. Default is 0.3.
#' @export

Gpd <- function(x, W_fer_age = c(10,30), M_fer_age = c(15,40),
                P_o = 0.3){
  
  ### Process of having offspring
  
  # Female fertile population
  W <- x[x[,2]=="F",]
  W_fert <- W[W$Age>W_fer_age[1] & W$Age<W_fer_age[2],]
  
  # Male fertile population
  M <- x[x[,2]=="M",]
  M_fert <- M[M$Age>M_fer_age[1] & M$Age<M_fer_age[2],]
  
  ## Probability of having descendance per woman
  # Penalisation in case there are too few men
  pen <- round(nrow(M_fert)*2/nrow(W_fert),2) ## Assumes one man can have two women
  pen[pen>1] <- 1 ## The men penalisation can never multiply the birth rate per woman
  
  ## Probability of a woman having a son per year
  P_o <- P_o*pen
  
  Offspring <- sum(rbinom(nrow(W_fert),1,P_o))
  New_pop <- data.frame("Age" = rep(0,Offspring),                        
                        "Sex" = sample(c("M","F"),Offspring,prob=c(0.5,0.5),replace = TRUE))
  x <- rbind(x,New_pop)
  
  ### Process of dying
  
  vec_d <- apply(x,1,death)
  x <- x[vec_d==0,]
  
  ## Apply carrying capacty restrictions
  x <- K_lim(x, K)
  
  return(x)
}

## Function 2. Simulation of death process
#' @title death
#' Returns a value (0,1) where 0 = person lives and 1 = person dies, based
#' on pd (the probability matrix)
#' Thought to use with apply
#' @param x: An integer with the age of the person
#' @param pd: The probability matrix for mortality by age. A matrix is provided as 
#' default, but the user should provide another adapted to her/his population.
#' @export

death <- function(x,pd=data.frame("Age" = c(0:99),
                                  "P_d" = c(rep(0.13,2),
                                            rep(0.08,8),
                                            rep(0.01,25),
                                            rep(0.1,15),
                                            rep(0.15,10),
                                            rep(0.25,5),
                                            rep(0.99,35)))){
  age <- as.numeric(x[1])
  return(rbinom(1,1,prob = pd[pd$Age==age,2]))
}

## Function 3. Simulation of carrying capacity limitation
## If the population exceeds the carrying capacity, it eliminates oversize
## with 0.8 probability per person exceeding.
#' @title K_lim
#' @param x: Data frame or matrix. Population (number of people)
#' @param k: Integer. Carrying capacity. Provided by the user
#' @export

K_lim <- function(x,k,prob = 0.8){
  p <- nrow(x)
  if (p>k){
    o <- rbinom(p-k,1,prob)
    o <- sum(o[o==1])
    o[o==0] <- 1 ## Avoids problem eliminating all the df if remove == 0
    x <- x[-sample(1:nrow(x),o,replace = FALSE),]
  }
  return(x)
}


```

### Anthropogenic deposition ($Adr$) Adr-protocol

This generates the amount of human waste produced per year (In bone kilograms). It can be used either directly from the previous Pop-protocol, only taking into account the site function (which unavoidably yields a fixed rate for all the period considered) or, the most advisable, as a combination of the previous processes. The amount of bone kilogram consumed per year is defined as:

$$Adr_t = F \times \left( \frac {P_t \times (\frac {Tc \times C}{Ck})}{12} \times O \right)$$
Where:

* $F$ is the quantity of bone per meat consumed, expressed as a percentage with range $[0,1]$

* $P_t$ is the population at a specific time

* $Tc$ it the total amount of Kilocalories extracted from bone consumed by an individual in one year. We will call $Ca$ the amount of Kcal per day and person and this is considered a discrete value with range $[1500,3000]$. In addition, we must consider that not all of the calories consumed by humans belong to meat. Thus, we need to include a correction, accounting for how much of those calories is extracted from meat. This correction is introduced as a percentage $M[0,1]$. Thus, $Tc$ is defined as

$$Tc = Ca \times M \times 365$$

* $C$ Mainly among hunter-gatherer societies, foray parties do not consume a variable amount of food within the camp, but they do so during their activities. This has been reported to be up to 90% of food consumed in a day for the foraging group (Collette-Barbesque et al. 2016). Thus, the variable $c[0,1]$, again as percentage, control for hoy much meat is brought back to the camp. 
* $Ck$ is the amount of Kilocalories produced by each Kilogram of meat. Again, this can be variable, but to keep it reasonable, we have decided to express this as a continuous variables (although frequently discrete values will be provided) with range $[1000,2500]$.
* $O$ represents the month of occupations of the site in a year. This is a discrete variable with range $[1,12]$ and, for permanent and funeral sites, it $O = 12$.

The function `A_dep_r()`, contains the specifications from above. It also includes one parameter `S_f`, defining the function of the site. If `S_f = NULL`, then the site function has no effect. Alternatively, the parameter `Pop` can be introduced manually, or retrieved from the previous protocol. If both `Pop` and `S_f` are active, they both configure the final `Adr` outcome. However, if both are `NULL`, then the function will throw an error. In that case, the user will have to introduce manually the anthropogenic deposition rates for the computation of $W$ in subsequent processes.

```{r}

## Function 4. Simulation of anthropogenic deposition rates
#' Returns the Kilograms of bone produced per year in a site.
#' @param x: Integer (user provided) or data.frame. It is the number of people
#' inhabiting the site. If data.frame, the number of people is the number of rows. 
#' @param S_f: String. It is the site functionality, and it modulates the effect
#' of number of people by considering partial occupation of the site and different
#' deposition rates according the activities deployed. Possible states are:
#' 'residential' ('r'), 'logistic' ('l'), 'permanent' ('p') and 'funeral' ('f').
#' If S_f = 'f', number of buried individuals must be specified (in the argument x).
#'  Default is 'p'.
#' @param occ: If S_f = 'r' or S_f = 'l', occ (time of occupation of the camp
#' per year, in months) must be specified. Default is NULL, but if left NULL,
#' the function considers 1 month for logistic camps and 3 months for 
#' residential camps.
#' @param ca: Continuous value. It is the average of calories per adult person 
#' consumed per day. It's the mean between man average and woman average. Although
#' it is not limited, values should range between 1500 and 3000. Default is 2000.
#' @param m: Percentage. It is the amount of those calories that is meat (and not
#' other types of food, such as cereal, fish, etc.). Some values for this are offered 
#' in Cordain (2002) and Cordain et al. (2000). Default is 0.65.
#' @param c: Percentage. Represents how much of the food is consumed within the camp.
#' Default is 0.6, following the work of Collette-Barbesque et al. (2016).
#' @param ck: Kcalories per Kilogram of meet. Continuous variable. This can be very
#' variable. Although it is not limited, values should stay between 1000 and 2500.
#' Defaul is 1850, since this is the mean after checking with BEDCA database. More
#' info in paper. 
#' @param f: Percentage of bone per meat consumed. Default is 0.07 following
#' archaeological literature. 
#' @export

A_dep_r <- function(x,S_f = "p", occ = NULL, ca = 2000, m = 0.65, c = 0.6, 
                    ck = 1850, f = 0.07){
  try(if(is.null(x) == TRUE & is.null(S_f) == TRUE) 
    stop("Population and Site function undefined"))
  
  ## Set the number of individuals
  if (is.vector(x)==TRUE){
    Pop <- length(x)
  } else {
    Pop <- nrow(x)
  }
  
  ## Define time for logistic/residential camps if time = NULL
  if (is.null(occ) == TRUE){
    if (S_f == 'r'){
      occ <- 3
    } else if (S_f == 'l'){
      occ <- 1
    } else if ((S_f == 'p')){
      occ <- 12
    }
  }
  
  ## See main text for definitions
  ca <- ca*365 ## Calories per person/year
  tc <- ca*m ## Define total calories
  adr <- (((Pop*((tc*c)/ck))/12)*occ)*f
  
  if (S_f == 'f'){
    adr <- Pop*17 # 17 kg of bone as an average per person
  }
  return(adr)
}
```

### Natural deposition rates ($Ndr$) Ndr-protocol
Natural deposition rates usually have an effect on the archaeological waste product, where the density of $W$ is usually inversely proportional to the speed of the natural deposition rates. This protocol consists of one function `N_dep_r()` where the argument `S_t` (site type) can be enabled or disabled. If disabled, natural deposition rates are only considered through the parameter `sed.r`. When enabled it conditions the deposition rates on the type of site (open-air, cave or rockshelter). We are aware that there are many causes determining natural deposition rates. However, for the sake of simplicity, we have decided to include only one extra layer, the parameter `sed.r`, accounting for the speed of such rates, disregarding the causes which might provoke that speed.
In any case, deposition rates can also be computed, if the user is confident enough,
as layer thickness (in cm) between time of occupation (in years). For doing this, the user must set the parameter `site.based = TRUE` and specify the parameter `layers` with a data frame structured as in the example below.

```{r}
## Function 5. Simulation of deposition deposition rates
#' For the output. If site.based == FALSE, it returns a single value, as it 
#' considers the same value for each year. If site.based == TRUE, it returns
#' a vector with as many values as years considered, with the specific sedimentary
#' rate for each year.
#' @title N_dep_r
#' @param S_t: Three possible site types have been considered: 'open-air' ('oa'),
#' 'cave' ('c') and rockshelter ('rs'). When enabled, this parameter modules the 
#' effect of the speed. Default is NULL.
#' @param sed.r: This is the speed at which the natural sediment deposits on the 
#' 'site. It has three levels: 'slow' ('s'), 'medium' ('m') and 'fast' ('f'). 
#' Default is 'm'.
#' @param site.based: Boolean. It states whether the depositio rates are based 
#' directly from the site. It TRUE, then the parameter 'layers' must be specified.
#' Default is FALSE
#' @param layers: A data frame, whith as many rows as layers. For the columns,
#' the first column is the name of each layer, the second column is the thickness
#' of the layer (in cms), the third column is the first year from where the layer
#' is to be computed and the last column is the last of the layer. The deposition
#' rate is computed as cm/nyears
#' @export

## Example for parameter 'layers'
#nlay <- data.frame("Layers" = c(1,2,3), "Thickness" = c(16,14,13),
#                   "Initial year" = c(7500,7100,6800), "Final year" = 

N_dep_r <- function(S_t = NULL, sed.r = 'm', site.based = FALSE,
                    layers){
  
  if (site.based == FALSE){
    ## Set the general speed of the deposition rates
    if (sed.r == 's'){
      s <- 0.05
    } else if (sed.r == 'm'){
      s <- 0.1
    } else if (sed.r == 'f'){
      s <- 0.15
    }
    
    ## Set the value for site type
    if(is.null(S_t) == FALSE){
      if (S_t == 'oa'){
        s <- s*3
      } else if (S_t == 'rs'){
        s <- s*2
      }
    }
  } else {
    l_rates <- rep(0,nrow(layers))
    for (i in 1:nrow(layers)){
      l_rates[i] <- round(layers[i,2]/(layers[i,3]-layers[i,4]),2)
    }
    s <- c()
    for (i in 1:nrow(layers)){
      s <- append(s,rep(l_rates[i],layers[i,3]-layers[i,4]))
    }
  }
  return(s)
}

```

### Waste production ($W$) W-protocol
This is the final step of the model. As explained above, the user can take a modular approach to the formation of the archaeological waste by enabling/disabling some or all of the previous components. In the same way, the user can decide to provide the previous components not as a simulation, but as a value, provided this can be correctly inferred. Ultimately, $W$ will be the input (theoretically, a complete archaeological record) for the simulation of the **record loss process**. Thus, if the user is confident enough that the total amount of the archaeological record can be correctly inferred, this value can be passed on to the record loss process directly, without the need of this simulation. 

If `Adr == NULL`, the waste produced $w$ is inferred on the basis of the total population only and, if `Ndr == NULL`, it is equal to `A_dep_r(Pop, S_f = 'p', occ = NULL)`. `Adr` can be provided either as a value or modelled, as shown above. For simplicity, we assimilate $Pop$ to $Adr$ (regardless of whether $Adr$ has been taken into account or not). In this case, if `Ndr != NULL`, then $w$ is computed as $\frac{Adr}{10 \times Ndr}$, and the case the `Adr != NULL` and `Ndr == NULL`, then $w = Adr$. Finally, the result $W$ is computed as $\frac{w}{area}$.

```{r}
## Function 6. Waste production
#' Returns the final product of the waste produced in a site. An integer.
#' @title W_prod
#' @param x: Integer (user provided) or data.frame. It is the number of people
#' inhabiting the site. If data.frame, the number of people is the number of rows.
#' @param Adr: An integer. Can be inserted directly or modelled.
#' @param Ndr: A double. Can be inserted directly or modelled.
#' @param area: An integer. This is the total area of the site.
#' @param ss: An integer. This is the sample size required for 14C dating.
#' Default is 4, considering 4 gm of non-charred bone needed for one dating.
#' @export

W_prod <- function(x,Adr = NULL,Ndr = NULL, area, ss = 4){
  
  ## Set the number of individuals
  if (is.vector(x)==TRUE){
    Pop <- length(x)
  } else {
    Pop <- nrow(x)
  }
  
  if (is.null(Adr) == TRUE & is.null(Ndr) == TRUE){
    w <- Pop*5*20
  } else if (is.null(Adr) == TRUE & is.null(Ndr) == FALSE){
    w <- (Pop*5*20)/(10*Ndr)
  } else if (is.null(Adr) == FALSE & is.null(Ndr) == FALSE){
    w <- Adr/(10*Ndr)
  } else if (is.null(Adr) == FALSE & is.null(Ndr) == TRUE){
    w <- Adr
  }
  
  w <- w*(1000/ss)

  w <- round(w/area)
  return(w)
} 
```

## Simulation
Each of the functions in section 1.2 are thought to be introduced in a stochastic process. The desired result is a time series where each year has its own amount of archaeological waste, depending on the previous year, and based on the rules of the previous section.

In order to start the process, we need te set the starting values.
```{r, cache = FALSE}

## Set initial values
set.seed(1234)
ts <- 1000 # Time span
K <- 150
area <- 1000
Gs_init <- 100 # Initial population
Gs_init <- data.frame("Age" = sample(10:30,Gs_init,10:30, replace = TRUE),
                      "Sex" = sample(c("M","F"), Gs_init, prob = c(0.5,0.5), replace = TRUE))


```

Once this is done, we can implement the protocol one, where we compute the population during the desired time span. For this first simulation, we have decided to leave all values as the default values, this meaning a site with permanent occupation, without specifying the type of site and with medium natural deposition rates.

```{r, cache = FALSE}
## Start the loop
res <- data.frame("Pop" = rep(0,ts), "W" = rep(0,ts))
Pop <- Gs_init

for (i in 1:ts){
  Pop <- Gpd(Pop)
  a_w <- A_dep_r(Pop)
  ndp <- N_dep_r()
  
  res$Pop[i] <- nrow(Pop)
  res$W[i] <- W_prod(Pop, Adr= a_w, Ndr = ndp, area = area)
  Pop$Age <- Pop$Age+1
}
```

Obviously, the number of potential c14 samples is correlated to the population.

```{r, cache = FALSE}
## Plots
par(mfrow = c(1,2))
plot(res$Pop, type = "l", col = "darkblue", ylab = "Population",
     xlab = "Years", main = "Site population")
plot(res$W, type = "l", col = "darkred", ylab = "N samples per m^2",
     xlab = "Years", main = "Waste produced")
```

In this case, we consider the same population strcture and behaviour. However, we change the depositional processes. In this case, we consider a logistic camp with an average occupation of one month a year. This is an open-air site with fast $Ndr$.

```{r, cache = FALSE}
## Different conditions
# Start the loop

res2 <- data.frame("Pop" = rep(0,ts), "W" = rep(0,ts))
Pop <- Gs_init

for (i in 1:ts){
  Pop <- Gpd(Pop)
  a_w <- A_dep_r(Pop, S_f = "l", occ = 1)
  ndp <- N_dep_r(S_t = "oa", sed.r = "f")
  
  res2$Pop[i] <- nrow(Pop)
  res2$W[i] <- W_prod(Pop, Adr= a_w, Ndr = ndp, area = area)
  Pop$Age <- Pop$Age+1
}
```

Results still correlate to the population of the site (they always will as food consumed directly correlates to existent people) but we can see how, in this case, the number of potential samples is much smaller than before.

```{r, cache = FALSE}
## Plots
par(mfrow = c(1,2))
plot(res2$Pop, type = "l", col = "darkblue", ylab = "Population",
     xlab = "Years", main = "Site population")
plot(res2$W, type = "l", col = "darkred", ylab = "N samples per m^2",
     xlab = "Years", main = "Waste produced")
```

Trying a different population structure, the correlation persists.

```{r, cache = FALSE}
## Different conditions
# Start the loop

res3 <- data.frame("Pop" = rep(0,ts), "W" = rep(0,ts))
Pop <- Gs_init

for (i in 1:ts){
  Pop <- Gpd(Pop, W_fer_age = c(15,35), M_fer_age = c(15,35), P_o = 0.2)
  a_w <- A_dep_r(Pop, S_f = "h", occ = 8)
  ndp <- N_dep_r(S_t = "c", sed.r = "s")
  
  res3$Pop[i] <- nrow(Pop)
  res3$W[i] <- W_prod(Pop, Adr= a_w, Ndr = ndp, area = area)
  Pop$Age <- Pop$Age+1
}

## Plots
par(mfrow = c(1,2))
plot(res3$Pop, type = "l", col = "darkblue", ylab = "Population",
     xlab = "Years", main = "Site population")
plot(res3$W, type = "l", col = "darkred", ylab = "N samples per m^2",
     xlab = "Years", main = "Waste produced")

```

As does the effect on the site of fast $Ndr$ combined with slower $Adr$.

```{r, cache = FALSE}
## Different conditions
# Start the loop

res4 <- data.frame("Pop" = rep(0,ts), "W" = rep(0,ts))
Pop <- Gs_init

for (i in 1:ts){
  Pop <- Gpd(Pop, W_fer_age = c(15,35), M_fer_age = c(15,35), P_o = 0.2)
  a_w <- A_dep_r(Pop, S_f = "l", occ = 1)
  ndp <- N_dep_r(S_t = "oa", sed.r = "f")
  
  res4$Pop[i] <- nrow(Pop)
  res4$W[i] <- W_prod(Pop, Adr= a_w, Ndr = ndp, area = area)
  Pop$Age <- Pop$Age+1
}

## Plots
par(mfrow = c(1,2))
plot(res4$Pop, type = "l", col = "darkblue", ylab = "Population",
     xlab = "Years", main = "Site population")
plot(res4$W, type = "l", col = "darkred", ylab = "N samples per m^2",
     xlab = "Years", main = "Waste produced")

```

We can observe the four simulations with the archaeological waste together.

```{r, cache = FALSE}
## Plots
par(mfrow = c(2,2))
plot(res$W, type = "l", col = "darkblue", ylab = "N samples per m^2",
     xlab = "Years", main = "High Adr low Ndr")
plot(res2$W, type = "l", col = "darkblue", ylab = "N samples per m^2",
     xlab = "Years", main = "Low Adr high Ndr")
plot(res3$W, type = "l", col = "darkblue", ylab = "N samples per m^2",
     xlab = "Years")
plot(res4$W, type = "l", col = "darkblue", ylab = "N samples per m^2",
     xlab = "Years")
```


