<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Generate final archaeological record | Archaeoriddle, the bookdown</title>
  <meta name="description" content="First draft of Rbookdown to describe how data have been generated" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Generate final archaeological record | Archaeoriddle, the bookdown" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="First draft of Rbookdown to describe how data have been generated" />
  <meta name="github-repo" content="acortell3/archaeoriddle" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Generate final archaeological record | Archaeoriddle, the bookdown" />
  
  <meta name="twitter:description" content="First draft of Rbookdown to describe how data have been generated" />
  

<meta name="author" content="by the Computational and Digital Archaeology Laboratory from Cambridge University" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="recloss.html"/>
<link rel="next" href="original-challenge.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.11/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-archaeoriddle"><i class="fa fa-check"></i><b>1.1</b> What is archaeoriddle?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-will-you-find-in-this-bookdown"><i class="fa fa-check"></i><b>1.2</b> What will you find in this bookdown?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-can-you-do-with-this"><i class="fa fa-check"></i><b>1.3</b> What can you do with this?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="env.html"><a href="env.html"><i class="fa fa-check"></i><b>2</b> Landscape &amp; Resources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="env.html"><a href="env.html#autocorrelated-noise-generation"><i class="fa fa-check"></i><b>2.1</b> Autocorrelated noise generation</a></li>
<li class="chapter" data-level="2.2" data-path="env.html"><a href="env.html#slope-and-elevation"><i class="fa fa-check"></i><b>2.2</b> Slope and Elevation</a></li>
<li class="chapter" data-level="2.3" data-path="env.html"><a href="env.html#environmental-resources"><i class="fa fa-check"></i><b>2.3</b> Environmental resources</a></li>
<li class="chapter" data-level="2.4" data-path="env.html"><a href="env.html#manual-selection"><i class="fa fa-check"></i><b>2.4</b> Manually Select Resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="popgrowth.html"><a href="popgrowth.html"><i class="fa fa-check"></i><b>3</b> Population structure &amp; growth</a>
<ul>
<li class="chapter" data-level="3.1" data-path="popgrowth.html"><a href="popgrowth.html#settlements-position"><i class="fa fa-check"></i><b>3.1</b> Settlements position</a></li>
<li class="chapter" data-level="3.2" data-path="popgrowth.html"><a href="popgrowth.html#initsize"><i class="fa fa-check"></i><b>3.2</b> Initializing Site Population and Culture</a></li>
<li class="chapter" data-level="3.3" data-path="popgrowth.html"><a href="popgrowth.html#base-pop-growth"><i class="fa fa-check"></i><b>3.3</b> Population Growth : <span class="math inline">\(Pop\)</span>-protocol</a>
<ul>
<li class="chapter" data-level="" data-path="popgrowth.html"><a href="popgrowth.html#source"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="conflict.html"><a href="conflict.html"><i class="fa fa-check"></i><b>4</b> Migration &amp; Conflict</a>
<ul>
<li class="chapter" data-level="4.1" data-path="conflict.html"><a href="conflict.html#fission"><i class="fa fa-check"></i><b>4.1</b> Fission</a></li>
<li class="chapter" data-level="4.2" data-path="conflict.html"><a href="conflict.html#migration"><i class="fa fa-check"></i><b>4.2</b> Migration</a></li>
<li class="chapter" data-level="4.3" data-path="conflict.html"><a href="conflict.html#conflict-and-war"><i class="fa fa-check"></i><b>4.3</b> Conflict and War</a></li>
<li class="chapter" data-level="4.4" data-path="conflict.html"><a href="conflict.html#deprecated-network-site-size-and-climate"><i class="fa fa-check"></i><b>4.4</b> DEPRECATED – Network, Site Size And Climate</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="main-simu.html"><a href="main-simu.html"><i class="fa fa-check"></i><b>5</b> Main Simulation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="main-simu.html"><a href="main-simu.html#initial-parameters"><i class="fa fa-check"></i><b>5.1</b> Initial Parameters</a></li>
<li class="chapter" data-level="5.2" data-path="main-simu.html"><a href="main-simu.html#preparation"><i class="fa fa-check"></i><b>5.2</b> Preparation</a></li>
<li class="chapter" data-level="5.3" data-path="main-simu.html"><a href="main-simu.html#algorithm"><i class="fa fa-check"></i><b>5.3</b> Algorithm</a>
<ul>
<li class="chapter" data-level="" data-path="main-simu.html"><a href="main-simu.html#source-code"><i class="fa fa-check"></i>Source code</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="main-simu.html"><a href="main-simu.html#explore-simulation"><i class="fa fa-check"></i><b>5.4</b> Explore simulation</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="recgen.html"><a href="recgen.html"><i class="fa fa-check"></i><b>6</b> Record formation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="recgen.html"><a href="recgen.html#theoretical-model"><i class="fa fa-check"></i><b>6.1</b> Theoretical model</a></li>
<li class="chapter" data-level="6.2" data-path="recgen.html"><a href="recgen.html#implementation"><i class="fa fa-check"></i><b>6.2</b> Implementation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="recgen.html"><a href="recgen.html#population-pop-protocol"><i class="fa fa-check"></i><b>6.2.1</b> Population <span class="math inline">\(Pop\)</span>-protocol</a></li>
<li class="chapter" data-level="6.2.2" data-path="recgen.html"><a href="recgen.html#anthropogenic-deposition-a-protocol"><i class="fa fa-check"></i><b>6.2.2</b> Anthropogenic deposition <span class="math inline">\(A\)</span>-protocol</a></li>
<li class="chapter" data-level="6.2.3" data-path="recgen.html"><a href="recgen.html#depth-d-protocol"><i class="fa fa-check"></i><b>6.2.3</b> Depth <span class="math inline">\(D\)</span>-protocol</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="recgen.html"><a href="recgen.html#minimal-example-and-simulation"><i class="fa fa-check"></i><b>6.3</b> Minimal example and simulation</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="recloss.html"><a href="recloss.html"><i class="fa fa-check"></i><b>7</b> Record loss</a>
<ul>
<li class="chapter" data-level="7.1" data-path="recloss.html"><a href="recloss.html#theoretical-model-1"><i class="fa fa-check"></i><b>7.1</b> Theoretical model</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="recloss.html"><a href="recloss.html#general-purpose"><i class="fa fa-check"></i><b>7.1.1</b> General purpose</a></li>
<li class="chapter" data-level="7.1.2" data-path="recloss.html"><a href="recloss.html#model-layers"><i class="fa fa-check"></i><b>7.1.2</b> Model layers</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="recloss.html"><a href="recloss.html#implementation-1"><i class="fa fa-check"></i><b>7.2</b> Implementation</a>
<ul>
<li class="chapter" data-level="" data-path="recloss.html"><a href="recloss.html#source-1"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="recloss.html"><a href="recloss.html#usage"><i class="fa fa-check"></i><b>7.3</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="final-output.html"><a href="final-output.html"><i class="fa fa-check"></i><b>8</b> Generate final archaeological record</a>
<ul>
<li class="chapter" data-level="8.1" data-path="final-output.html"><a href="final-output.html#using-sites-size-to-generate-deposit"><i class="fa fa-check"></i><b>8.1</b> Using sites size to generate deposit</a></li>
<li class="chapter" data-level="8.2" data-path="final-output.html"><a href="final-output.html#provide-survey-square-and-publicly-available-dates"><i class="fa fa-check"></i><b>8.2</b> Provide survey square and publicly available dates</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="final-output.html"><a href="final-output.html#giving-name-to-the-publicly-available-data"><i class="fa fa-check"></i><b>8.2.1</b> Giving name to the publicly available data</a></li>
<li class="chapter" data-level="8.2.2" data-path="final-output.html"><a href="final-output.html#export-and-download-dates"><i class="fa fa-check"></i><b>8.2.2</b> Export and download dates</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="final-output.html"><a href="final-output.html#bonus-maps"><i class="fa fa-check"></i><b>8.3</b> Bonus maps</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="original-challenge.html"><a href="original-challenge.html"><i class="fa fa-check"></i><b>9</b> Archaeoriddle: the original challenge</a>
<ul>
<li class="chapter" data-level="9.1" data-path="original-challenge.html"><a href="original-challenge.html#context"><i class="fa fa-check"></i><b>9.1</b> Context</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="original-challenge.html"><a href="original-challenge.html#original-idea-and-first-reflections"><i class="fa fa-check"></i><b>9.1.1</b> Original idea and first reflections</a></li>
<li class="chapter" data-level="9.1.2" data-path="original-challenge.html"><a href="original-challenge.html#birth-of-a-challenge"><i class="fa fa-check"></i><b>9.1.2</b> Birth of a Challenge</a></li>
<li class="chapter" data-level="9.1.3" data-path="original-challenge.html"><a href="original-challenge.html#the-british-academy-grant-november-2022"><i class="fa fa-check"></i><b>9.1.3</b> The British Academy Grant – November 2022</a></li>
<li class="chapter" data-level="9.1.4" data-path="original-challenge.html"><a href="original-challenge.html#caa-oxford-june-2023"><i class="fa fa-check"></i><b>9.1.4</b> CAA Oxford – June 2023</a></li>
<li class="chapter" data-level="9.1.5" data-path="original-challenge.html"><a href="original-challenge.html#the-eaa-call-for-proposal-august-2023"><i class="fa fa-check"></i><b>9.1.5</b> The EAA call for proposal – August 2023</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="original-challenge.html"><a href="original-challenge.html#implementation-2"><i class="fa fa-check"></i><b>9.2</b> Implementation</a></li>
<li class="chapter" data-level="9.3" data-path="original-challenge.html"><a href="original-challenge.html#lets-rewind-the-tape"><i class="fa fa-check"></i><b>9.3</b> Let’s rewind the tape</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="original-challenge.html"><a href="original-challenge.html#generate-and-share-final-simulation"><i class="fa fa-check"></i><b>9.3.1</b> Generate and share final simulation</a></li>
<li class="chapter" data-level="9.3.2" data-path="original-challenge.html"><a href="original-challenge.html#grid-generation-and-sharing"><i class="fa fa-check"></i><b>9.3.2</b> Grid generation and sharing</a></li>
<li class="chapter" data-level="9.3.3" data-path="original-challenge.html"><a href="original-challenge.html#naming"><i class="fa fa-check"></i><b>9.3.3</b> Giving name to the publicly available data</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="original-challenge.html"><a href="original-challenge.html#the-proposals"><i class="fa fa-check"></i><b>9.4</b> The proposals</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="original-challenge.html"><a href="original-challenge.html#p1"><i class="fa fa-check"></i><b>9.4.1</b> P1</a></li>
<li class="chapter" data-level="9.4.2" data-path="original-challenge.html"><a href="original-challenge.html#p2"><i class="fa fa-check"></i><b>9.4.2</b> P2</a></li>
<li class="chapter" data-level="9.4.3" data-path="original-challenge.html"><a href="original-challenge.html#p3"><i class="fa fa-check"></i><b>9.4.3</b> P3</a></li>
<li class="chapter" data-level="9.4.4" data-path="original-challenge.html"><a href="original-challenge.html#p4"><i class="fa fa-check"></i><b>9.4.4</b> P4</a></li>
<li class="chapter" data-level="9.4.5" data-path="original-challenge.html"><a href="original-challenge.html#p5"><i class="fa fa-check"></i><b>9.4.5</b> P5</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/acortell3/archaeoriddle/">
source</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Archaeoriddle, the bookdown</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="final-output" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">8</span> Generate final archaeological record<a href="final-output.html#final-output" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Now that all the pieces are in place we need to combine them to generate files that can be shared with people in order for them to guess the original parameters.</p>
<p>To summarize what we have so far:</p>
<ol style="list-style-type: decimal">
<li>We simulated an artificial environment in Chapter <a href="env.html#env">2</a>.</li>
<li>We localised sites on the map and defined a population growth process in Chapter <a href="popgrowth.html#popgrowth">3</a>.</li>
<li>We defined rules to describe how population move and engage in conflict as they expand in Chapter <a href="conflict.html#conflict">4</a>.</li>
<li>We simulated these process of growth, conflict and migration on the environement we designed, for extend periods of time in Chapter <a href="main-simu.html#main-simu">5</a>.</li>
<li>We defined processes that use this simulated growth to generate an archaeological record in Chapter <a href="recgen.html#recgen">6</a>,</li>
<li>We defined processes that transform this archaeological record using credible loss mechanisms <a href="recgen.html#recgen">6</a>.</li>
</ol>
<p>Here we will use all these previous steps to generate csvs that can be shared. In this chapter we will use the simulation run in the Chapter <a href="main-simu.html#main-simu">5</a> ; if you want to generated new ‘fake’-dataset, different from the one that have been presented in the original challenge and that will be described in the chapter <a href="original-challenge.html#original-challenge">9</a>, you will want to run longer simulation, and choose among different run on the looks interesting/realistic. We provide a script <code>./scriptmini.R</code> that to give some idea about how to automatize these run and how to choose among them.</p>
<div id="using-sites-size-to-generate-deposit" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Using sites size to generate deposit<a href="final-output.html#using-sites-size-to-generate-deposit" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This has been done using file <code>dateGeneration.R</code>, we will describe it here now.</p>
<p>First we get the rasters defining the environment (If you followed the book since the beginning they should be already in memory but in case you didn’t we we reload them here:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="final-output.html#cb71-1" tabindex="-1"></a>height.ras <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">file.path</span>(<span class="st">&quot;data_toshare&quot;</span>,<span class="st">&quot;dem_raster.tiff&quot;</span>))</span>
<span id="cb71-2"><a href="final-output.html#cb71-2" tabindex="-1"></a>height.wat <span class="ot">&lt;-</span> height.ras</span>
<span id="cb71-3"><a href="final-output.html#cb71-3" tabindex="-1"></a>height.wat[height.wat<span class="sc">&gt;</span><span class="fu">mean</span>(height.wat[])] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb71-4"><a href="final-output.html#cb71-4" tabindex="-1"></a>Nts <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_tmp/popSizeMatrix.RDS&quot;</span>)</span>
<span id="cb71-5"><a href="final-output.html#cb71-5" tabindex="-1"></a><span class="fu">plotMap</span>(height.ras,height.wat)</span></code></pre></div>
<p><img src="_main_files/figure-html/getRaster-ex-1.png" width="672" /></p>
<p>Using <code>Rec_c</code> , <code>short_loss</code> and <code>long_loss</code>, that we presented in the Chapter <a href="recgen.html#recgen">6</a> &amp; <a href="recloss.html#recloss">7</a>, we generate deposit. This can take long time if the simulation included a lot of sites, spanning over long period of time. Here we first generate all deposit from the matrix <code>Nts</code> generated during the simulation of the Chapter <a href="main-simu.html#main-simu">5</a> and then apply all loss functions together:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="final-output.html#cb72-1" tabindex="-1"></a><span class="co">#All in one:</span></span>
<span id="cb72-2"><a href="final-output.html#cb72-2" tabindex="-1"></a>alldeposit<span class="ot">=</span><span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(Nts),<span class="cf">function</span>(s)<span class="fu">Rec_c</span>(<span class="fu">sapply</span>(Nts[,s],A_rates), <span class="at">InitBP =</span> <span class="dv">7500</span>,<span class="at">ts=</span><span class="fu">nrow</span>(Nts),<span class="at">r =</span> <span class="fl">0.2</span>, <span class="at">max_bone_thickness =</span> <span class="st">&quot;m&quot;</span>))</span>
<span id="cb72-3"><a href="final-output.html#cb72-3" tabindex="-1"></a>allLosses<span class="ot">=</span><span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(alldeposit),<span class="cf">function</span>(ind){</span>
<span id="cb72-4"><a href="final-output.html#cb72-4" tabindex="-1"></a>    Rec<span class="ot">=</span>alldeposit[[ind]];                    </span>
<span id="cb72-5"><a href="final-output.html#cb72-5" tabindex="-1"></a>    Rec<span class="ot">=</span><span class="fu">apply</span>(Rec,<span class="dv">2</span>,short_loss,.<span class="dv">6</span>)  <span class="co">#apply short loss</span></span>
<span id="cb72-6"><a href="final-output.html#cb72-6" tabindex="-1"></a>    Rec<span class="ot">=</span><span class="fu">long_loss</span>(Rec,.<span class="dv">9997</span>,<span class="dv">7500</span>) <span class="co">#apply long loss</span></span>
<span id="cb72-7"><a href="final-output.html#cb72-7" tabindex="-1"></a>    <span class="fu">return</span>(Rec)</span>
<span id="cb72-8"><a href="final-output.html#cb72-8" tabindex="-1"></a>})</span>
<span id="cb72-9"><a href="final-output.html#cb72-9" tabindex="-1"></a><span class="fu">rm</span>(alldeposit)</span></code></pre></div>
<p>Once this is done, we have a list with all the potential dates available from all sites that have existed during our simulation. Realisticly, for any given site, not <em>all</em> the material will be recovered and even less of this material will be dated. To reflect that, we capped the maximum number of samples available per sites. To do so – and this was applied as is in the original challange presented in the Chapter <a href="original-challenge.html#original-challenge">9</a>, we assume that the biggest sites – the one with most media attention, most funding, will very likely get at most 30 dates. We thus subsampled the number of dates for smaller site given this ration of <span class="math inline">\(\frac{30}{n_{\text{largest}}}\)</span>. Here simulation have been greatly shortened, thus sites have way less samples. We thus cap the larges sites to have only 80% of the dates it generate, and sample the other sites using this ratio.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="final-output.html#cb73-1" tabindex="-1"></a>maxSites<span class="ot">=</span><span class="fu">max</span>(<span class="fu">sapply</span>(allLosses,sum))</span>
<span id="cb73-2"><a href="final-output.html#cb73-2" tabindex="-1"></a>nsample<span class="ot">=</span><span class="fu">round</span>(<span class="fu">sapply</span>(allLosses,sum)<span class="sc">*</span>(<span class="dv">30</span><span class="sc">/</span>maxSites))</span>
<span id="cb73-3"><a href="final-output.html#cb73-3" tabindex="-1"></a>allRemainingDates<span class="ot">=</span><span class="fu">lapply</span>(<span class="fu">seq_along</span>(allLosses),<span class="cf">function</span>(r)<span class="fu">extractDates</span>(allLosses[[r]],<span class="at">n=</span>nsample[r]))</span>
<span id="cb73-4"><a href="final-output.html#cb73-4" tabindex="-1"></a><span class="fu">rm</span>(allLosses) <span class="co">#object are big, need to free memory</span></span></code></pre></div>
<p>We then have a sample of date for every sites of our worlds; where the maximum number of dates is 30, for the biggest sites that existed in our simulation.</p>
<p>Let’s looks at where these date are available, we first retrieve all sites saved in the simulation from <a href="main-simu.html#main-simu">5</a>:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="final-output.html#cb74-1" tabindex="-1"></a></span>
<span id="cb74-2"><a href="final-output.html#cb74-2" tabindex="-1"></a>allsites<span class="ot">=</span><span class="fu">vect</span>(<span class="fu">file.path</span>(foldtmp,<span class="st">&quot;allsites.shp&quot;</span>))</span>
<span id="cb74-3"><a href="final-output.html#cb74-3" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">class</span>(allsites)[<span class="dv">1</span>] <span class="sc">==</span> <span class="st">&quot;PackedSpatVector&quot;</span>)</span>
<span id="cb74-4"><a href="final-output.html#cb74-4" tabindex="-1"></a>    allsites<span class="ot">=</span>terra<span class="sc">::</span><span class="fu">vect</span>(allsites)</span></code></pre></div>
<p>We can see where are the sites with more dates:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="final-output.html#cb75-1" tabindex="-1"></a>expname<span class="ot">=</span><span class="st">&quot;exn&quot;</span></span>
<span id="cb75-2"><a href="final-output.html#cb75-2" tabindex="-1"></a><span class="fu">plotMap</span>(height.ras,height.wat,<span class="fu">paste0</span>(<span class="st">&quot;final after losses&quot;</span>))</span>
<span id="cb75-3"><a href="final-output.html#cb75-3" tabindex="-1"></a><span class="fu">plot</span>(allsites,<span class="at">cex=</span><span class="dv">3</span><span class="sc">*</span>(<span class="fu">lengths</span>(allRemainingDates)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">/</span>(<span class="dv">29</span>),<span class="at">pch=</span><span class="dv">21</span>,<span class="at">add=</span>T,<span class="at">bg=</span><span class="fu">rainbow</span>(<span class="dv">2</span>,<span class="at">alpha=</span>.<span class="dv">6</span>)[<span class="fu">as.factor</span>(allsites<span class="sc">$</span>culture[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])])</span>
<span id="cb75-4"><a href="final-output.html#cb75-4" tabindex="-1"></a></span>
<span id="cb75-5"><a href="final-output.html#cb75-5" tabindex="-1"></a>dates<span class="ot">=</span><span class="fu">unique</span>(<span class="fu">unlist</span>(allRemainingDates))</span>
<span id="cb75-6"><a href="final-output.html#cb75-6" tabindex="-1"></a>dates<span class="ot">=</span><span class="fu">rev</span>(<span class="fu">sort</span>(dates[<span class="sc">!</span><span class="fu">is.na</span>(dates)]))</span>
<span id="cb75-7"><a href="final-output.html#cb75-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">table</span>(<span class="fu">unlist</span>(allRemainingDates)))</span>
<span id="cb75-8"><a href="final-output.html#cb75-8" tabindex="-1"></a>totallDatesRemains<span class="ot">=</span><span class="fu">sapply</span>(allRemainingDates,<span class="cf">function</span>(i)<span class="fu">table</span>(<span class="fu">factor</span>(i,<span class="at">levels=</span>dates)))</span>
<span id="cb75-9"><a href="final-output.html#cb75-9" tabindex="-1"></a><span class="fu">saveRDS</span>(allRemainingDates,<span class="at">file=</span><span class="fu">file.path</span>(foldtmp,<span class="fu">paste0</span>(expname,<span class="st">&quot;_dates.RDS&quot;</span>)))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:getadates-ex"></span>
<img src="_main_files/figure-html/getadates-ex-1.png" alt="left: sites where dates are potentially available, size of the dot represent the number of dates, right: total number of dates by years" width="45%" /><img src="_main_files/figure-html/getadates-ex-2.png" alt="left: sites where dates are potentially available, size of the dot represent the number of dates, right: total number of dates by years" width="45%" />
<p class="caption">
Figure 8.1: left: sites where dates are potentially available, size of the dot represent the number of dates, right: total number of dates by years
</p>
</div>
<p>Loading dates:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="final-output.html#cb76-1" tabindex="-1"></a>dates<span class="ot">=</span><span class="fu">readRDS</span>(<span class="at">file=</span><span class="fu">file.path</span>(foldtmp,<span class="fu">paste0</span>(expname,<span class="st">&quot;_dates.RDS&quot;</span>)))</span></code></pre></div>
<p>Keep sites with foundable dates</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="final-output.html#cb77-1" tabindex="-1"></a>foundsites<span class="ot">=</span>allsites[<span class="fu">lengths</span>(dates)<span class="sc">&gt;</span><span class="dv">0</span>,]</span>
<span id="cb77-2"><a href="final-output.html#cb77-2" tabindex="-1"></a>foundsites<span class="sc">$</span>numdates<span class="ot">=</span><span class="fu">unlist</span>(<span class="fu">lengths</span>(dates[<span class="fu">lengths</span>(dates)<span class="sc">&gt;</span><span class="dv">0</span>]))</span>
<span id="cb77-3"><a href="final-output.html#cb77-3" tabindex="-1"></a>founddates<span class="ot">=</span>dates[<span class="fu">lengths</span>(dates)<span class="sc">&gt;</span><span class="dv">0</span>]</span></code></pre></div>
<p>Remove BP to the dates, add some random variation</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="final-output.html#cb78-1" tabindex="-1"></a>stdpool<span class="ot">=</span><span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">80</span>,<span class="dv">100</span>,<span class="dv">120</span>)</span>
<span id="cb78-2"><a href="final-output.html#cb78-2" tabindex="-1"></a>founddates<span class="ot">=</span><span class="fu">lapply</span>(founddates,sort)</span>
<span id="cb78-3"><a href="final-output.html#cb78-3" tabindex="-1"></a>founddates<span class="ot">=</span><span class="fu">lapply</span>(founddates,gsub,<span class="at">pattern=</span><span class="st">&quot; BP&quot;</span>,<span class="at">replacement=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb78-4"><a href="final-output.html#cb78-4" tabindex="-1"></a>founddates<span class="ot">=</span><span class="fu">lapply</span>(founddates,rev)</span>
<span id="cb78-5"><a href="final-output.html#cb78-5" tabindex="-1"></a>founddates<span class="ot">=</span><span class="fu">lapply</span>(founddates,<span class="cf">function</span>(i)<span class="fu">paste0</span>(i,<span class="st">&quot; ± &quot;</span>,<span class="fu">sample</span>(stdpool,<span class="fu">length</span>(i),<span class="at">replace=</span>T,<span class="at">prob=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>)),<span class="st">&quot; BP&quot;</span>))</span>
<span id="cb78-6"><a href="final-output.html#cb78-6" tabindex="-1"></a>foundsites<span class="sc">$</span>dates<span class="ot">=</span><span class="fu">sapply</span>(founddates,paste0,<span class="at">collapse=</span><span class="st">&quot; | &quot;</span>)</span>
<span id="cb78-7"><a href="final-output.html#cb78-7" tabindex="-1"></a><span class="fu">plotMap</span>(height.ras,height.wat)</span>
<span id="cb78-8"><a href="final-output.html#cb78-8" tabindex="-1"></a><span class="fu">plot</span>(foundsites,<span class="at">cex=</span>foundsites<span class="sc">$</span>numdates<span class="sc">/</span><span class="dv">20</span><span class="sc">+</span><span class="dv">1</span>,<span class="at">pch=</span><span class="dv">21</span>,<span class="at">bg=</span><span class="fu">as.factor</span>(foundsites<span class="sc">$</span>culture),<span class="at">add=</span>T)</span></code></pre></div>
<p><img src="_main_files/figure-html/addstdev-ex-1.png" width="672" /></p>
</div>
<div id="provide-survey-square-and-publicly-available-dates" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Provide survey square and publicly available dates<a href="final-output.html#provide-survey-square-and-publicly-available-dates" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To then share these date we choose to split the environment in grids and extract date by grid. For each grid, a csv is generated with the sites that have been found and for each site, their geolocalisation and the dates found at the site.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="final-output.html#cb79-1" tabindex="-1"></a></span>
<span id="cb79-2"><a href="final-output.html#cb79-2" tabindex="-1"></a>leftdates <span class="ot">&lt;-</span> dates[<span class="fu">lengths</span>(dates)<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb79-3"><a href="final-output.html#cb79-3" tabindex="-1"></a><span class="fu">plotMap</span>(height.ras,height.wat)</span>
<span id="cb79-4"><a href="final-output.html#cb79-4" tabindex="-1"></a><span class="fu">plot</span>(foundsites,<span class="at">cex=</span>foundsites<span class="sc">$</span>numdates<span class="sc">/</span><span class="dv">20</span><span class="fl">+.1</span>,<span class="at">pch=</span><span class="dv">21</span>,<span class="at">bg=</span><span class="dv">1</span>,<span class="at">add=</span>T)</span>
<span id="cb79-5"><a href="final-output.html#cb79-5" tabindex="-1"></a>squares <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(height.ras,.<span class="dv">5</span>)</span>
<span id="cb79-6"><a href="final-output.html#cb79-6" tabindex="-1"></a>squares <span class="ot">&lt;-</span> <span class="fu">st_bind_cols</span>(squares,<span class="at">ID=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(squares))</span>
<span id="cb79-7"><a href="final-output.html#cb79-7" tabindex="-1"></a><span class="do">## Warning in st_bind_cols(squares, ID = 1:length(squares)): Use &#39;cbind&#39; instead when all arguments to be binded are of class sf.</span></span>
<span id="cb79-8"><a href="final-output.html#cb79-8" tabindex="-1"></a><span class="do">## If you need to cbind a data.frame to an sf, use &#39;st_sf&#39; or &#39;dplyr::bind_cols&#39; (see the examples).</span></span>
<span id="cb79-9"><a href="final-output.html#cb79-9" tabindex="-1"></a><span class="fu">plot</span>(squares,<span class="at">add=</span>T,<span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="fu">rainbow</span>(<span class="fu">nrow</span>(squares)),.<span class="dv">35</span>))</span>
<span id="cb79-10"><a href="final-output.html#cb79-10" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(squares)),<span class="at">label=</span>squares<span class="sc">$</span>ID,<span class="at">col=</span><span class="st">&quot;white&quot;</span>)</span>
<span id="cb79-11"><a href="final-output.html#cb79-11" tabindex="-1"></a><span class="do">## Warning: st_centroid assumes attributes are constant over geometries</span></span>
<span id="cb79-12"><a href="final-output.html#cb79-12" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(squares)),<span class="at">label=</span>squares<span class="sc">$</span>ID,<span class="at">col=</span><span class="st">&quot;white&quot;</span>)</span>
<span id="cb79-13"><a href="final-output.html#cb79-13" tabindex="-1"></a><span class="do">## Warning: st_centroid assumes attributes are constant over geometries</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:plotallfoundiste-ex"></span>
<img src="_main_files/figure-html/plotallfoundiste-ex-1.png" alt="The black dots represent the sites for which dates are available, the size of the circle reflect the amount of dates available. each square represent an area that can be selected by the users." width="672" />
<p class="caption">
Figure 8.2: The black dots represent the sites for which dates are available, the size of the circle reflect the amount of dates available. each square represent an area that can be selected by the users.
</p>
</div>
<p>In the archaoriddle original challenge we proposed to give the data from 4 grids that we selected oursleve to be sure the participants have a least <em>some</em> interesting information. Here we randomly pick up 4 squares with the only limits that they provide at least 5 settlements. You will want to change and manually population the vector <code>selection</code> in the chunk below to cover area with lot of sites and sites from differents cultures, from what can be seen in the Figure <a href="final-output.html#fig:plotallfoundiste-ex">8.2</a>.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="final-output.html#cb80-1" tabindex="-1"></a><span class="fu">plotMap</span>(height.ras,height.wat)</span>
<span id="cb80-2"><a href="final-output.html#cb80-2" tabindex="-1"></a><span class="fu">plot</span>(foundsites,<span class="at">cex=</span>foundsites<span class="sc">$</span>numdates<span class="sc">/</span><span class="dv">20</span><span class="sc">+</span><span class="dv">1</span>,<span class="at">pch=</span><span class="dv">21</span>,<span class="at">bg=</span><span class="fu">as.factor</span>(foundsites<span class="sc">$</span>culture),<span class="at">add=</span>T)</span>
<span id="cb80-3"><a href="final-output.html#cb80-3" tabindex="-1"></a>selection<span class="ot">=</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(squares),<span class="dv">4</span>)</span>
<span id="cb80-4"><a href="final-output.html#cb80-4" tabindex="-1"></a>inter <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(<span class="fu">st_as_sf</span>(foundsites),squares[selection,])</span>
<span id="cb80-5"><a href="final-output.html#cb80-5" tabindex="-1"></a><span class="do">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span id="cb80-6"><a href="final-output.html#cb80-6" tabindex="-1"></a><span class="do">## all geometries</span></span>
<span id="cb80-7"><a href="final-output.html#cb80-7" tabindex="-1"></a><span class="cf">while</span>(<span class="fu">nrow</span>(inter)<span class="sc">&lt;</span><span class="dv">5</span>){</span>
<span id="cb80-8"><a href="final-output.html#cb80-8" tabindex="-1"></a>    selection<span class="ot">=</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(squares),<span class="dv">4</span>)</span>
<span id="cb80-9"><a href="final-output.html#cb80-9" tabindex="-1"></a>    inter <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(<span class="fu">st_as_sf</span>(foundsites),squares[selection,])</span>
<span id="cb80-10"><a href="final-output.html#cb80-10" tabindex="-1"></a>}</span>
<span id="cb80-11"><a href="final-output.html#cb80-11" tabindex="-1"></a><span class="fu">plot</span>(squares[selection,],<span class="at">add=</span>T,<span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&quot;blue&quot;</span>,.<span class="dv">3</span>))</span>
<span id="cb80-12"><a href="final-output.html#cb80-12" tabindex="-1"></a><span class="fu">plotMap</span>(height.ras,height.wat)</span>
<span id="cb80-13"><a href="final-output.html#cb80-13" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">add=</span>T,<span class="at">bg=</span><span class="fu">rainbow</span>(<span class="dv">2</span>,<span class="at">alpha=</span>.<span class="dv">6</span>)[<span class="fu">as.factor</span>(inter<span class="sc">$</span>culture)],<span class="at">pch=</span><span class="dv">21</span>,<span class="at">cex=</span><span class="dv">1</span><span class="sc">+</span>inter<span class="sc">$</span>numdates<span class="sc">/</span><span class="dv">10</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:getpublicsele-ex"></span>
<img src="_main_files/figure-html/getpublicsele-ex-1.png" alt="Left: square publicly available ; right: sites surveyed within these publicly available squares." width="45%" /><img src="_main_files/figure-html/getpublicsele-ex-2.png" alt="Left: square publicly available ; right: sites surveyed within these publicly available squares." width="45%" />
<p class="caption">
Figure 8.3: Left: square publicly available ; right: sites surveyed within these publicly available squares.
</p>
</div>
<div id="giving-name-to-the-publicly-available-data" class="section level3 hasAnchor" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Giving name to the publicly available data<a href="final-output.html#giving-name-to-the-publicly-available-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>On the original challenge we used: <a href="https://www.fantasynamegenerators.com/fantasy-town-names.php">fantasynamegenerators.com</a> to choose nice, randomly generated name, to name the sites publicly available. You will see in the section <a href="original-challenge.html#naming">9.3.3</a> that we positionned them with cultural relevent group, although this has no impact on the results. Here we took all the name we had for the original challenge to randomly assignate some for you custom world.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="final-output.html#cb81-1" tabindex="-1"></a></span>
<span id="cb81-2"><a href="final-output.html#cb81-2" tabindex="-1"></a>site_dist<span class="ot">=</span><span class="fu">st_distance</span>(inter)</span>
<span id="cb81-3"><a href="final-output.html#cb81-3" tabindex="-1"></a>potname<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Farwallow&quot;</span> ,<span class="st">&quot;Bearcall&quot;</span> ,<span class="st">&quot;Dustscar&quot;</span> ,<span class="st">&quot;Clearreach&quot;</span> ,<span class="st">&quot;Rabbithole&quot;</span>,</span>
<span id="cb81-4"><a href="final-output.html#cb81-4" tabindex="-1"></a><span class="st">&quot;Épibéliard&quot;</span> ,<span class="st">&quot;Cololuçon&quot;</span> ,<span class="st">&quot;Pulogne&quot;</span> ,<span class="st">&quot;Haguemasse&quot;</span> ,<span class="st">&quot;Auriteaux&quot;</span> ,<span class="st">&quot;Bourville&quot;</span> ,<span class="st">&quot;Banau&quot;</span> ,<span class="st">&quot;Montnesse&quot;</span> ,<span class="st">&quot;Bannet&quot;</span> ,<span class="st">&quot;Alenlon&quot;</span>, <span class="st">&quot;Roullac&quot;</span> ,<span class="st">&quot;Genneville&quot;</span> ,<span class="st">&quot;Vinlès&quot;</span> ,<span class="st">&quot;Antonnet&quot;</span> ,<span class="st">&quot;Courtou&quot;</span> ,<span class="st">&quot;Beaulogne&quot;</span> ,<span class="st">&quot;Coloville&quot;</span> ,<span class="st">&quot;Sarsart&quot;</span> ,<span class="st">&quot;Soilon&quot;</span> ,<span class="st">&quot;Cololimar&quot;</span>,<span class="st">&quot;Zava&quot;</span> ,<span class="st">&quot;Catadrid&quot;</span> ,<span class="st">&quot;Tegon&quot;</span> ,<span class="st">&quot;Alicia&quot;</span> ,<span class="st">&quot;Mulid&quot;</span> ,<span class="st">&quot;Zararbella&quot;</span> ,<span class="st">&quot;Malid&quot;</span> ,<span class="st">&quot;Cásca&quot;</span> ,<span class="st">&quot;Granalejos&quot;</span> ,<span class="st">&quot;Segorez&quot;</span> ,<span class="st">&quot;Terteixo&quot;</span> ,<span class="st">&quot;Astumanca&quot;</span> ,<span class="st">&quot;Galle&quot;</span> ,<span class="st">&quot;Talona&quot;</span> ,<span class="st">&quot;Girovega&quot;</span> ,<span class="st">&quot;Albanada&quot;</span> ,<span class="st">&quot;Nadoba&quot;</span> ,<span class="st">&quot;Senca&quot;</span> ,<span class="st">&quot;Vallanca&quot;</span> ,<span class="st">&quot;Taville&quot;</span>)</span>
<span id="cb81-5"><a href="final-output.html#cb81-5" tabindex="-1"></a></span>
<span id="cb81-6"><a href="final-output.html#cb81-6" tabindex="-1"></a>u<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb81-7"><a href="final-output.html#cb81-7" tabindex="-1"></a><span class="cf">while</span>(<span class="fu">length</span>(potname)<span class="sc">&lt;</span><span class="fu">nrow</span>(inter)){</span>
<span id="cb81-8"><a href="final-output.html#cb81-8" tabindex="-1"></a>    u<span class="ot">=</span>u<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb81-9"><a href="final-output.html#cb81-9" tabindex="-1"></a>    potname<span class="ot">=</span><span class="fu">c</span>(potname,<span class="fu">paste0</span>(potname,u))</span>
<span id="cb81-10"><a href="final-output.html#cb81-10" tabindex="-1"></a>}</span>
<span id="cb81-11"><a href="final-output.html#cb81-11" tabindex="-1"></a>sitesnames<span class="ot">=</span><span class="fu">sample</span>(potname,<span class="fu">nrow</span>(inter))</span>
<span id="cb81-12"><a href="final-output.html#cb81-12" tabindex="-1"></a></span>
<span id="cb81-13"><a href="final-output.html#cb81-13" tabindex="-1"></a>inter<span class="ot">=</span><span class="fu">cbind</span>(inter,sitesnames)</span>
<span id="cb81-14"><a href="final-output.html#cb81-14" tabindex="-1"></a><span class="fu">plotMap</span>(height.ras,height.wat)</span>
<span id="cb81-15"><a href="final-output.html#cb81-15" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">add=</span>T,<span class="at">bg=</span><span class="fu">rainbow</span>(<span class="dv">2</span>,<span class="at">alpha=</span>.<span class="dv">6</span>)[<span class="fu">as.factor</span>(inter<span class="sc">$</span>culture)],<span class="at">pch=</span><span class="dv">21</span>,<span class="at">cex=</span><span class="dv">1</span><span class="sc">+</span>inter<span class="sc">$</span>numdates<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb81-16"><a href="final-output.html#cb81-16" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">st_coordinates</span>(inter),inter<span class="sc">$</span>sitesnames,<span class="at">cex=</span>.<span class="dv">8</span>,<span class="at">pos=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/namesites-ex-1.png" width="672" /></p>
</div>
<div id="export-and-download-dates" class="section level3 hasAnchor" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Export and download dates<a href="final-output.html#export-and-download-dates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Export csv and data for each public square</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="final-output.html#cb82-1" tabindex="-1"></a></span>
<span id="cb82-2"><a href="final-output.html#cb82-2" tabindex="-1"></a><span class="cf">for</span>(g <span class="cf">in</span> selection){</span>
<span id="cb82-3"><a href="final-output.html#cb82-3" tabindex="-1"></a>    curr<span class="ot">=</span>inter[inter<span class="sc">$</span>ID<span class="sc">==</span>g,]</span>
<span id="cb82-4"><a href="final-output.html#cb82-4" tabindex="-1"></a>    coords<span class="ot">=</span><span class="fu">st_coordinates</span>(curr)</span>
<span id="cb82-5"><a href="final-output.html#cb82-5" tabindex="-1"></a>    <span class="fu">write.csv</span>(<span class="at">file=</span><span class="fu">file.path</span>(<span class="st">&quot;data_toshare&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;square_&quot;</span>,g,<span class="st">&quot;.csv&quot;</span>)),<span class="fu">cbind.data.frame</span>(<span class="at">sitename=</span>curr<span class="sc">$</span>sitesnames,<span class="at">lon=</span>coords[,<span class="dv">1</span>],<span class="at">lat=</span>coords[,<span class="dv">2</span>],<span class="at">dates=</span>curr<span class="sc">$</span>dates,<span class="at">economy=</span>curr<span class="sc">$</span>culture))</span>
<span id="cb82-6"><a href="final-output.html#cb82-6" tabindex="-1"></a>}</span></code></pre></div>
<p>The csvs generate for this specific run of the bookdown can be download for each square:</p>
<ul>
<li><a href="data_toshare/square_55.csv">square 55</a></li>
<li><a href="data_toshare/square_1.csv">square 1</a></li>
<li><a href="data_toshare/square_31.csv">square 31</a></li>
<li><a href="data_toshare/square_43.csv">square 43</a></li>
</ul>
<p>Export csv and data for all ever square</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="final-output.html#cb83-1" tabindex="-1"></a></span>
<span id="cb83-2"><a href="final-output.html#cb83-2" tabindex="-1"></a>allsites<span class="ot">=</span><span class="fu">st_intersection</span>(<span class="fu">st_as_sf</span>(foundsites),squares[<span class="sc">-</span>selection,])</span>
<span id="cb83-3"><a href="final-output.html#cb83-3" tabindex="-1"></a><span class="do">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span id="cb83-4"><a href="final-output.html#cb83-4" tabindex="-1"></a><span class="do">## all geometries</span></span>
<span id="cb83-5"><a href="final-output.html#cb83-5" tabindex="-1"></a></span>
<span id="cb83-6"><a href="final-output.html#cb83-6" tabindex="-1"></a><span class="cf">for</span>(g <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(squares))[<span class="sc">-</span>selection]){</span>
<span id="cb83-7"><a href="final-output.html#cb83-7" tabindex="-1"></a>    curr<span class="ot">=</span>allsites[allsites<span class="sc">$</span>ID<span class="sc">==</span>g,]</span>
<span id="cb83-8"><a href="final-output.html#cb83-8" tabindex="-1"></a>    coords<span class="ot">=</span><span class="fu">st_coordinates</span>(curr)</span>
<span id="cb83-9"><a href="final-output.html#cb83-9" tabindex="-1"></a>    <span class="fu">write.csv</span>(<span class="at">file=</span><span class="fu">file.path</span>(<span class="st">&quot;data_tmp&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;square_&quot;</span>,g,<span class="st">&quot;.csv&quot;</span>)),<span class="fu">cbind.data.frame</span>(<span class="at">lon=</span>coords[,<span class="dv">1</span>],<span class="at">lat=</span>coords[,<span class="dv">2</span>],<span class="at">dates=</span>curr<span class="sc">$</span>dates,<span class="at">economy=</span>curr<span class="sc">$</span>culture))</span>
<span id="cb83-10"><a href="final-output.html#cb83-10" tabindex="-1"></a>}</span>
<span id="cb83-11"><a href="final-output.html#cb83-11" tabindex="-1"></a></span>
<span id="cb83-12"><a href="final-output.html#cb83-12" tabindex="-1"></a>ld<span class="ot">=</span><span class="fu">strsplit</span>(inter<span class="sc">$</span>dates,<span class="st">&quot; </span><span class="sc">\\</span><span class="st">| &quot;</span>)</span>
<span id="cb83-13"><a href="final-output.html#cb83-13" tabindex="-1"></a>ld<span class="ot">=</span><span class="fu">lapply</span>(ld,<span class="cf">function</span>(i)<span class="fu">gsub</span>(<span class="st">&quot; ± .*&quot;</span>,<span class="st">&quot;&quot;</span>,i))</span>
<span id="cb83-14"><a href="final-output.html#cb83-14" tabindex="-1"></a>inter<span class="sc">$</span>start<span class="ot">=</span><span class="fu">sapply</span>(ld,max)</span>
<span id="cb83-15"><a href="final-output.html#cb83-15" tabindex="-1"></a>inter<span class="sc">$</span>end<span class="ot">=</span><span class="fu">sapply</span>(ld,min)</span></code></pre></div>
<p>The csvs generate for all squares can be <a href="data_tmp/">downloaded here</a></p>
</div>
</div>
<div id="bonus-maps" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Bonus maps<a href="final-output.html#bonus-maps" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Some maps we use and did for fake papers and social media etc…</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="final-output.html#cb84-1" tabindex="-1"></a></span>
<span id="cb84-2"><a href="final-output.html#cb84-2" tabindex="-1"></a><span class="do">## plotting oldschool map</span></span>
<span id="cb84-3"><a href="final-output.html#cb84-3" tabindex="-1"></a></span>
<span id="cb84-4"><a href="final-output.html#cb84-4" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">oma=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb84-5"><a href="final-output.html#cb84-5" tabindex="-1"></a></span>
<span id="cb84-6"><a href="final-output.html#cb84-6" tabindex="-1"></a><span class="fu">plot</span>(height.wat,<span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&quot;light blue&quot;</span>,.<span class="dv">4</span>),<span class="at">reset=</span>F,<span class="at">legend=</span>F,<span class="at">axes=</span>F)</span>
<span id="cb84-7"><a href="final-output.html#cb84-7" tabindex="-1"></a><span class="fu">contour</span>(height.ras,<span class="at">levels=</span><span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">300</span>,<span class="dv">15</span>),<span class="at">axes=</span>F,<span class="at">ann=</span>F,<span class="at">lwd=</span>.<span class="dv">1</span>,<span class="at">labels=</span><span class="st">&quot;&quot;</span>,<span class="at">bg=</span><span class="st">&quot;light blue&quot;</span>,<span class="at">add=</span>T)</span>
<span id="cb84-8"><a href="final-output.html#cb84-8" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">pch=</span><span class="dv">4</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">3</span>)</span>
<span id="cb84-9"><a href="final-output.html#cb84-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">pch=</span><span class="dv">20</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">2</span>,<span class="at">cex=</span>.<span class="dv">8</span>,<span class="at">col=</span><span class="fu">as.factor</span>(inter<span class="sc">$</span>culture),<span class="at">alpha=</span>.<span class="dv">8</span>)</span>
<span id="cb84-10"><a href="final-output.html#cb84-10" tabindex="-1"></a></span>
<span id="cb84-11"><a href="final-output.html#cb84-11" tabindex="-1"></a>old<span class="ot">=</span>inter[inter<span class="sc">$</span>start<span class="sc">&gt;</span><span class="dv">7180</span>,]</span>
<span id="cb84-12"><a href="final-output.html#cb84-12" tabindex="-1"></a>ne<span class="ot">=</span>inter[inter<span class="sc">$</span>start<span class="sc">&gt;</span><span class="dv">6800</span> <span class="sc">&amp;</span> inter<span class="sc">$</span>end<span class="sc">&lt;</span><span class="dv">6900</span>,]</span>
<span id="cb84-13"><a href="final-output.html#cb84-13" tabindex="-1"></a></span>
<span id="cb84-14"><a href="final-output.html#cb84-14" tabindex="-1"></a><span class="fu">plot</span>(height.wat,<span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&quot;light blue&quot;</span>,.<span class="dv">4</span>),<span class="at">reset=</span>F,<span class="at">legend=</span>F,<span class="at">axes=</span>F)</span>
<span id="cb84-15"><a href="final-output.html#cb84-15" tabindex="-1"></a><span class="fu">contour</span>(height.ras,<span class="at">levels=</span><span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">300</span>,<span class="dv">15</span>),<span class="at">axes=</span>F,<span class="at">ann=</span>F,<span class="at">lwd=</span>.<span class="dv">1</span>,<span class="at">labels=</span><span class="st">&quot;&quot;</span>,<span class="at">bg=</span><span class="st">&quot;light blue&quot;</span>,<span class="at">add=</span>T)</span>
<span id="cb84-16"><a href="final-output.html#cb84-16" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(old),<span class="at">pch=</span><span class="dv">4</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">5</span>,<span class="at">cex=</span><span class="dv">3</span>)</span>
<span id="cb84-17"><a href="final-output.html#cb84-17" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(old),<span class="at">pch=</span><span class="dv">20</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">2</span>,<span class="at">cex=</span><span class="fl">1.8</span>,<span class="at">col=</span><span class="fu">as.factor</span>(old<span class="sc">$</span>culture),<span class="at">alpha=</span>.<span class="dv">8</span>)</span>
<span id="cb84-18"><a href="final-output.html#cb84-18" tabindex="-1"></a></span>
<span id="cb84-19"><a href="final-output.html#cb84-19" tabindex="-1"></a></span>
<span id="cb84-20"><a href="final-output.html#cb84-20" tabindex="-1"></a><span class="fu">plot</span>(height.wat,<span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&quot;light blue&quot;</span>,.<span class="dv">4</span>),<span class="at">reset=</span>F,<span class="at">legend=</span>F,<span class="at">axes=</span>F)</span>
<span id="cb84-21"><a href="final-output.html#cb84-21" tabindex="-1"></a><span class="fu">contour</span>(height.ras,<span class="at">levels=</span><span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">300</span>,<span class="dv">15</span>),<span class="at">axes=</span>F,<span class="at">ann=</span>F,<span class="at">lwd=</span>.<span class="dv">1</span>,<span class="at">labels=</span><span class="st">&quot;&quot;</span>,<span class="at">bg=</span><span class="st">&quot;light blue&quot;</span>,<span class="at">add=</span>T)</span>
<span id="cb84-22"><a href="final-output.html#cb84-22" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">pch=</span><span class="dv">4</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">5</span>,<span class="at">cex=</span><span class="dv">3</span>)</span>
<span id="cb84-23"><a href="final-output.html#cb84-23" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">pch=</span><span class="dv">20</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">2</span>,<span class="at">cex=</span><span class="fl">1.8</span>,<span class="at">col=</span><span class="fu">as.factor</span>(inter<span class="sc">$</span>culture),<span class="at">alpha=</span>.<span class="dv">8</span>)</span>
<span id="cb84-24"><a href="final-output.html#cb84-24" tabindex="-1"></a></span>
<span id="cb84-25"><a href="final-output.html#cb84-25" tabindex="-1"></a></span>
<span id="cb84-26"><a href="final-output.html#cb84-26" tabindex="-1"></a><span class="fu">plot</span>(height.wat,<span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&quot;light blue&quot;</span>,.<span class="dv">4</span>),<span class="at">reset=</span>F,<span class="at">legend=</span>F,<span class="at">axes=</span>F)</span>
<span id="cb84-27"><a href="final-output.html#cb84-27" tabindex="-1"></a><span class="fu">contour</span>(height.ras,<span class="at">levels=</span><span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">300</span>,<span class="dv">15</span>),<span class="at">axes=</span>F,<span class="at">ann=</span>F,<span class="at">lwd=</span>.<span class="dv">1</span>,<span class="at">labels=</span><span class="st">&quot;&quot;</span>,<span class="at">bg=</span><span class="st">&quot;light blue&quot;</span>,<span class="at">add=</span>T)</span>
<span id="cb84-28"><a href="final-output.html#cb84-28" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">pch=</span><span class="dv">4</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">5</span>,<span class="at">cex=</span><span class="dv">3</span>)</span>
<span id="cb84-29"><a href="final-output.html#cb84-29" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">pch=</span><span class="dv">20</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">2</span>,<span class="at">cex=</span><span class="fl">1.8</span>,<span class="at">col=</span><span class="fu">as.factor</span>(inter<span class="sc">$</span>culture),<span class="at">alpha=</span>.<span class="dv">8</span>)</span>
<span id="cb84-30"><a href="final-output.html#cb84-30" tabindex="-1"></a></span>
<span id="cb84-31"><a href="final-output.html#cb84-31" tabindex="-1"></a><span class="fu">plot</span>(height.wat,<span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&quot;light blue&quot;</span>,.<span class="dv">4</span>),<span class="at">reset=</span>F,<span class="at">legend=</span>F,<span class="at">axes=</span>F)</span>
<span id="cb84-32"><a href="final-output.html#cb84-32" tabindex="-1"></a><span class="fu">contour</span>(height.ras,<span class="at">levels=</span><span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">300</span>,<span class="dv">15</span>),<span class="at">axes=</span>F,<span class="at">ann=</span>F,<span class="at">lwd=</span>.<span class="dv">1</span>,<span class="at">labels=</span><span class="st">&quot;&quot;</span>,<span class="at">bg=</span><span class="st">&quot;light blue&quot;</span>,<span class="at">add=</span>T)</span>
<span id="cb84-33"><a href="final-output.html#cb84-33" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(ne),<span class="at">pch=</span><span class="dv">4</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">5</span>,<span class="at">cex=</span><span class="dv">3</span>)</span>
<span id="cb84-34"><a href="final-output.html#cb84-34" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(ne),<span class="at">pch=</span><span class="dv">20</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">2</span>,<span class="at">cex=</span><span class="fl">1.8</span>,<span class="at">col=</span><span class="fu">as.factor</span>(ne<span class="sc">$</span>culture),<span class="at">alpha=</span>.<span class="dv">8</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/randommaps-ex-1.png" width="30%" /><img src="_main_files/figure-html/randommaps-ex-2.png" width="30%" /><img src="_main_files/figure-html/randommaps-ex-3.png" width="30%" /><img src="_main_files/figure-html/randommaps-ex-4.png" width="30%" /><img src="_main_files/figure-html/randommaps-ex-5.png" width="30%" /></p>
<p>More maps for twitter:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="final-output.html#cb85-1" tabindex="-1"></a><span class="fu">plot</span>(height.wat,<span class="at">col=</span><span class="fu">adjustcolor</span>(<span class="st">&quot;light blue&quot;</span>,.<span class="dv">4</span>),<span class="at">reset=</span>F,<span class="at">legend=</span>F,<span class="at">axes=</span>F)</span>
<span id="cb85-2"><a href="final-output.html#cb85-2" tabindex="-1"></a><span class="fu">contour</span>(height.ras,<span class="at">levels=</span><span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">300</span>,<span class="dv">15</span>),<span class="at">axes=</span>F,<span class="at">ann=</span>F,<span class="at">lwd=</span>.<span class="dv">2</span>,<span class="at">labels=</span><span class="st">&quot;&quot;</span>,<span class="at">bg=</span><span class="st">&quot;light blue&quot;</span>,<span class="at">add=</span>T)</span>
<span id="cb85-3"><a href="final-output.html#cb85-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">pch=</span><span class="dv">4</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">5</span>,<span class="at">cex=</span><span class="dv">3</span>)</span>
<span id="cb85-4"><a href="final-output.html#cb85-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">pch=</span><span class="dv">20</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">2</span>,<span class="at">cex=</span><span class="fl">1.8</span>,<span class="at">col=</span><span class="fu">as.factor</span>(inter<span class="sc">$</span>culture),<span class="at">alpha=</span>.<span class="dv">8</span>)</span>
<span id="cb85-5"><a href="final-output.html#cb85-5" tabindex="-1"></a>sel<span class="ot">=</span>inter[<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">2</span>,<span class="dv">15</span>,<span class="dv">36</span>),]</span>
<span id="cb85-6"><a href="final-output.html#cb85-6" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">st_coordinates</span>(sel),sel<span class="sc">$</span>sitesnames,<span class="at">cex=</span>.<span class="dv">8</span>,<span class="at">pos=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">4</span>))</span>
<span id="cb85-7"><a href="final-output.html#cb85-7" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">y =</span> .<span class="dv">7</span>, <span class="at">labels =</span> <span class="st">&quot;❤️&quot;</span>, <span class="at">adj =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">font =</span> <span class="dv">1</span>)</span>
<span id="cb85-8"><a href="final-output.html#cb85-8" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">y =</span> <span class="fl">1.2</span>, <span class="at">labels =</span> <span class="st">&quot;🔥 &quot;</span>, <span class="at">adj =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">font =</span> <span class="dv">1</span>)</span>
<span id="cb85-9"><a href="final-output.html#cb85-9" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">y =</span> <span class="fl">1.2</span>, <span class="at">labels =</span> <span class="st">&quot;⚔️ &quot;</span>, <span class="at">adj =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">font =</span> <span class="dv">1</span>)</span>
<span id="cb85-10"><a href="final-output.html#cb85-10" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">1.2</span>, <span class="at">y =</span> <span class="fl">1.8</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">labels =</span> <span class="st">&quot;???? &quot;</span>, <span class="at">adj=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">font =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/randommaps2-ex-1.png" width="672" />
More maps!! (the coolest)</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="final-output.html#cb86-1" tabindex="-1"></a><span class="fu">plotMap</span>(height.ras,height.wat)</span>
<span id="cb86-2"><a href="final-output.html#cb86-2" tabindex="-1"></a><span class="fu">contour</span>(height.ras,<span class="at">levels=</span><span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">300</span>,<span class="dv">15</span>),<span class="at">axes=</span>F,<span class="at">ann=</span>F,<span class="at">lwd=</span>.<span class="dv">2</span>,<span class="at">labels=</span><span class="st">&quot;&quot;</span>,<span class="at">bg=</span><span class="st">&quot;light blue&quot;</span>,<span class="at">add=</span>T)</span>
<span id="cb86-3"><a href="final-output.html#cb86-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">pch=</span><span class="dv">4</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">5</span>,<span class="at">cex=</span><span class="dv">3</span>)</span>
<span id="cb86-4"><a href="final-output.html#cb86-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">pch=</span><span class="dv">20</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">2</span>,<span class="at">cex=</span><span class="fl">1.8</span>,<span class="at">col=</span><span class="fu">as.factor</span>(inter<span class="sc">$</span>culture),<span class="at">alpha=</span>.<span class="dv">8</span>)</span>
<span id="cb86-5"><a href="final-output.html#cb86-5" tabindex="-1"></a>coastline<span class="ot">=</span><span class="fu">st_cast</span>(<span class="fu">st_as_sf</span>(<span class="fu">as.polygons</span>(height.ras<span class="sc">&gt;</span><span class="fu">mean</span>(height.ras[])))[<span class="dv">2</span>,],<span class="st">&quot;MULTILINESTRING&quot;</span>)</span>
<span id="cb86-6"><a href="final-output.html#cb86-6" tabindex="-1"></a><span class="fu">plot</span>(coastline,<span class="at">add=</span>T,<span class="at">lwd=</span><span class="fl">1.1</span>,<span class="at">col=</span><span class="st">&quot;black&quot;</span>)</span>
<span id="cb86-7"><a href="final-output.html#cb86-7" tabindex="-1"></a>sel<span class="ot">=</span>inter[<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">2</span>,<span class="dv">15</span>,<span class="dv">36</span>),]</span>
<span id="cb86-8"><a href="final-output.html#cb86-8" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">st_coordinates</span>(sel),sel<span class="sc">$</span>sitesnames,<span class="at">cex=</span>.<span class="dv">8</span>,<span class="at">pos=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">4</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/randommaps3-ex-1.png" width="672" /></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="final-output.html#cb87-1" tabindex="-1"></a></span>
<span id="cb87-2"><a href="final-output.html#cb87-2" tabindex="-1"></a><span class="fu">plotMap</span>(height.ras,height.wat)</span>
<span id="cb87-3"><a href="final-output.html#cb87-3" tabindex="-1"></a><span class="fu">contour</span>(height.ras,<span class="at">levels=</span><span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">300</span>,<span class="dv">15</span>),<span class="at">axes=</span>F,<span class="at">ann=</span>F,<span class="at">lwd=</span>.<span class="dv">2</span>,<span class="at">labels=</span><span class="st">&quot;&quot;</span>,<span class="at">bg=</span><span class="st">&quot;light blue&quot;</span>,<span class="at">add=</span>T)</span>
<span id="cb87-4"><a href="final-output.html#cb87-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">pch=</span><span class="dv">4</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">5</span>,<span class="at">cex=</span><span class="dv">3</span>)</span>
<span id="cb87-5"><a href="final-output.html#cb87-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(inter),<span class="at">pch=</span><span class="dv">20</span>,<span class="at">add=</span>T,<span class="at">lwd=</span>.<span class="dv">2</span>,<span class="at">cex=</span><span class="fl">1.8</span>,<span class="at">col=</span><span class="fu">as.factor</span>(inter<span class="sc">$</span>culture),<span class="at">alpha=</span>.<span class="dv">8</span>)</span>
<span id="cb87-6"><a href="final-output.html#cb87-6" tabindex="-1"></a>coastline<span class="ot">=</span><span class="fu">st_cast</span>(<span class="fu">st_as_sf</span>(<span class="fu">as.polygons</span>(height.ras<span class="sc">&gt;</span><span class="fu">mean</span>(height.ras[])))[<span class="dv">2</span>,],<span class="st">&quot;MULTILINESTRING&quot;</span>)</span>
<span id="cb87-7"><a href="final-output.html#cb87-7" tabindex="-1"></a><span class="fu">plot</span>(coastline,<span class="at">add=</span>T,<span class="at">lwd=</span><span class="fl">1.1</span>,<span class="at">col=</span><span class="st">&quot;black&quot;</span>)</span>
<span id="cb87-8"><a href="final-output.html#cb87-8" tabindex="-1"></a>sel<span class="ot">=</span>inter[<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">2</span>,<span class="dv">15</span>,<span class="dv">36</span>),]</span>
<span id="cb87-9"><a href="final-output.html#cb87-9" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">st_coordinates</span>(sel),sel<span class="sc">$</span>sitesnames,<span class="at">cex=</span>.<span class="dv">8</span>,<span class="at">pos=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">4</span>))</span>
<span id="cb87-10"><a href="final-output.html#cb87-10" tabindex="-1"></a><span class="co">#text(x = -1, y = .7, labels = &quot;🍻&quot;, adj = c(0, 0), cex = 3, col = &quot;black&quot;, font = 1)</span></span>
<span id="cb87-11"><a href="final-output.html#cb87-11" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">3.4</span>, <span class="at">y =</span> .<span class="dv">7</span>, <span class="at">labels =</span> <span class="st">&quot;🍻 &quot;</span>, <span class="at">adj =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">cex =</span> <span class="dv">10</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">font =</span> <span class="dv">1</span>)</span>
<span id="cb87-12"><a href="final-output.html#cb87-12" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">1.8</span>, <span class="at">y =</span> .<span class="dv">7</span>, <span class="at">labels =</span> <span class="st">&quot;👍 &quot;</span>, <span class="at">adj =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">cex =</span> <span class="dv">8</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">font =</span> <span class="dv">1</span>)</span>
<span id="cb87-13"><a href="final-output.html#cb87-13" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">y =</span> .<span class="dv">7</span>, <span class="at">labels =</span> <span class="st">&quot;🍔 &quot;</span>, <span class="at">adj =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">cex =</span> <span class="dv">6</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">font =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="final-output.html#cb88-1" tabindex="-1"></a><span class="co">#text(x = -1, y = 1.2, labels = &quot;⚔️ &quot;, adj = c(0, 0), cex = 3, col = &quot;black&quot;, font = 1)</span></span>
<span id="cb88-2"><a href="final-output.html#cb88-2" tabindex="-1"></a><span class="co">#text(x = -1.2, y = 1.8/2, labels = &quot;???? &quot;, adj=c(0,0), cex = 3, col = &quot;black&quot;, font = 1)</span></span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="recloss.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="original-challenge.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
